{%- comment -%}
  MILAURA LIST COLLECTIONS GRID
  Grille de collections avec cartes luxueuses
  Design: Cards 3D avec hover effect, glassmorphism, animations staggered
  @version 1.0.0
{%- endcomment -%}

{%- style -%}
  #MilauraListCollectionsGrid-{{ section.id }} {
    padding: var(--milaura-spacing-lg) 0 var(--milaura-spacing-xl);
  }

  /* Grid */
  #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-grid {
    display: grid;
    grid-template-columns: repeat({{ section.settings.columns }}, 1fr);
    gap: 30px;
  }

  /* Card Collection */
  #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card {
    position: relative;
    border-radius: var(--milaura-border-radius, 20px);
    overflow: hidden;
    background: #ffffff;
    box-shadow:
      0 10px 40px rgba(0, 0, 0, 0.08),
      0 0 0 1px rgba(192, 160, 98, 0.1);
    transition: all 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
    transform-style: preserve-3d;
    perspective: 1000px;

    /* Animation entree staggered */
    opacity: 0;
    transform: translateY(30px);
    animation: milauraCardReveal 0.7s ease-out forwards;
  }

  /* Stagger delay pour chaque carte */
  #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card:nth-child(1) { animation-delay: 0.1s; }
  #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card:nth-child(2) { animation-delay: 0.2s; }
  #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card:nth-child(3) { animation-delay: 0.3s; }
  #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card:nth-child(4) { animation-delay: 0.4s; }
  #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card:nth-child(5) { animation-delay: 0.5s; }
  #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card:nth-child(6) { animation-delay: 0.6s; }
  #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card:nth-child(7) { animation-delay: 0.7s; }
  #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card:nth-child(8) { animation-delay: 0.8s; }

  @keyframes milauraCardReveal {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Hover 3D effect */
  #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card:hover {
    box-shadow:
      0 25px 60px rgba(192, 160, 98, 0.25),
      0 0 0 2px rgba(192, 160, 98, 0.3);
    transform: translateY(-8px) rotateX(2deg);
  }

  /* Halo dore au hover */
  #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(ellipse at center, rgba(192, 160, 98, 0.15) 0%, transparent 70%);
    opacity: 0;
    transition: opacity 0.5s ease;
    pointer-events: none;
    z-index: 1;
  }

  #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card:hover::after {
    opacity: 1;
  }

  /* Card Link */
  #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card__link {
    display: block;
    text-decoration: none;
    color: inherit;
  }

  /* Image container */
  #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card__image-wrap {
    position: relative;
    aspect-ratio: {{ section.settings.image_ratio }};
    overflow: hidden;
  }

  #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.7s cubic-bezier(0.25, 0.8, 0.25, 1);
  }

  #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card:hover .milaura-lc-card__image {
    transform: scale(1.08);
  }

  /* Overlay gradient */
  #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card__overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 60%;
    background: linear-gradient(
      to top,
      rgba(0, 0, 0, 0.7) 0%,
      rgba(0, 0, 0, 0.3) 50%,
      transparent 100%
    );
    pointer-events: none;
    z-index: 2;
  }

  /* Badge count */
  #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card__badge {
    position: absolute;
    top: 16px;
    right: 16px;
    z-index: 3;
    display: inline-flex;
    align-items: center;
    gap: 4px;
    padding: 6px 12px;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border-radius: 50px;
    font-size: 12px;
    font-weight: 600;
    color: var(--milaura-gold, #C0A062);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  }

  /* Content inside image */
  #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card__content-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    padding: 24px;
    z-index: 3;
  }

  #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card__title {
    font-family: {{ section.settings.title_font }};
    font-size: {{ section.settings.title_size }}px;
    font-weight: 600;
    color: #ffffff;
    margin: 0 0 8px 0;
    text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    line-height: 1.2;
  }

  #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card__description {
    font-size: 14px;
    color: rgba(255, 255, 255, 0.9);
    margin: 0;
    line-height: 1.5;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* Content below (alternate style) */
  #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card__content-below {
    padding: 20px 24px 24px;
    background: #ffffff;
    position: relative;
    z-index: 2;
  }

  #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card__content-below .milaura-lc-card__title {
    color: var(--milaura-text, #000000);
    text-shadow: none;
    font-size: {{ section.settings.title_size | times: 0.9 | round: 0 }}px;
  }

  #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card__content-below .milaura-lc-card__description {
    color: var(--milaura-text-light, #666666);
    margin-bottom: 16px;
  }

  /* CTA Arrow */
  #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card__cta {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    font-size: 13px;
    font-weight: 600;
    color: var(--milaura-gold, #C0A062);
    text-transform: uppercase;
    letter-spacing: 1px;
    transition: gap 0.3s ease;
  }

  #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card:hover .milaura-lc-card__cta {
    gap: 12px;
  }

  #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card__cta svg {
    width: 16px;
    height: 16px;
    transition: transform 0.3s ease;
  }

  #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card:hover .milaura-lc-card__cta svg {
    transform: translateX(4px);
  }

  /* Empty placeholder */
  #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card__placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #FDFBF7 0%, #F2E8D5 100%);
    font-size: 48px;
  }

  /* Tablet */
  @media screen and (max-width: 1024px) {
    #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
    }

    #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card__title {
      font-size: {{ section.settings.title_size | times: 0.85 | round: 0 }}px;
    }
  }

  /* Mobile */
  @media screen and (max-width: 768px) {
    #MilauraListCollectionsGrid-{{ section.id }} {
      padding: var(--milaura-spacing-md) 0 var(--milaura-spacing-lg);
    }

    #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-grid {
      grid-template-columns: repeat({{ section.settings.mobile_columns }}, 1fr);
      gap: 16px;
    }

    #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card__content-overlay {
      padding: 16px;
    }

    #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card__title {
      font-size: 20px;
    }

    #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card__description {
      font-size: 13px;
      -webkit-line-clamp: 1;
    }

    #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card__badge {
      top: 12px;
      right: 12px;
      padding: 4px 10px;
      font-size: 11px;
    }

    #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card__content-below {
      padding: 16px;
    }
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card {
      animation: none;
      opacity: 1;
      transform: none;
    }

    #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card,
    #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card__image,
    #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card__cta,
    #MilauraListCollectionsGrid-{{ section.id }} .milaura-lc-card__cta svg {
      transition: none;
    }
  }
{%- endstyle -%}

{%- liquid
  # Sort collections
  case section.settings.sort
    when 'products_high', 'products_low'
      assign sorted_collections = collections | sort: 'all_products_count'
    when 'date', 'date_reversed'
      assign sorted_collections = collections | sort: 'published_at'
    else
      assign sorted_collections = collections
  endcase

  if section.settings.sort == 'products_high' or section.settings.sort == 'date_reversed' or section.settings.sort == 'alphabetical_reversed'
    assign sorted_collections = sorted_collections | reverse
  endif
-%}

<section
  id="MilauraListCollectionsGrid-{{ section.id }}"
  class="milaura-list-collections-grid"
>
  <div class="page-width">
    <div class="milaura-lc-grid">
      {%- for collection in sorted_collections -%}
        {%- if collection.handle != 'all' and collection.handle != 'recos-pool' -%}
          <article class="milaura-lc-card">
            <a href="{{ collection.url }}" class="milaura-lc-card__link">
              {%- comment -%} Image {%- endcomment -%}
              <div class="milaura-lc-card__image-wrap">
                {%- if collection.image != blank -%}
                  {{
                    collection.image
                    | image_url: width: 800
                    | image_tag:
                      class: 'milaura-lc-card__image',
                      loading: 'lazy',
                      widths: '300, 500, 800',
                      sizes: '(min-width: 1024px) 33vw, 50vw',
                      alt: collection.title | escape
                  }}
                {%- elsif collection.products.first and collection.products.first.featured_image -%}
                  {{
                    collection.products.first.featured_image
                    | image_url: width: 800
                    | image_tag:
                      class: 'milaura-lc-card__image',
                      loading: 'lazy',
                      widths: '300, 500, 800',
                      sizes: '(min-width: 1024px) 33vw, 50vw',
                      alt: collection.title | escape
                  }}
                {%- else -%}
                  <div class="milaura-lc-card__placeholder">
                    ‚ú®
                  </div>
                {%- endif -%}

                {%- comment -%} Overlay {%- endcomment -%}
                <div class="milaura-lc-card__overlay"></div>

                {%- comment -%} Badge {%- endcomment -%}
                <span class="milaura-lc-card__badge">
                  {{ collection.products_count }} {{ collection.products_count | pluralize: 'piece', 'pieces' }}
                </span>

                {%- comment -%} Content over image (overlay style) {%- endcomment -%}
                {%- if section.settings.content_position == 'overlay' -%}
                  <div class="milaura-lc-card__content-overlay">
                    <h2 class="milaura-lc-card__title">{{ collection.title }}</h2>
                    {%- if collection.description != blank and section.settings.show_description -%}
                      <p class="milaura-lc-card__description">{{ collection.description | strip_html | truncate: 100 }}</p>
                    {%- endif -%}
                  </div>
                {%- endif -%}
              </div>

              {%- comment -%} Content below image (below style) {%- endcomment -%}
              {%- if section.settings.content_position == 'below' -%}
                <div class="milaura-lc-card__content-below">
                  <h2 class="milaura-lc-card__title">{{ collection.title }}</h2>
                  {%- if collection.description != blank and section.settings.show_description -%}
                    <p class="milaura-lc-card__description">{{ collection.description | strip_html | truncate: 120 }}</p>
                  {%- endif -%}
                  <span class="milaura-lc-card__cta">
                    Decouvrir
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                      <line x1="5" y1="12" x2="19" y2="12"></line>
                      <polyline points="12 5 19 12 12 19"></polyline>
                    </svg>
                  </span>
                </div>
              {%- endif -%}
            </a>
          </article>
        {%- endif -%}
      {%- endfor -%}
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Milaura Collections Grille",
  "tag": "section",
  "class": "milaura-section",
  "settings": [
    {
      "type": "header",
      "content": "üìê Layout"
    },
    {
      "type": "range",
      "id": "columns",
      "label": "Colonnes (desktop)",
      "min": 2,
      "max": 4,
      "step": 1,
      "default": 3
    },
    {
      "type": "select",
      "id": "mobile_columns",
      "label": "Colonnes (mobile)",
      "options": [
        { "value": "1", "label": "1 colonne" },
        { "value": "2", "label": "2 colonnes" }
      ],
      "default": "1"
    },
    {
      "type": "select",
      "id": "image_ratio",
      "label": "Ratio image",
      "options": [
        { "value": "1/1", "label": "Carre (1:1)" },
        { "value": "4/3", "label": "Paysage (4:3)" },
        { "value": "3/4", "label": "Portrait (3:4)" },
        { "value": "16/9", "label": "Cinema (16:9)" }
      ],
      "default": "4/3"
    },
    {
      "type": "select",
      "id": "content_position",
      "label": "Position du contenu",
      "options": [
        { "value": "overlay", "label": "Sur l'image" },
        { "value": "below", "label": "Sous l'image" }
      ],
      "default": "overlay"
    },
    {
      "type": "header",
      "content": "‚öôÔ∏è Options"
    },
    {
      "type": "checkbox",
      "id": "show_description",
      "label": "Afficher la description",
      "default": true
    },
    {
      "type": "select",
      "id": "sort",
      "label": "Tri des collections",
      "options": [
        { "value": "alphabetical", "label": "A-Z" },
        { "value": "alphabetical_reversed", "label": "Z-A" },
        { "value": "date_reversed", "label": "Plus recentes" },
        { "value": "date", "label": "Plus anciennes" },
        { "value": "products_high", "label": "Plus de produits" },
        { "value": "products_low", "label": "Moins de produits" }
      ],
      "default": "alphabetical"
    },
    {
      "type": "header",
      "content": "‚úèÔ∏è Style Titres"
    },
    {
      "type": "select",
      "id": "title_font",
      "label": "Police du titre",
      "options": [
        { "value": "'Lato', sans-serif", "label": "Lato" },
        { "value": "'Playfair Display', serif", "label": "Playfair Display" },
        { "value": "'Dancing Script', cursive", "label": "Dancing Script" }
      ],
      "default": "'Dancing Script', cursive"
    },
    {
      "type": "range",
      "id": "title_size",
      "label": "Taille du titre",
      "min": 20,
      "max": 36,
      "step": 1,
      "unit": "px",
      "default": 28
    }
  ],
  "presets": [
    {
      "name": "Milaura Collections Grille"
    }
  ]
}
{% endschema %}
