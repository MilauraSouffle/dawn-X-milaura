{% comment %}
  MILAURA PRODUCT STORY
  Texte émotionnel 3-5 phrases style Aesop
  Sobre, poétique, respirant
  Lien quiz si produit lié à profil émotionnel
  Fade-in au scroll
{% endcomment %}

{%- liquid
  assign story_text = product.metafields.milaura.story_text | default: section.settings.default_story
  assign product_type = product.type | downcase

  case product_type
    when 'bijou', 'bracelet', 'collier', 'bague'
      assign template_type = 'bijou'
      assign quiz_cta = 'Découvre ton bijou idéal'
    when 'bougie'
      assign template_type = 'bougie'
      assign quiz_cta = 'Découvre ta bougie émotionnelle'
    when 'sauge', 'encens'
      assign template_type = 'sauge'
      assign quiz_cta = 'Trouve ton rituel de purification'
    when 'coffret', 'bundle'
      assign template_type = 'coffret'
      assign quiz_cta = 'Découvre ton coffret sur-mesure'
    else
      assign template_type = 'bijou'
      assign quiz_cta = 'Découvre ton profil émotionnel'
  endcase
-%}

<section
  id="MilauraProductStory-{{ section.id }}"
  class="milaura-product-story"
  data-section-id="{{ section.id }}"
>
  <div class="milaura-product-story__container">

    <div class="milaura-product-story__content">

      {%- if section.settings.show_label -%}
        <p class="milaura-product-story__label">
          {{ section.settings.label_text }}
        </p>
      {%- endif -%}

      {%- if story_text != blank -%}
        <div class="milaura-product-story__text">
          {{ story_text }}
        </div>
      {%- endif -%}

      {%- if section.settings.show_quiz_link -%}
        <div class="milaura-product-story__quiz">
          <a
            href="{{ section.settings.quiz_url | default: '/pages/quiz' }}"
            class="milaura-product-story__quiz-link"
          >
            {{ quiz_cta }}
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M7.5 15L12.5 10L7.5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </a>
        </div>
      {%- endif -%}

    </div>

  </div>
</section>

<style>
  .milaura-product-story {
    padding: var(--milaura-spacing-xl, 48px) 0;
    background: linear-gradient(
      to bottom,
      var(--milaura-beige, #FDFBF7) 0%,
      #F2E8D5 100%
    );
    opacity: 0;
    transform: translateY(40px);
    transition: opacity 0.8s ease, transform 0.8s ease;
  }

  .milaura-product-story.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  .milaura-product-story__container {
    max-width: 800px;
    margin: 0 auto;
    padding: 0 var(--milaura-spacing-md, 24px);
    text-align: center;
  }

  .milaura-product-story__content {
    display: flex;
    flex-direction: column;
    gap: var(--milaura-spacing-md, 24px);
    align-items: center;
  }

  .milaura-product-story__label {
    font-size: 12px;
    font-weight: 600;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--milaura-gold, #C0A062);
    margin: 0;
  }

  .milaura-product-story__text {
    font-size: 18px;
    line-height: 1.8;
    color: var(--milaura-text, #000000);
    font-style: italic;
    opacity: 0.9;
  }

  .milaura-product-story__text p {
    margin: 0 0 1.2em 0;
  }

  .milaura-product-story__text p:last-child {
    margin-bottom: 0;
  }

  .milaura-product-story__quiz {
    margin-top: var(--milaura-spacing-sm, 12px);
  }

  .milaura-product-story__quiz-link {
    display: inline-flex;
    align-items: center;
    gap: var(--milaura-spacing-xs, 6px);
    padding: 12px 24px;
    background: rgba(192, 160, 98, 0.1);
    border: 1px solid rgba(192, 160, 98, 0.3);
    border-radius: 12px;
    color: var(--milaura-gold-dark, #8F723A);
    font-size: 15px;
    font-weight: 500;
    text-decoration: none;
    transition: all 0.3s ease;
  }

  .milaura-product-story__quiz-link:hover {
    background: rgba(192, 160, 98, 0.2);
    border-color: var(--milaura-gold, #C0A062);
    transform: translateY(-2px);
  }

  .milaura-product-story__quiz-link svg {
    transition: transform 0.3s ease;
  }

  .milaura-product-story__quiz-link:hover svg {
    transform: translateX(4px);
  }

  /* Desktop */
  @media screen and (min-width: 1024px) {
    .milaura-product-story {
      padding: var(--milaura-spacing-xl, 48px) 0 calc(var(--milaura-spacing-xl, 48px) * 1.5) 0;
    }

    .milaura-product-story__text {
      font-size: 22px;
      line-height: 1.9;
    }

    .milaura-product-story__quiz-link {
      font-size: 16px;
    }
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .milaura-product-story {
      transition: none;
    }

    .milaura-product-story__quiz-link,
    .milaura-product-story__quiz-link svg {
      transition: none;
    }
  }
</style>

<script>
(function() {
  const sectionId = '{{ section.id }}';
  const section = document.getElementById('MilauraProductStory-' + sectionId);
  if (!section) return;

  const reducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

  // Fade-in au scroll
  if (!reducedMotion) {
    const observer = new IntersectionObserver(function(entries) {
      entries.forEach(function(entry) {
        if (entry.isIntersecting) {
          entry.target.classList.add('is-visible');
          observer.unobserve(entry.target);
        }
      });
    }, {
      threshold: 0.2
    });

    observer.observe(section);
  } else {
    section.classList.add('is-visible');
  }
})();
</script>

{% schema %}
{
  "name": "Milaura Product Story",
  "class": "milaura-section",
  "settings": [
    {
      "type": "header",
      "content": "Label"
    },
    {
      "type": "checkbox",
      "id": "show_label",
      "label": "Afficher le label",
      "default": true
    },
    {
      "type": "text",
      "id": "label_text",
      "label": "Texte du label",
      "default": "L'histoire"
    },
    {
      "type": "header",
      "content": "Texte par défaut"
    },
    {
      "type": "richtext",
      "id": "default_story",
      "label": "Histoire par défaut",
      "default": "<p>Chaque création Milaura naît d'une intention : celle de t'offrir un refuge. Un objet qui t'accompagne, qui te rappelle que tu mérites de prendre soin de toi.</p><p>Les pierres sont choisies pour leur énergie, leur beauté naturelle, leur capacité à apaiser ou à réveiller. Elles ne sont pas magiques. Elles sont authentiques. Comme toi.</p>",
      "info": "Utilisé si metafield milaura.story_text est vide. Style Aesop : sobre, poétique, 3-5 phrases max."
    },
    {
      "type": "header",
      "content": "Lien quiz"
    },
    {
      "type": "checkbox",
      "id": "show_quiz_link",
      "label": "Afficher le lien vers le quiz",
      "default": true,
      "info": "Recommandé si produit lié à profil émotionnel"
    },
    {
      "type": "url",
      "id": "quiz_url",
      "label": "URL du quiz"
    }
  ],
  "presets": [
    {
      "name": "Milaura Product Story"
    }
  ]
}
{% endschema %}
