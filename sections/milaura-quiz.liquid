{% style %}
  /* ============================================
     MILAURA QUIZ - DIAGNOSTIC Ã‰MOTIONNEL
     ============================================ */

     #MilauraQuiz-{{ section.id }} {
    width: 100%;
    padding: var(--milaura-spacing-lg) var(--milaura-spacing-sm) var(--milaura-spacing-lg);
    background: transparent;
    min-height: 400px;
    /* Espacement vertical harmonisÃ© */
    margin-top: var(--milaura-spacing-lg);
    margin-bottom: var(--milaura-spacing-lg);
  }

  /* --- CONTENEUR PRINCIPAL --- */
  #MilauraQuiz-{{ section.id }} .quiz-container {
    /* Utilise la classe gÃ©nÃ©rique .milaura-section-card */
    /* max-width, width, margin gÃ©rÃ©s par .milaura-section-card */
    position: relative;
  }

  /* --- Ã‰TAT : INTRO --- */
  #MilauraQuiz-{{ section.id }} .quiz-state {
    display: none;
    opacity: 0;
    transform: translateX(40px);
    transition:
      opacity 520ms cubic-bezier(0.22, 1, 0.36, 1),
      transform 650ms cubic-bezier(0.22, 1, 0.36, 1);
  }

  /* Exit animation (slide left) */
  #MilauraQuiz-{{ section.id }} .quiz-state.is-exiting {
    transform: translateX(-40px);
    opacity: 0;
  }

  #MilauraQuiz-{{ section.id }} .quiz-state.is-active {
    display: block;
    opacity: 1;
    transform: translateX(0);
  }

  #MilauraQuiz-{{ section.id }} .quiz-intro-card {
    /* Le halo est gÃ©rÃ© par le conteneur parent .milaura-section-card */
    background: transparent;
    border: none;
    border-radius: 0;
    padding: 0;
    box-shadow: none;
    text-align: center;
  }

  #MilauraQuiz-{{ section.id }} .quiz-intro-title {
    font-family: var(--milaura-font-heading);
    color: var(--milaura-gold);
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: var(--milaura-spacing-md);
    line-height: 1.2;
  }

  #MilauraQuiz-{{ section.id }} .quiz-intro-subtitle {
    font-family: var(--milaura-font-body);
    color: var(--milaura-text);
    font-size: 1.1rem;
    line-height: 1.6;
    margin-bottom: var(--milaura-spacing-lg);
  }

  #MilauraQuiz-{{ section.id }} .quiz-expert-block {
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(25px) saturate(180%);
    -webkit-backdrop-filter: blur(25px) saturate(180%);
    border: 1px solid rgba(192, 160, 98, 0.35);
    box-shadow: 0 10px 30px rgba(192, 160, 98, 0.15);
    border-radius: var(--milaura-border-radius-sm);
    padding: var(--milaura-spacing-md);
    margin: var(--milaura-spacing-lg) 0;
    display: flex;
    align-items: center;
    gap: var(--milaura-spacing-md);
    text-align: left;
    transition: all 0.3s ease;
  }

  #MilauraQuiz-{{ section.id }} .quiz-expert-block:hover {
    background: rgba(255, 255, 255, 0.8);
    box-shadow: 0 12px 35px rgba(192, 160, 98, 0.2);
  }

  #MilauraQuiz-{{ section.id }} .quiz-expert-image {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid var(--milaura-gold);
    flex-shrink: 0;
  }

  #MilauraQuiz-{{ section.id }} .quiz-expert-info {
    flex: 1;
  }

  #MilauraQuiz-{{ section.id }} .quiz-expert-name {
    font-family: var(--milaura-font-heading);
    color: var(--milaura-text);
    font-size: 1.3rem;
    font-weight: 700;
    margin-bottom: 5px;
  }

  #MilauraQuiz-{{ section.id }} .quiz-expert-title {
    font-family: var(--milaura-font-body);
    color: var(--milaura-gold);
    font-size: 1rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 8px;
  }

  #MilauraQuiz-{{ section.id }} .quiz-expert-text {
    font-family: var(--milaura-font-body);
    color: var(--milaura-text-light);
    font-size: 1.05rem;
    line-height: 1.5;
  }

  /* --- Ã‰TAT : QUESTIONS --- */
  #MilauraQuiz-{{ section.id }} .quiz-questions-header {
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(20px);
    border-radius: var(--milaura-border-radius);
    padding: var(--milaura-spacing-md);
    margin-bottom: var(--milaura-spacing-lg);
    text-align: center;
    border: 1px solid rgba(192, 160, 98, 0.3);
  }

  #MilauraQuiz-{{ section.id }} .quiz-progress-text {
    font-family: var(--milaura-font-body);
    color: var(--milaura-text);
    font-size: 1rem;
    margin-bottom: 10px;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  #MilauraQuiz-{{ section.id }} .quiz-progress-bar {
    width: 100%;
    height: 8px;
    background: rgba(192, 160, 98, 0.2);
    border-radius: 10px;
    overflow: hidden;
    position: relative;
  }

  #MilauraQuiz-{{ section.id }} .quiz-progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--milaura-gold) 0%, var(--milaura-gold-light) 100%);
    border-radius: 10px;
    transition: width 0.4s ease;
    box-shadow: 0 2px 10px rgba(192, 160, 98, 0.4);
    position: relative;
    overflow: hidden;
  }

  /* Shimmer effect on progress bar */
  #MilauraQuiz-{{ section.id }} .quiz-progress-fill::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 200%;
    height: 100%;
    background: linear-gradient(
      120deg,
      transparent 0%,
      rgba(255, 255, 255, 0.6) 50%,
      transparent 100%
    );
    transform: translateX(-100%);
    animation: quiz-shimmer 2.5s ease-in-out infinite;
  }

  @keyframes quiz-shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }

  #MilauraQuiz-{{ section.id }} .quiz-question-card {
    /* Le halo est gÃ©rÃ© par le conteneur parent .milaura-section-card */
    background: transparent;
    border: none;
    border-radius: 0;
    padding: 0;
    box-shadow: none;
  }

  #MilauraQuiz-{{ section.id }} .quiz-question-title {
    font-family: var(--milaura-font-heading);
    color: var(--milaura-text);
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: var(--milaura-spacing-md);
    text-align: center;
    line-height: 1.3;
  }

  #MilauraQuiz-{{ section.id }} .quiz-answers {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--milaura-spacing-md);
    margin-top: var(--milaura-spacing-lg);
  }

  #MilauraQuiz-{{ section.id }} .quiz-answer-btn {
    background: rgba(255, 255, 255, 0.85);
    backdrop-filter: blur(15px) saturate(160%);
    -webkit-backdrop-filter: blur(15px) saturate(160%);
    border: 2px solid rgba(192, 160, 98, 0.4);
    border-radius: var(--milaura-border-radius-sm);
    padding: var(--milaura-spacing-md);
    font-family: var(--milaura-font-body);
    color: var(--milaura-text);
    font-size: 1.15rem;
    font-weight: 600;
    cursor: pointer;
    text-align: center;
    min-height: 95px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 8px 24px rgba(192, 160, 98, 0.1);
    /* Staggered entrance animation */
    opacity: 0;
    transform: translateY(20px);
    transition:
      opacity 380ms cubic-bezier(0.22, 1, 0.36, 1),
      transform 520ms cubic-bezier(0.22, 1, 0.36, 1),
      border-color 260ms ease,
      box-shadow 260ms ease,
      background 260ms ease;
  }

  #MilauraQuiz-{{ section.id }} .quiz-answer-btn.is-visible {
    opacity: 1;
    transform: translateY(0);
  }

  #MilauraQuiz-{{ section.id }} .quiz-answer-btn:hover {
    background: rgba(255, 255, 255, 0.95);
    border-color: rgba(192, 160, 98, 0.6);
    transform: translateY(-2px);
    box-shadow: 0 12px 32px rgba(192, 160, 98, 0.2);
  }

  #MilauraQuiz-{{ section.id }} .quiz-answer-btn:active {
    transform: translateY(0);
  }

  /* Pulse + gold border on click */
  #MilauraQuiz-{{ section.id }} .quiz-answer-btn.is-selected {
    animation: quiz-answer-pulse 600ms cubic-bezier(0.34, 1.56, 0.64, 1);
    border-color: var(--milaura-gold);
    background: rgba(255, 248, 225, 0.9);
    box-shadow:
      0 0 0 4px rgba(192, 160, 98, 0.3),
      var(--milaura-shadow-md);
  }

  @keyframes quiz-answer-pulse {
    0% {
      transform: scale(1);
      box-shadow: 0 0 0 0 rgba(192, 160, 98, 0);
    }
    40% {
      transform: scale(1.05);
      box-shadow: 0 0 0 8px rgba(192, 160, 98, 0.4);
    }
    100% {
      transform: scale(1);
      box-shadow: 0 0 0 4px rgba(192, 160, 98, 0.3);
    }
  }

  /* --- Ã‰TAT : TRANSITION --- */
  #MilauraQuiz-{{ section.id }} .quiz-transition-card {
    /* Le halo est gÃ©rÃ© par le conteneur parent .milaura-section-card */
    background: transparent;
    border: none;
    border-radius: 0;
    padding: 0;
    box-shadow: none;
    text-align: center;
    min-height: 300px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  #MilauraQuiz-{{ section.id }} .quiz-transition-title {
    font-family: var(--milaura-font-heading);
    color: var(--milaura-gold);
    font-size: 2.2rem;
    font-weight: 700;
    margin-bottom: var(--milaura-spacing-md);
    line-height: 1.3;
  }

  #MilauraQuiz-{{ section.id }} .quiz-transition-subtitle {
    font-family: var(--milaura-font-script);
    color: var(--milaura-text);
    font-size: 1.5rem;
    margin-bottom: var(--milaura-spacing-lg);
  }

  #MilauraQuiz-{{ section.id }} .quiz-transition-body {
    font-family: var(--milaura-font-body);
    color: var(--milaura-text);
    font-size: 1.1rem;
    line-height: 1.7;
    max-width: 600px;
    margin: 0 auto;
  }

  #MilauraQuiz-{{ section.id }} .quiz-loader {
    display: flex;
    gap: 10px;
    margin-top: var(--milaura-spacing-lg);
    justify-content: center;
  }

  #MilauraQuiz-{{ section.id }} .quiz-loader-dot {
    width: 12px;
    height: 12px;
    background: var(--milaura-gold);
    border-radius: 50%;
    animation: quiz-loader-float 1.6s ease-in-out infinite;
  }

  #MilauraQuiz-{{ section.id }} .quiz-loader-dot:nth-child(2) {
    animation-delay: 0.3s;
  }

  #MilauraQuiz-{{ section.id }} .quiz-loader-dot:nth-child(3) {
    animation-delay: 0.6s;
  }

  @keyframes quiz-loader-float {
    0%, 100% {
      opacity: 0.4;
      transform: translateY(0) scale(1);
    }
    50% {
      opacity: 1;
      transform: translateY(-12px) scale(1.3);
    }
  }

  /* Fade text during loading */
  #MilauraQuiz-{{ section.id }} .quiz-transition-body,
  #MilauraQuiz-{{ section.id }} .quiz-transition-subtitle {
    animation: quiz-text-pulse 2.4s ease-in-out infinite;
  }

  @keyframes quiz-text-pulse {
    0%, 100% { opacity: 0.7; }
    50% { opacity: 1; }
  }

  /* ============================================
     Ã‰TAT : RESULT - EFFET "MENTALIST" REVEAL
     Progressive disclosure mobile-first
     ============================================ */

  /* Container principal - Single column mobile-first */
  #MilauraQuiz-{{ section.id }} .quiz-reveal-container {
    max-width: 500px;
    margin: 0 auto;
    width: 100%;
  }

  /* Phase reveal system - Hidden by default */
  #MilauraQuiz-{{ section.id }} .reveal-phase {
    opacity: 0;
    transform: translateY(20px);
    transition:
      opacity 500ms cubic-bezier(0.22, 1, 0.36, 1),
      transform 600ms cubic-bezier(0.22, 1, 0.36, 1);
  }

  #MilauraQuiz-{{ section.id }} .reveal-phase.is-revealed {
    opacity: 1;
    transform: translateY(0);
  }

  /* === PHASE 1 : HEADER MYSTIQUE === */
  #MilauraQuiz-{{ section.id }} .quiz-reveal-header {
    text-align: center;
    margin-bottom: var(--milaura-spacing-lg);
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-kicker {
    font-family: var(--milaura-font-script);
    color: var(--milaura-gold);
    font-size: 1.4rem;
    margin-bottom: var(--milaura-spacing-sm);
    letter-spacing: 0.5px;
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-profile-name {
    font-family: var(--milaura-font-heading);
    color: var(--milaura-text);
    font-size: 2.2rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 3px;
    line-height: 1.2;
  }

  /* === PHASE 2 : CARTE PRINCIPALE (Cold Reading + Produit + CTA) === */
  #MilauraQuiz-{{ section.id }} .quiz-reveal-main {
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(25px) saturate(180%);
    -webkit-backdrop-filter: blur(25px) saturate(180%);
    border: 1px solid rgba(192, 160, 98, 0.25);
    border-radius: var(--milaura-border-radius);
    padding: var(--milaura-spacing-lg);
    box-shadow:
      0 15px 50px rgba(192, 160, 98, 0.12),
      inset 0 1px 0 rgba(255, 255, 255, 0.7);
    position: relative;
    overflow: hidden;
    margin-bottom: var(--milaura-spacing-md);
  }

  /* Bordure dorÃ©e en haut */
  #MilauraQuiz-{{ section.id }} .quiz-reveal-main::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--milaura-gold), var(--milaura-gold-light), var(--milaura-gold));
  }

  /* Cold reading description - Italique Ã©motionnel */
  #MilauraQuiz-{{ section.id }} .quiz-reveal-reading {
    font-family: var(--milaura-font-body);
    color: var(--milaura-text);
    font-size: 1.05rem;
    font-style: italic;
    line-height: 1.75;
    text-align: center;
    margin-bottom: var(--milaura-spacing-lg);
    padding-bottom: var(--milaura-spacing-md);
    border-bottom: 1px solid rgba(192, 160, 98, 0.15);
  }

  /* Badge "Ton AlliÃ© Vibratoire" */
  #MilauraQuiz-{{ section.id }} .quiz-reveal-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: linear-gradient(135deg, var(--milaura-gold), var(--milaura-gold-light));
    color: #fff;
    font-family: var(--milaura-font-body);
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    padding: 8px 16px;
    border-radius: 25px;
    margin-bottom: var(--milaura-spacing-md);
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-badge::before {
    content: 'âŸ¡';
    font-size: 0.9rem;
  }

  /* Section produit centrÃ©e */
  #MilauraQuiz-{{ section.id }} .quiz-reveal-product {
    text-align: center;
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-product-image {
    width: 100%;
    max-width: 280px;
    aspect-ratio: 1;
    object-fit: cover;
    border-radius: var(--milaura-border-radius-sm);
    margin: 0 auto var(--milaura-spacing-md);
    display: block;
    border: 2px solid rgba(192, 160, 98, 0.2);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-product-image:hover {
    transform: scale(1.02);
    box-shadow: 0 15px 40px rgba(192, 160, 98, 0.2);
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-product-title {
    font-family: var(--milaura-font-heading);
    color: var(--milaura-text);
    font-size: 1.4rem;
    font-weight: 700;
    margin-bottom: 6px;
    line-height: 1.3;
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-product-price {
    font-family: var(--milaura-font-heading);
    color: var(--milaura-gold);
    font-size: 1.8rem;
    font-weight: 700;
    margin-bottom: var(--milaura-spacing-md);
  }

  /* CTA Principal - Pleine largeur */
  #MilauraQuiz-{{ section.id }} .quiz-reveal-cta-primary {
    display: block;
    width: 100%;
    background: linear-gradient(135deg, var(--milaura-gold), var(--milaura-gold-dark));
    color: #fff !important;
    font-family: var(--milaura-font-body);
    font-size: 1.1rem;
    font-weight: 700;
    text-align: center;
    text-decoration: none !important;
    padding: 18px 28px;
    border-radius: var(--milaura-border-radius-sm);
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 6px 20px rgba(192, 160, 98, 0.4);
    margin-bottom: var(--milaura-spacing-sm);
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-cta-primary:hover {
    transform: translateY(-3px);
    box-shadow: 0 10px 30px rgba(192, 160, 98, 0.5);
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-cta-primary:active {
    transform: translateY(-1px);
  }

  /* CTA Secondaire */
  #MilauraQuiz-{{ section.id }} .quiz-reveal-cta-secondary {
    display: block;
    width: 100%;
    background: transparent;
    color: var(--milaura-gold) !important;
    font-family: var(--milaura-font-body);
    font-size: 0.95rem;
    font-weight: 600;
    text-align: center;
    text-decoration: none !important;
    padding: 12px;
    border: none;
    cursor: pointer;
    transition: color 0.3s ease;
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-cta-secondary:hover {
    color: var(--milaura-gold-dark) !important;
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-cta-secondary span {
    text-decoration: underline;
  }

  /* === PHASE 3 : ACCORDÃ‰ONS EXPANDABLES === */
  #MilauraQuiz-{{ section.id }} .quiz-reveal-accordions {
    margin-bottom: var(--milaura-spacing-md);
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-accordion {
    background: rgba(255, 255, 255, 0.6);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    border: 1px solid rgba(192, 160, 98, 0.2);
    border-radius: var(--milaura-border-radius-sm);
    margin-bottom: var(--milaura-spacing-sm);
    overflow: hidden;
    transition: all 0.3s ease;
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-accordion:hover {
    border-color: rgba(192, 160, 98, 0.35);
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-accordion summary {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--milaura-spacing-md);
    cursor: pointer;
    font-family: var(--milaura-font-heading);
    color: var(--milaura-gold);
    font-size: 1rem;
    font-weight: 600;
    list-style: none;
    transition: background 0.2s ease;
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-accordion summary::-webkit-details-marker {
    display: none;
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-accordion summary::after {
    content: '+';
    font-size: 1.4rem;
    font-weight: 300;
    color: var(--milaura-gold);
    transition: transform 0.3s ease;
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-accordion[open] summary::after {
    transform: rotate(45deg);
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-accordion summary:hover {
    background: rgba(192, 160, 98, 0.05);
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-accordion-content {
    padding: 0 var(--milaura-spacing-md) var(--milaura-spacing-md);
    font-family: var(--milaura-font-body);
    color: var(--milaura-text);
    font-size: 0.95rem;
    line-height: 1.7;
  }

  /* Duo Pierre + Senteur dans accordÃ©on */
  #MilauraQuiz-{{ section.id }} .quiz-reveal-duo {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--milaura-spacing-sm);
    margin-bottom: var(--milaura-spacing-md);
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-duo-item {
    background: rgba(255, 255, 255, 0.5);
    border-radius: var(--milaura-border-radius-sm);
    padding: var(--milaura-spacing-sm);
    text-align: center;
    border: 1px solid rgba(192, 160, 98, 0.15);
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-duo-icon {
    font-size: 1.6rem;
    margin-bottom: 4px;
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-duo-label {
    font-family: var(--milaura-font-body);
    color: var(--milaura-gold);
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 2px;
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-duo-name {
    font-family: var(--milaura-font-heading);
    color: var(--milaura-text);
    font-size: 1rem;
    font-weight: 600;
  }

  /* BÃ©nÃ©fices dans accordÃ©on */
  #MilauraQuiz-{{ section.id }} .quiz-reveal-benefits {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-benefits li {
    padding-left: 24px;
    position: relative;
    margin-bottom: 8px;
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-benefits li::before {
    content: 'âœ§';
    position: absolute;
    left: 0;
    color: var(--milaura-gold);
    font-size: 0.9rem;
  }

  /* Mantra dans accordÃ©on rituel */
  #MilauraQuiz-{{ section.id }} .quiz-reveal-mantra {
    font-family: var(--milaura-font-script);
    color: var(--milaura-gold);
    font-size: 1.2rem;
    text-align: center;
    margin-bottom: var(--milaura-spacing-md);
    padding: var(--milaura-spacing-sm);
    background: linear-gradient(135deg, rgba(192, 160, 98, 0.06), rgba(192, 160, 98, 0.12));
    border-radius: var(--milaura-border-radius-sm);
    border-left: 3px solid var(--milaura-gold);
  }

  /* Rituel dans accordÃ©on */
  #MilauraQuiz-{{ section.id }} .quiz-reveal-ritual {
    font-family: var(--milaura-font-body);
    color: var(--milaura-text);
    font-size: 0.95rem;
    line-height: 1.7;
    white-space: pre-line;
  }

  /* === PHASE 4 : MÃ‰TÃ‰O Ã‰MOTIONNELLE (Mini-jauges) === */
  #MilauraQuiz-{{ section.id }} .quiz-reveal-mood {
    background: rgba(255, 255, 255, 0.5);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    border: 1px solid rgba(192, 160, 98, 0.15);
    border-radius: var(--milaura-border-radius-sm);
    padding: var(--milaura-spacing-md);
    margin-bottom: var(--milaura-spacing-md);
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-mood-title {
    font-family: var(--milaura-font-heading);
    color: var(--milaura-gold);
    font-size: 0.9rem;
    font-weight: 600;
    text-align: center;
    margin-bottom: var(--milaura-spacing-sm);
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-mood-gauges {
    display: flex;
    gap: 8px;
    justify-content: center;
    flex-wrap: wrap;
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-mood-mini {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    min-width: 50px;
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-mood-mini-icon {
    font-size: 1.1rem;
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-mood-mini-bar {
    width: 40px;
    height: 6px;
    background: rgba(192, 160, 98, 0.15);
    border-radius: 3px;
    overflow: hidden;
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-mood-mini-fill {
    height: 100%;
    border-radius: 3px;
    transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-mood-mini-fill.is-winner {
    background: linear-gradient(90deg, var(--milaura-gold), var(--milaura-gold-light));
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-mood-mini-fill:not(.is-winner) {
    background: rgba(192, 160, 98, 0.35);
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-mood-mini-percent {
    font-family: var(--milaura-font-body);
    font-size: 0.7rem;
    color: var(--milaura-text-light, #666);
  }

  /* === FOOTER === */
  #MilauraQuiz-{{ section.id }} .quiz-reveal-footer {
    text-align: center;
    padding-top: var(--milaura-spacing-md);
    border-top: 1px solid rgba(192, 160, 98, 0.1);
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-restart {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    color: var(--milaura-gold);
    font-family: var(--milaura-font-body);
    font-size: 0.9rem;
    font-weight: 600;
    text-decoration: none;
    padding: 12px 24px;
    border: 1px solid rgba(192, 160, 98, 0.4);
    border-radius: var(--milaura-border-radius-sm);
    background: transparent;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-restart:hover {
    background: rgba(192, 160, 98, 0.08);
    border-color: var(--milaura-gold);
  }

  /* Invitation compte (pour guests) */
  #MilauraQuiz-{{ section.id }} .quiz-reveal-account-invite {
    margin-top: var(--milaura-spacing-md);
    padding-top: var(--milaura-spacing-sm);
    text-align: center;
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-account-text {
    font-family: var(--milaura-font-body);
    color: var(--milaura-text-light, #666);
    font-size: 0.85rem;
    margin-bottom: 6px;
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-account-link {
    display: inline-block;
    color: var(--milaura-gold);
    font-weight: 600;
    font-size: 0.85rem;
    text-decoration: underline;
    transition: color 0.3s ease;
  }

  #MilauraQuiz-{{ section.id }} .quiz-reveal-account-link:hover {
    color: var(--milaura-gold-dark);
  }

  /* --- LIEN DERNIÃˆRE RÃ‰VÃ‰LATION --- */
  #MilauraQuiz-{{ section.id }} .quiz-last-result-link {
    text-align: center;
    margin-bottom: var(--milaura-spacing-md);
  }

  #MilauraQuiz-{{ section.id }} .quiz-last-result-link a {
    font-family: var(--milaura-font-body);
    color: var(--milaura-gold);
    text-decoration: none;
    font-size: 0.95rem;
    font-weight: 600;
    text-decoration: underline;
    transition: color 0.3s ease;
  }

  #MilauraQuiz-{{ section.id }} .quiz-last-result-link a:hover {
    color: var(--milaura-gold-dark);
  }

  /* --- DESKTOP : Center the reveal container --- */
  @media screen and (min-width: 769px) {
    #MilauraQuiz-{{ section.id }} .quiz-reveal-container {
      max-width: 560px;
    }

    #MilauraQuiz-{{ section.id }} .quiz-reveal-profile-name {
      font-size: 2.5rem;
    }

    #MilauraQuiz-{{ section.id }} .quiz-reveal-reading {
      font-size: 1.1rem;
    }

    #MilauraQuiz-{{ section.id }} .quiz-reveal-product-image {
      max-width: 320px;
    }
  }

  /* --- MOBILE --- */
  @media screen and (max-width: 990px) {
    #MilauraQuiz-{{ section.id }} {
      padding: var(--milaura-spacing-sm) var(--milaura-spacing-xs);
      margin-top: var(--milaura-spacing-sm);
      margin-bottom: var(--milaura-spacing-sm);
    }

    #MilauraQuiz-{{ section.id }} .quiz-intro-title {
      font-size: 1.8rem;
      margin-bottom: var(--milaura-spacing-sm);
    }

    #MilauraQuiz-{{ section.id }} .quiz-intro-subtitle {
      font-size: 1rem;
      margin-bottom: var(--milaura-spacing-sm);
      line-height: 1.4;
    }

    #MilauraQuiz-{{ section.id }} .quiz-expert-block {
      flex-direction: row;
      text-align: left;
      padding: var(--milaura-spacing-sm);
      margin: var(--milaura-spacing-sm) 0;
      gap: var(--milaura-spacing-sm);
    }

    #MilauraQuiz-{{ section.id }} .quiz-expert-image {
      width: 65px;
      height: 65px;
    }

    #MilauraQuiz-{{ section.id }} .quiz-expert-name {
      font-size: 1rem;
      margin-bottom: 2px;
    }

    #MilauraQuiz-{{ section.id }} .quiz-expert-title {
      font-size: 0.85rem;
      margin-bottom: 4px;
    }

    #MilauraQuiz-{{ section.id }} .quiz-expert-text {
      font-size: 0.95rem;
      line-height: 1.3;
    }

    #MilauraQuiz-{{ section.id }} .quiz-answers {
      grid-template-columns: 1fr;
      gap: var(--milaura-spacing-sm);
      margin-top: var(--milaura-spacing-sm);
    }

    #MilauraQuiz-{{ section.id }} .quiz-answer-btn {
      min-height: 75px;
      padding: var(--milaura-spacing-sm);
    }

    #MilauraQuiz-{{ section.id }} .quiz-transition-title {
      font-size: 1.6rem;
    }

    #MilauraQuiz-{{ section.id }} .quiz-transition-subtitle {
      font-size: 1.2rem;
    }

    #MilauraQuiz-{{ section.id }} .quiz-questions-header {
      padding: var(--milaura-spacing-sm);
      margin-bottom: var(--milaura-spacing-sm);
    }

    #MilauraQuiz-{{ section.id }} .quiz-question-title {
      font-size: 1.6rem;
      margin-bottom: var(--milaura-spacing-sm);
    }

    /* Mobile reveal styles */
    #MilauraQuiz-{{ section.id }} .quiz-reveal-profile-name {
      font-size: 1.8rem;
      letter-spacing: 2px;
    }

    #MilauraQuiz-{{ section.id }} .quiz-reveal-kicker {
      font-size: 1.2rem;
    }

    #MilauraQuiz-{{ section.id }} .quiz-reveal-main {
      padding: var(--milaura-spacing-md);
    }

    #MilauraQuiz-{{ section.id }} .quiz-reveal-reading {
      font-size: 1rem;
    }

    #MilauraQuiz-{{ section.id }} .quiz-reveal-product-image {
      max-width: 220px;
    }

    #MilauraQuiz-{{ section.id }} .quiz-reveal-product-title {
      font-size: 1.2rem;
    }

    #MilauraQuiz-{{ section.id }} .quiz-reveal-product-price {
      font-size: 1.5rem;
    }

    #MilauraQuiz-{{ section.id }} .quiz-reveal-cta-primary {
      padding: 16px 20px;
      font-size: 1rem;
    }
  }

  @media screen and (max-width: 480px) {
    #MilauraQuiz-{{ section.id }} {
      padding: var(--milaura-spacing-xs) var(--milaura-spacing-xs);
    }

    #MilauraQuiz-{{ section.id }} .quiz-intro-title {
      font-size: 1.7rem;
    }

    #MilauraQuiz-{{ section.id }} .quiz-intro-subtitle {
      font-size: 1rem;
    }

    #MilauraQuiz-{{ section.id }} .quiz-expert-image {
      width: 55px;
      height: 55px;
    }

    #MilauraQuiz-{{ section.id }} .quiz-question-title {
      font-size: 1.4rem;
    }

    #MilauraQuiz-{{ section.id }} .quiz-answer-btn {
      min-height: 65px;
      font-size: 1rem;
    }

    #MilauraQuiz-{{ section.id }} .quiz-transition-title {
      font-size: 1.5rem;
    }

    /* Small mobile reveal styles */
    #MilauraQuiz-{{ section.id }} .quiz-reveal-profile-name {
      font-size: 1.5rem;
      letter-spacing: 1.5px;
    }

    #MilauraQuiz-{{ section.id }} .quiz-reveal-kicker {
      font-size: 1.1rem;
    }

    #MilauraQuiz-{{ section.id }} .quiz-reveal-product-price {
      font-size: 1.3rem;
    }

    #MilauraQuiz-{{ section.id }} .quiz-reveal-cta-primary {
      padding: 14px 18px;
      font-size: 0.95rem;
    }

    #MilauraQuiz-{{ section.id }} .quiz-reveal-mood-mini {
      min-width: 45px;
    }

    #MilauraQuiz-{{ section.id }} .quiz-reveal-mood-mini-bar {
      width: 35px;
    }
  }

  /* ============================================
     PERFORMANCE OPTIMIZATIONS
     ============================================ */

  /* GPU acceleration hints for animated elements */
  #MilauraQuiz-{{ section.id }} .quiz-state,
  #MilauraQuiz-{{ section.id }} .quiz-answer-btn,
  #MilauraQuiz-{{ section.id }} .reveal-phase,
  #MilauraQuiz-{{ section.id }} .quiz-progress-fill {
    will-change: transform, opacity;
  }

  /* Cleanup will-change after animation completes */
  #MilauraQuiz-{{ section.id }} .quiz-state.is-active,
  #MilauraQuiz-{{ section.id }} .quiz-answer-btn.is-visible,
  #MilauraQuiz-{{ section.id }} .reveal-phase.is-revealed {
    will-change: auto;
  }

  /* ============================================
     ACCESSIBILITY - REDUCED MOTION
     ============================================ */
  @media (prefers-reduced-motion: reduce) {
    #MilauraQuiz-{{ section.id }} *,
    #MilauraQuiz-{{ section.id }} *::before,
    #MilauraQuiz-{{ section.id }} *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }

  /* Fallback for browsers without backdrop-filter support */
  @supports not (backdrop-filter: blur(1px)) {
    #MilauraQuiz-{{ section.id }} .quiz-expert-block,
    #MilauraQuiz-{{ section.id }} .quiz-answer-btn,
    #MilauraQuiz-{{ section.id }} .quiz-reveal-main,
    #MilauraQuiz-{{ section.id }} .quiz-reveal-accordion,
    #MilauraQuiz-{{ section.id }} .quiz-reveal-mood {
      backdrop-filter: none !important;
      -webkit-backdrop-filter: none !important;
      background: rgba(255, 255, 255, 0.95) !important;
    }
  }
{% endstyle %}

<div id="MilauraQuiz-{{ section.id }}">
  <div class="quiz-container milaura-section-card">
    <!-- Lien derniÃ¨re rÃ©vÃ©lation (si existe) -->
    <div class="quiz-last-result-link" id="quiz-last-result-link-{{ section.id }}" style="display: none;">
      <a href="#" id="quiz-show-last-{{ section.id }}">Revoir ma derniÃ¨re rÃ©vÃ©lation âœ¨</a>
    </div>

    <!-- Ã‰TAT 1 : INTRO -->
    <div class="quiz-state quiz-state-intro" data-state="intro">
      <div class="quiz-intro-card">
        {% if section.settings.intro_title != blank %}
          <h2 class="quiz-intro-title milaura-heading">{{ section.settings.intro_title }}</h2>
        {% endif %}

        {% if section.settings.intro_subtitle != blank %}
          <div class="quiz-intro-subtitle milaura-text">{{ section.settings.intro_subtitle }}</div>
        {% endif %}

        {% if section.settings.show_expert and section.settings.expert_image != blank %}
          <div class="quiz-expert-block">
            <img
              src="{{ section.settings.expert_image | image_url: width: 200 }}"
              alt="{{ section.settings.expert_name }}"
              class="quiz-expert-image"
              width="200"
              height="200"
            >
            <div class="quiz-expert-info">
              {% if section.settings.expert_name != blank %}
                <div class="quiz-expert-name">{{ section.settings.expert_name }}</div>
              {% endif %}
              {% if section.settings.expert_title != blank %}
                <div class="quiz-expert-title">{{ section.settings.expert_title }}</div>
              {% endif %}
              {% if section.settings.expert_text != blank %}
                <div class="quiz-expert-text milaura-text">{{ section.settings.expert_text }}</div>
              {% endif %}
            </div>
          </div>
        {% endif %}

        {% if section.settings.intro_button_label != blank %}
          <button
            type="button"
            class="milaura-cta"
            id="quiz-start-btn-{{ section.id }}"
          >
            {{ section.settings.intro_button_label }}
          </button>
        {% endif %}
      </div>
    </div>

    <!-- Ã‰TAT 2 : QUESTIONS -->
    <div class="quiz-state quiz-state-questions" data-state="questions" style="display: none;">
      <div class="quiz-questions-header">
        <div class="quiz-progress-text" id="quiz-progress-text-{{ section.id }}">Question 1 sur 7</div>
        <div class="quiz-progress-bar">
          <div class="quiz-progress-fill" id="quiz-progress-fill-{{ section.id }}" style="width: 14.28%;"></div>
        </div>
      </div>

      <div class="quiz-question-card">
        <h3 class="quiz-question-title" id="quiz-question-title-{{ section.id }}"></h3>
        <div class="quiz-answers" id="quiz-answers-{{ section.id }}"></div>
      </div>
    </div>

    <!-- Ã‰TAT 3 : TRANSITION -->
    <div class="quiz-state quiz-state-transition" data-state="transition" style="display: none;">
      <div class="quiz-transition-card">
        {% if section.settings.transition_title != blank %}
          <h2 class="quiz-transition-title milaura-heading">{{ section.settings.transition_title }}</h2>
        {% endif %}

        {% if section.settings.transition_subtitle != blank %}
          <div class="quiz-transition-subtitle milaura-heading-script">{{ section.settings.transition_subtitle }}</div>
        {% endif %}

        {% if section.settings.transition_body != blank %}
          <div class="quiz-transition-body milaura-text">{{ section.settings.transition_body }}</div>
        {% endif %}

        <div class="quiz-loader">
          <div class="quiz-loader-dot"></div>
          <div class="quiz-loader-dot"></div>
          <div class="quiz-loader-dot"></div>
        </div>
      </div>
    </div>

    <!-- Ã‰TAT 4 : RESULT - EFFET "MENTALIST" REVEAL -->
    <div class="quiz-state quiz-state-result" data-state="result" style="display: none;">
      <div class="quiz-reveal-container">

        <!-- PHASE 1 : Header Mystique (rÃ©vÃ©lÃ© Ã  0ms) -->
        <div class="quiz-reveal-header reveal-phase" data-reveal-phase="1">
          <div class="quiz-reveal-kicker" id="quiz-reveal-kicker-{{ section.id }}">{{ section.settings.result_kicker | default: "Ce que ton Ã¢me murmure..." }}</div>
          <h2 class="quiz-reveal-profile-name" id="quiz-reveal-profile-name-{{ section.id }}"></h2>
        </div>

        <!-- PHASE 2 : Carte Principale (rÃ©vÃ©lÃ©e Ã  200ms) -->
        <div class="quiz-reveal-main reveal-phase" data-reveal-phase="2">
          <!-- Cold reading description -->
          <div class="quiz-reveal-reading" id="quiz-reveal-reading-{{ section.id }}">
            <!-- InjectÃ© par JS : description cold reading -->
          </div>

          <!-- Section produit -->
          <div class="quiz-reveal-product">
            <div class="quiz-reveal-badge" id="quiz-reveal-badge-{{ section.id }}">Ton AlliÃ© Vibratoire</div>
            <div id="quiz-reveal-product-content-{{ section.id }}">
              <!-- InjectÃ© par JS : image produit -->
            </div>
            <h3 class="quiz-reveal-product-title" id="quiz-reveal-product-title-{{ section.id }}"></h3>
            <div class="quiz-reveal-product-price" id="quiz-reveal-product-price-{{ section.id }}"></div>

            <!-- CTA Principal -->
            <div id="quiz-reveal-cta-{{ section.id }}">
              <!-- InjectÃ© par JS : boutons CTA -->
            </div>
          </div>
        </div>

        <!-- PHASE 3 : AccordÃ©ons Expandables (rÃ©vÃ©lÃ©s Ã  400ms et 600ms) -->
        <div class="quiz-reveal-accordions">
          <!-- AccordÃ©on 1 : L'Alchimie du Duo -->
          <details class="quiz-reveal-accordion reveal-phase" data-reveal-phase="3">
            <summary id="quiz-reveal-accordion-duo-label-{{ section.id }}">{{ section.settings.accordion_duo_label | default: "L'Alchimie du Duo" }}</summary>
            <div class="quiz-reveal-accordion-content">
              <!-- Duo Pierre + Senteur -->
              <div class="quiz-reveal-duo">
                <div class="quiz-reveal-duo-item">
                  <div class="quiz-reveal-duo-icon">ðŸ’Ž</div>
                  <div class="quiz-reveal-duo-label">Ta pierre</div>
                  <div class="quiz-reveal-duo-name" id="quiz-reveal-stone-{{ section.id }}">-</div>
                </div>
                <div class="quiz-reveal-duo-item">
                  <div class="quiz-reveal-duo-icon">ðŸŒ¸</div>
                  <div class="quiz-reveal-duo-label">Ta senteur</div>
                  <div class="quiz-reveal-duo-name" id="quiz-reveal-scent-{{ section.id }}">-</div>
                </div>
              </div>
              <!-- BÃ©nÃ©fices -->
              <ul class="quiz-reveal-benefits" id="quiz-reveal-benefits-{{ section.id }}">
                <!-- InjectÃ© par JS -->
              </ul>
            </div>
          </details>

          <!-- AccordÃ©on 2 : Ton Rituel de Connexion -->
          <details class="quiz-reveal-accordion reveal-phase" data-reveal-phase="4">
            <summary id="quiz-reveal-accordion-ritual-label-{{ section.id }}">{{ section.settings.accordion_ritual_label | default: "Ton Rituel de Connexion" }}</summary>
            <div class="quiz-reveal-accordion-content">
              <!-- Mantra -->
              <div class="quiz-reveal-mantra" id="quiz-reveal-mantra-{{ section.id }}">
                <!-- InjectÃ© par JS -->
              </div>
              <!-- Rituel -->
              <div class="quiz-reveal-ritual" id="quiz-reveal-ritual-{{ section.id }}">
                <!-- InjectÃ© par JS -->
              </div>
            </div>
          </details>
        </div>

        <!-- PHASE 4 : MÃ©tÃ©o Ã‰motionnelle Mini (rÃ©vÃ©lÃ©e Ã  800ms) -->
        <div class="quiz-reveal-mood reveal-phase" data-reveal-phase="5">
          <div class="quiz-reveal-mood-title">Ta MÃ©tÃ©o Ã‰motionnelle</div>
          <div class="quiz-reveal-mood-gauges" id="quiz-reveal-mood-gauges-{{ section.id }}">
            <!-- InjectÃ© par JS : mini-jauges par Ã©motion -->
          </div>
        </div>

        <!-- Footer -->
        <div class="quiz-reveal-footer reveal-phase" data-reveal-phase="5">
          <button type="button" class="quiz-reveal-restart" id="quiz-restart-btn-{{ section.id }}">
            <span>â†º</span> Refaire mon diagnostic
          </button>

          <!-- Invitation compte (pour guests) -->
          <div class="quiz-reveal-account-invite" id="quiz-reveal-account-invite-{{ section.id }}">
            <p class="quiz-reveal-account-text">Sauvegarde ton profil Ã©motionnel</p>
            <a href="/account/register" class="quiz-reveal-account-link">CrÃ©er mon compte â†’</a>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<script>
  (function() {
    const sectionId = '{{ section.id }}';
    const container = document.querySelector('#MilauraQuiz-' + sectionId);
    if (!container) return;

    // ============================================
    // STATE MACHINE
    // ============================================
    const QuizState = {
      INTRO: 'intro',
      QUESTIONS: 'questions',
      TRANSITION: 'transition',
      RESULT: 'result'
    };

    let currentState = QuizState.INTRO;
    let currentQuestionIndex = 0;
    let scores = {
      apaisement: 0,
      protection: 0,
      serenite: 0,
      amour: 0,
      chance: 0
    };

    // Profils disponibles (5 profils finaux)
    const profiles = ['apaisement', 'protection', 'serenite', 'amour', 'chance'];

    // Stockage de la rÃ©ponse Ã  la question 7 pour rÃ¨gle anti-Ã©galitÃ©
    let question7Answer = null;

    // DonnÃ©es des profils avec textes "lecture Ã  froid"
    const profileData = {
      apaisement: {
        label: "Apaisement",
        displayName: "Apaisement",
        moodLabel: "Trop plein Ã©motionnel",
        dashboardTitle: "En ce moment, ton besoin numÃ©ro 1, c'est de te retrouver",
        description: "Tu tiens, tu avances, tu gÃ¨res, mais Ã  l'intÃ©rieur Ã§a ne se pose pas vraiment. Tu peux sourire et pourtant sentir la pression monter d'un coup, souvent le soir, parfois pour Â« rien Â». Ce que tu cherches, c'est une descente immÃ©diate, une sensation de douceur qui te remet dans ton corps.",
        bullets: "<ul><li>Apaisement immÃ©diat</li><li>Douceur Ã©motionnelle</li><li>Sensation de cocon</li></ul>",
        ritual: "1. Allume, puis inspire lentement 3 fois.\n2. RelÃ¢che la mÃ¢choire, les Ã©paules, la langue.\n3. Dis-toi : Â« Je peux ralentir maintenant. Â»",
        stone: "CalcÃ©doine bleue",
        scent: "NÃ©roli",
        icon: "ðŸ’™",
        product: {% if section.settings.profile_apaisement_product %}{
          title: {{ section.settings.profile_apaisement_product.title | json }},
          url: {{ section.settings.profile_apaisement_product.url | json }},
          price: {{ section.settings.profile_apaisement_product.price | money | json }},
          featured_image: {% if section.settings.profile_apaisement_product.featured_image %}{{ section.settings.profile_apaisement_product.featured_image | image_url: width: 600 | json }}{% else %}null{% endif %},
          handle: {{ section.settings.profile_apaisement_product.handle | json }},
          variant_id: {% if section.settings.profile_apaisement_product.selected_or_first_available_variant %}{{ section.settings.profile_apaisement_product.selected_or_first_available_variant.id | json }}{% else %}null{% endif %}
        }{% else %}null{% endif %}
      },
      protection: {
        label: "Protection",
        displayName: "Protection",
        moodLabel: "Limites et bouclier",
        dashboardTitle: "Ton Ã©nergie est en mode protection, tu as besoin de limites nettes",
        description: "En ce moment tu ressens vite quand quelque chose te prend de l'Ã©nergie. Tu peux Ãªtre trÃ¨s fort(e), mais tu sais aussi que si tu laisses tout entrer, tu vas te disperser. Ce dont tu as besoin, c'est de frontiÃ¨res claires, et d'une ambiance qui coupe le bruit extÃ©rieur.",
        bullets: "<ul><li>Sensation de bouclier</li><li>Ancrage et stabilitÃ©</li><li>Recentrage immÃ©diat</li></ul>",
        ritual: "1. Allume, puis fais un mini geste de reprise de territoire : ranger un objet, Ã©teindre une notif.\n2. Imagine une bulle autour de toi.\n3. Dis-toi : Â« Je protÃ¨ge mon Ã©nergie. Â»",
        stone: "Obsidienne noire",
        scent: "Bois d'oud",
        icon: "ðŸ–¤",
        product: {% if section.settings.profile_protection_product %}{
          title: {{ section.settings.profile_protection_product.title | json }},
          url: {{ section.settings.profile_protection_product.url | json }},
          price: {{ section.settings.profile_protection_product.price | money | json }},
          featured_image: {% if section.settings.profile_protection_product.featured_image %}{{ section.settings.profile_protection_product.featured_image | image_url: width: 600 | json }}{% else %}null{% endif %},
          handle: {{ section.settings.profile_protection_product.handle | json }},
          variant_id: {% if section.settings.profile_protection_product.selected_or_first_available_variant %}{{ section.settings.profile_protection_product.selected_or_first_available_variant.id | json }}{% else %}null{% endif %}
        }{% else %}null{% endif %}
      },
      serenite: {
        label: "SÃ©rÃ©nitÃ©",
        displayName: "SÃ©rÃ©nitÃ©",
        moodLabel: "Brouillard mental",
        dashboardTitle: "Ton mental est trop plein, tu as besoin de clartÃ© et de silence",
        description: "Ton problÃ¨me n'est pas le manque d'envie, c'est le trop plein. Trop d'infos, trop de micro dÃ©cisions, trop de pensÃ©es qui reviennent. Tu as besoin de silence mental, pas de motivation. Cette bougie est lÃ  pour crÃ©er une piÃ¨ce Â« calme Â», Ã  l'intÃ©rieur comme autour de toi.",
        bullets: "<ul><li>Calme mental</li><li>Impression de clartÃ©</li><li>Ambiance zen et pure</li></ul>",
        ritual: "1. Allume et coupe l'Ã©cran 10 minutes.\n2. Inspire 4 secondes, expire 6 secondes, 5 fois.\n3. Dis-toi : Â« Je reviens Ã  l'essentiel. Â»",
        stone: "AmÃ©thyste",
        scent: "ThÃ© blanc",
        icon: "ðŸ’œ",
        product: {% if section.settings.profile_serenite_product %}{
          title: {{ section.settings.profile_serenite_product.title | json }},
          url: {{ section.settings.profile_serenite_product.url | json }},
          price: {{ section.settings.profile_serenite_product.price | money | json }},
          featured_image: {% if section.settings.profile_serenite_product.featured_image %}{{ section.settings.profile_serenite_product.featured_image | image_url: width: 600 | json }}{% else %}null{% endif %},
          handle: {{ section.settings.profile_serenite_product.handle | json }},
          variant_id: {% if section.settings.profile_serenite_product.selected_or_first_available_variant %}{{ section.settings.profile_serenite_product.selected_or_first_available_variant.id | json }}{% else %}null{% endif %}
        }{% else %}null{% endif %}
      },
      amour: {
        label: "Amour",
        displayName: "Amour",
        moodLabel: "Besoin de douceur",
        dashboardTitle: "Tu as besoin de douceur, pas de performance",
        description: "Tu es dur(e) avec toi, parfois sans t'en rendre compte. Tu peux donner de la douceur aux autres, mais t'oublier au passage. Ce que tu cherches lÃ , c'est un moment qui rÃ©pare le cÅ“ur, pas avec de grands mots, juste avec une sensation de chaleur et de bienveillance.",
        bullets: "<ul><li>Douceur du cÅ“ur</li><li>Compassion, amour de soi</li><li>Ambiance enveloppante et prÃ©cieuse</li></ul>",
        ritual: "1. Allume et pose une main sur le cÅ“ur.\n2. Pense Ã  une chose que tu as bien faite aujourd'hui.\n3. Dis-toi : Â« Je me parle avec douceur. Â»",
        stone: "Quartz rose",
        scent: "Ambre gris",
        icon: "ðŸ’—",
        product: {% if section.settings.profile_amour_product %}{
          title: {{ section.settings.profile_amour_product.title | json }},
          url: {{ section.settings.profile_amour_product.url | json }},
          price: {{ section.settings.profile_amour_product.price | money | json }},
          featured_image: {% if section.settings.profile_amour_product.featured_image %}{{ section.settings.profile_amour_product.featured_image | image_url: width: 600 | json }}{% else %}null{% endif %},
          handle: {{ section.settings.profile_amour_product.handle | json }},
          variant_id: {% if section.settings.profile_amour_product.selected_or_first_available_variant %}{{ section.settings.profile_amour_product.selected_or_first_available_variant.id | json }}{% else %}null{% endif %}
        }{% else %}null{% endif %}
      },
      chance: {
        label: "Chance",
        displayName: "Chance",
        moodLabel: "Envie d'un signe ou de nouveautÃ©",
        dashboardTitle: "Tu as besoin d'un signe, d'un Ã©lan, d'un petit Â« oui Â» Ã  la vie",
        description: "Tu sens que tu pourrais repartir, mais il manque une Ã©tincelle. Pas un grand changement, juste une impulsion qui remet le mouvement. Cette bougie est faite pour ouvrir le champ, remettre de l'optimisme, et te donner envie de faire ce premier petit pas.",
        bullets: "<ul><li>Optimisme et lÃ©gÃ¨retÃ©</li><li>Ã‰nergie de renouveau</li><li>Envie d'avancer</li></ul>",
        ritual: "1. Allume et ouvre une fenÃªtre 30 secondes si tu peux.\n2. Choisis une micro action de 2 minutes : un message, une note, un rangement.\n3. Dis-toi : Â« Je crÃ©e ma chance, un petit pas suffit. Â»",
        stone: "Aventurine verte",
        scent: "Fleur d'oranger",
        icon: "ðŸ’š",
        product: {% if section.settings.profile_chance_product %}{
          title: {{ section.settings.profile_chance_product.title | json }},
          url: {{ section.settings.profile_chance_product.url | json }},
          price: {{ section.settings.profile_chance_product.price | money | json }},
          featured_image: {% if section.settings.profile_chance_product.featured_image %}{{ section.settings.profile_chance_product.featured_image | image_url: width: 600 | json }}{% else %}null{% endif %},
          handle: {{ section.settings.profile_chance_product.handle | json }},
          variant_id: {% if section.settings.profile_chance_product.selected_or_first_available_variant %}{{ section.settings.profile_chance_product.selected_or_first_available_variant.id | json }}{% else %}null{% endif %}
        }{% else %}null{% endif %}
      }
    };

    // VÃ©rifier si l'utilisateur est connectÃ©
    const isCustomerLoggedIn = {{ customer | json }} !== null;

    // RÃ©cupÃ©rer les questions depuis les blocks Liquid
    const questionsData = [];
    {% for block in section.blocks %}
      {% if block.type == 'question' %}
        questionsData.push({
          id: '{{ block.id }}',
          label: {{ block.settings.question_label | json }},
          answers: [
            {% if block.settings.answer_1_label != blank %}
              { label: {{ block.settings.answer_1_label | json }}, profile: {{ block.settings.answer_1_profile | json }} },
            {% endif %}
            {% if block.settings.answer_2_label != blank %}
              { label: {{ block.settings.answer_2_label | json }}, profile: {{ block.settings.answer_2_profile | json }} },
            {% endif %}
            {% if block.settings.answer_3_label != blank %}
              { label: {{ block.settings.answer_3_label | json }}, profile: {{ block.settings.answer_3_profile | json }} },
            {% endif %}
            {% if block.settings.answer_4_label != blank %}
              { label: {{ block.settings.answer_4_label | json }}, profile: {{ block.settings.answer_4_profile | json }} }
            {% endif %}
          ]
        });
      {% endif %}
    {% endfor %}

    // ============================================
    // FONCTIONS DE NAVIGATION
    // ============================================
    let hasUserInteracted = false; // Flag pour Ã©viter le scroll au chargement initial
    let stateTransitionTimeout = null; // Track pending state transitions

    function goToState(state, shouldScroll = true) {
      // Cancel any pending transition to prevent race conditions
      if (stateTransitionTimeout) {
        clearTimeout(stateTransitionTimeout);
        stateTransitionTimeout = null;
      }

      const states = container.querySelectorAll('.quiz-state');
      const currentActiveState = container.querySelector('.quiz-state.is-active');

      // Exit animation for current state
      if (currentActiveState) {
        currentActiveState.classList.add('is-exiting');
        currentActiveState.classList.remove('is-active');
      }

      // Wait for exit animation, then switch states
      stateTransitionTimeout = setTimeout(() => {
        states.forEach(s => {
          s.classList.remove('is-active', 'is-exiting');
          s.style.display = 'none';
        });

        const targetState = container.querySelector(`.quiz-state-${state}`);
        if (targetState) {
          targetState.style.display = 'block';
          // Force reflow for animation
          targetState.offsetHeight;
          setTimeout(() => {
            targetState.classList.add('is-active');
          }, 10);
        }

        currentState = state;

        // Scroll vers le haut de la section quiz SEULEMENT aprÃ¨s interaction utilisateur
        // et pas pour l'Ã©tat initial (intro)
        if (shouldScroll && hasUserInteracted && state !== QuizState.INTRO) {
          setTimeout(() => {
            container.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }, 50);
        }

        stateTransitionTimeout = null; // Clear reference after completion
      }, currentActiveState ? 650 : 0); // Wait for exit animation (650ms) or instant if no current state
    }

    function goToIntro() {
      goToState(QuizState.INTRO);
    }

    function goToQuestions() {
      currentQuestionIndex = 0;
      scores = {
        apaisement: 0,
        protection: 0,
        serenite: 0,
        amour: 0,
        chance: 0
      };
      question7Answer = null; // Reset tiebreaker
      goToState(QuizState.QUESTIONS);
      displayQuestion(0);
    }

    function goToTransition() {
      goToState(QuizState.TRANSITION);
      const duration = {{ section.settings.transition_duration_ms | default: 3000 }};
      setTimeout(() => {
        goToResult();
      }, duration);
    }

    function goToResult() {
      calculateResults();
      displayResults();
      goToState(QuizState.RESULT);
    }

    // ============================================
    // LOGIQUE DES QUESTIONS
    // ============================================
    function displayQuestion(index) {
      if (index >= questionsData.length) {
        goToTransition();
        return;
      }

      const question = questionsData[index];
      const questionTitleEl = container.querySelector('#quiz-question-title-' + sectionId);
      const answersEl = container.querySelector('#quiz-answers-' + sectionId);
      const progressTextEl = container.querySelector('#quiz-progress-text-' + sectionId);
      const progressFillEl = container.querySelector('#quiz-progress-fill-' + sectionId);

      if (questionTitleEl) {
        questionTitleEl.textContent = question.label;
      }

      if (progressTextEl) {
        progressTextEl.textContent = `Question ${index + 1} sur ${questionsData.length}`;
      }

      if (progressFillEl) {
        const progress = ((index + 1) / questionsData.length) * 100;
        progressFillEl.style.width = progress + '%';
      }

      if (answersEl) {
        answersEl.innerHTML = '';
        question.answers.forEach((answer, i) => {
          const btn = document.createElement('button');
          btn.type = 'button';
          btn.className = 'quiz-answer-btn';
          btn.textContent = answer.label;
          // Apply stagger delay for entrance animation
          btn.style.transitionDelay = `${i * 80}ms`;
          btn.addEventListener('click', (e) => {
            handleAnswerClick(btn, answer.profile);
          });
          answersEl.appendChild(btn);
        });

        // Trigger staggered entrance animation
        setTimeout(() => {
          const btns = answersEl.querySelectorAll('.quiz-answer-btn');
          btns.forEach(btn => btn.classList.add('is-visible'));
        }, 50);
      }
    }

    // Handle answer click with pulse animation
    function handleAnswerClick(buttonEl, profile) {
      // Disable all buttons during animation
      const allBtns = container.querySelectorAll('.quiz-answer-btn');
      allBtns.forEach(b => b.style.pointerEvents = 'none');

      // Apply pulse animation
      buttonEl.classList.add('is-selected');

      // Capture question 7 answer BEFORE incrementing (for tiebreaker rule)
      if (currentQuestionIndex === 6) { // Question 7 (0-indexed)
        question7Answer = profile;
      }

      // Wait for pulse animation (600ms), then advance
      setTimeout(() => {
        if (profiles.includes(profile)) {
          scores[profile] = (scores[profile] || 0) + 1;
        }
        currentQuestionIndex++;
        displayQuestion(currentQuestionIndex);
      }, 600);
    }

    // Legacy function for compatibility
    function handleAnswer(profile) {
      if (profiles.includes(profile)) {
        scores[profile] = (scores[profile] || 0) + 1;
      }

      currentQuestionIndex++;
      displayQuestion(currentQuestionIndex);
    }

    // ============================================
    // CALCUL DES RÃ‰SULTATS
    // ============================================
    function calculateResults() {
      const totalScore = Object.values(scores).reduce((sum, val) => sum + val, 0);
      const percentages = {};
      let maxScore = -1;
      let tiedProfiles = [];

      // First pass: find max score and collect tied profiles
      profiles.forEach(profile => {
        const score = scores[profile] || 0;
        percentages[profile] = totalScore > 0 ? Math.round((score / totalScore) * 100) : 0;
        if (score > maxScore) {
          maxScore = score;
          tiedProfiles = [profile];
        } else if (score === maxScore) {
          tiedProfiles.push(profile);
        }
      });

      // Apply tiebreaker rule: if there's a tie, use question 7 answer
      let winnerProfile = tiedProfiles[0];
      if (tiedProfiles.length > 1 && question7Answer && tiedProfiles.includes(question7Answer)) {
        winnerProfile = question7Answer;
      }

      return {
        winnerProfile: winnerProfile,
        scores: scores,
        percentages: percentages,
        totalScore: totalScore
      };
    }

    // ============================================
    // AFFICHAGE DES RÃ‰SULTATS - EFFET "MENTALIST"
    // Progressive disclosure avec timing prÃ©cis
    // ============================================
    const REVEAL_TIMING = {
      phase1_header: 0,        // ImmÃ©diat aprÃ¨s transition
      phase2_main: 200,        // Cold reading + produit
      phase3_accordion1: 400,  // "L'Alchimie du Duo"
      phase4_accordion2: 600,  // "Ton Rituel"
      phase5_mood: 800         // MÃ©tÃ©o Ã©motionnelle + footer
    };

    function displayResults() {
      const results = calculateResults();
      const winnerProfile = results.winnerProfile;

      const profile = profileData[winnerProfile];
      if (!profile) return;

      // Reset all reveal phases (hide all)
      const allPhases = container.querySelectorAll('.reveal-phase');
      allPhases.forEach(phase => phase.classList.remove('is-revealed'));

      // Close all accordions
      const accordions = container.querySelectorAll('.quiz-reveal-accordion');
      accordions.forEach(acc => acc.removeAttribute('open'));

      // === PHASE 1 : HEADER MYSTIQUE ===
      const profileNameEl = container.querySelector('#quiz-reveal-profile-name-' + sectionId);
      if (profileNameEl) {
        profileNameEl.textContent = (profile.displayName || profile.label).toUpperCase();
      }

      // === PHASE 2 : CARTE PRINCIPALE ===
      // Cold reading description
      const readingEl = container.querySelector('#quiz-reveal-reading-' + sectionId);
      if (readingEl && profile.description) {
        readingEl.innerHTML = profile.description;
      }

      // Produit image
      const productContentEl = container.querySelector('#quiz-reveal-product-content-' + sectionId);
      if (productContentEl && profile.product) {
        const product = profile.product;
        if (product.featured_image) {
          productContentEl.innerHTML = `<img src="${product.featured_image}" alt="${product.title}" class="quiz-reveal-product-image">`;
        } else {
          productContentEl.innerHTML = `<div class="quiz-reveal-product-image" style="background: linear-gradient(135deg, var(--milaura-beige), #f5f0e8); display: flex; align-items: center; justify-content: center; font-size: 3rem;">ðŸ•¯ï¸</div>`;
        }
      }

      // Produit titre
      const productTitleEl = container.querySelector('#quiz-reveal-product-title-' + sectionId);
      if (productTitleEl && profile.product) {
        productTitleEl.textContent = profile.product.title || profile.label;
      }

      // Produit prix
      const productPriceEl = container.querySelector('#quiz-reveal-product-price-' + sectionId);
      if (productPriceEl && profile.product && profile.product.price) {
        productPriceEl.textContent = profile.product.price;
      }

      // CTA Boutons
      const ctaEl = container.querySelector('#quiz-reveal-cta-' + sectionId);
      if (ctaEl && profile.product) {
        const product = profile.product;
        const ctaLabel = '{{ section.settings.result_cta_label | default: "Adopter mon rituel" }}';
        let html = '';

        if (product.variant_id) {
          html += `<button type="button" class="quiz-reveal-cta-primary" id="quiz-add-to-cart-btn-${sectionId}" onclick="addToCartWithFeedback(${product.variant_id}, this)">${ctaLabel}</button>`;
        }

        if (product.handle) {
          html += `<a href="/products/${product.handle}?view=milaura-produit" class="quiz-reveal-cta-secondary"><span>Voir le dÃ©tail â†’</span></a>`;
        }

        ctaEl.innerHTML = html;
      }

      // === ACCORDÃ‰ON 1 : DUO PIERRE + SENTEUR ===
      const stoneEl = container.querySelector('#quiz-reveal-stone-' + sectionId);
      if (stoneEl && profile.stone) {
        stoneEl.textContent = profile.stone;
      }

      const scentEl = container.querySelector('#quiz-reveal-scent-' + sectionId);
      if (scentEl && profile.scent) {
        scentEl.textContent = profile.scent;
      }

      // BÃ©nÃ©fices (extract from profile.bullets HTML)
      const benefitsEl = container.querySelector('#quiz-reveal-benefits-' + sectionId);
      if (benefitsEl && profile.bullets) {
        // Parse bullets from HTML string and recreate as li elements
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = profile.bullets;
        const liElements = tempDiv.querySelectorAll('li');
        let benefitsHtml = '';
        liElements.forEach(li => {
          benefitsHtml += `<li>${li.textContent}</li>`;
        });
        benefitsEl.innerHTML = benefitsHtml;
      }

      // === ACCORDÃ‰ON 2 : MANTRA + RITUEL ===
      const mantraEl = container.querySelector('#quiz-reveal-mantra-' + sectionId);
      if (mantraEl && profile.mantra) {
        mantraEl.textContent = `Â« ${profile.mantra} Â»`;
      }

      const ritualEl = container.querySelector('#quiz-reveal-ritual-' + sectionId);
      if (ritualEl && profile.ritual) {
        ritualEl.textContent = profile.ritual;
      }

      // === MÃ‰TÃ‰O Ã‰MOTIONNELLE (Mini-jauges) ===
      const gaugesEl = container.querySelector('#quiz-reveal-mood-gauges-' + sectionId);
      if (gaugesEl) {
        gaugesEl.innerHTML = '';

        // Trier par pourcentage dÃ©croissant
        const sortedProfiles = [...profiles].sort((a, b) =>
          (results.percentages[b] || 0) - (results.percentages[a] || 0)
        );

        sortedProfiles.forEach(profileId => {
          const profileInfo = profileData[profileId];
          const percentage = results.percentages[profileId] || 0;
          const isWinner = profileId === winnerProfile;

          const miniGauge = document.createElement('div');
          miniGauge.className = 'quiz-reveal-mood-mini';

          miniGauge.innerHTML = `
            <div class="quiz-reveal-mood-mini-icon">${profileInfo.icon || 'â—‹'}</div>
            <div class="quiz-reveal-mood-mini-bar">
              <div class="quiz-reveal-mood-mini-fill${isWinner ? ' is-winner' : ''}" style="width: 0%;"></div>
            </div>
            <div class="quiz-reveal-mood-mini-percent">${percentage}%</div>
          `;

          gaugesEl.appendChild(miniGauge);
        });
      }

      // === INVITATION COMPTE ===
      const accountInviteEl = container.querySelector('#quiz-reveal-account-invite-' + sectionId);
      if (accountInviteEl) {
        if (isCustomerLoggedIn) {
          accountInviteEl.style.display = 'none';
        } else {
          accountInviteEl.style.display = '';
        }
      }

      // === STOCKAGE LOCAL ===
      const storageData = {
        profileId: winnerProfile,
        profileName: profile.displayName || profile.label,
        stone: profile.stone,
        scent: profile.scent,
        scores: results.scores,
        percentages: results.percentages,
        productHandle: profile.product ? profile.product.handle : null,
        productTitle: profile.product ? profile.product.title : null,
        timestamp: Date.now()
      };
      localStorage.setItem('milauraLastResult', JSON.stringify(storageData));

      // === PROGRESSIVE DISCLOSURE - STAGGERED REVEAL ===
      // Check for reduced motion preference
      const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

      if (prefersReducedMotion) {
        // Reveal all phases immediately if user prefers reduced motion
        allPhases.forEach(phase => phase.classList.add('is-revealed'));
        // Animate gauges immediately
        setTimeout(() => animateMoodGauges(results, winnerProfile), 50);
      } else {
        // Phase 1: Header (immediate)
        setTimeout(() => {
          const phase1 = container.querySelector('[data-reveal-phase="1"]');
          if (phase1) phase1.classList.add('is-revealed');
        }, REVEAL_TIMING.phase1_header);

        // Phase 2: Main card with product
        setTimeout(() => {
          const phase2 = container.querySelector('[data-reveal-phase="2"]');
          if (phase2) phase2.classList.add('is-revealed');
        }, REVEAL_TIMING.phase2_main);

        // Phase 3: First accordion
        setTimeout(() => {
          const phase3 = container.querySelector('[data-reveal-phase="3"]');
          if (phase3) phase3.classList.add('is-revealed');
        }, REVEAL_TIMING.phase3_accordion1);

        // Phase 4: Second accordion
        setTimeout(() => {
          const phase4 = container.querySelector('[data-reveal-phase="4"]');
          if (phase4) phase4.classList.add('is-revealed');
        }, REVEAL_TIMING.phase4_accordion2);

        // Phase 5: Mood + Footer
        setTimeout(() => {
          const phase5Elements = container.querySelectorAll('[data-reveal-phase="5"]');
          phase5Elements.forEach(el => el.classList.add('is-revealed'));
          // Animate mood gauges after they're visible
          setTimeout(() => animateMoodGauges(results, winnerProfile), 100);
        }, REVEAL_TIMING.phase5_mood);
      }
    }

    // Helper function to animate mood gauge fills
    function animateMoodGauges(results, winnerProfile) {
      const fills = container.querySelectorAll('.quiz-reveal-mood-mini-fill');
      const sortedProfiles = [...profiles].sort((a, b) =>
        (results.percentages[b] || 0) - (results.percentages[a] || 0)
      );

      fills.forEach((fill, index) => {
        const profileId = sortedProfiles[index];
        const percentage = results.percentages[profileId] || 0;
        fill.style.width = percentage + '%';
      });
    }

    // Fonction globale pour ajouter au panier avec feedback visuel
    window.addToCartWithFeedback = function(variantId, buttonEl) {
      const originalText = buttonEl.textContent;
      buttonEl.textContent = 'Ajout en cours...';
      buttonEl.disabled = true;

      fetch('/cart/add.js', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id: variantId, quantity: 1 })
      })
      .then(response => response.json())
      .then(() => {
        buttonEl.textContent = 'âœ“ AjoutÃ© au panier';
        buttonEl.style.background = 'linear-gradient(135deg, #4CAF50, #66BB6A)';

        // Remettre le bouton normal aprÃ¨s 2s
        setTimeout(() => {
          buttonEl.textContent = originalText;
          buttonEl.style.background = '';
          buttonEl.disabled = false;
        }, 2000);

        // Mettre Ã  jour le compteur du panier si prÃ©sent
        if (typeof window.updateCartCount === 'function') {
          window.updateCartCount();
        }
      })
      .catch(error => {
        console.error('Erreur ajout panier:', error);
        buttonEl.textContent = 'Erreur - RÃ©essayer';
        buttonEl.style.background = 'linear-gradient(135deg, #f44336, #e57373)';
        buttonEl.disabled = false;

        setTimeout(() => {
          buttonEl.textContent = originalText;
          buttonEl.style.background = '';
        }, 2000);
      });
    };

    // ============================================
    // GESTION DU LOCALSTORAGE
    // ============================================
    function checkLastResult() {
      const lastResult = localStorage.getItem('milauraLastResult');
      if (lastResult) {
        try {
          const data = JSON.parse(lastResult);
          const linkEl = container.querySelector('#quiz-last-result-link-' + sectionId);
          const showLinkEl = container.querySelector('#quiz-show-last-' + sectionId);
          
          if (linkEl) linkEl.style.display = 'block';
          if (showLinkEl) {
            showLinkEl.addEventListener('click', (e) => {
              e.preventDefault();
              hasUserInteracted = true; // Activer le scroll
              // Recharger les rÃ©sultats depuis localStorage
              const storedData = JSON.parse(localStorage.getItem('milauraLastResult'));
              scores = storedData.scores;
              displayResults();
              goToState(QuizState.RESULT);
            });
          }
        } catch (e) {
          console.error('Error parsing last result:', e);
        }
      }
    }

    // ============================================
    // INITIALISATION
    // ============================================
    function init() {
      // Bouton start
      const startBtn = container.querySelector('#quiz-start-btn-' + sectionId);
      if (startBtn) {
        startBtn.addEventListener('click', () => {
          hasUserInteracted = true; // Activer le scroll aprÃ¨s la premiÃ¨re interaction
          goToQuestions();
        });
      }

      // Bouton restart
      const restartBtn = container.querySelector('#quiz-restart-btn-' + sectionId);
      if (restartBtn) {
        restartBtn.addEventListener('click', () => {
          // Reset les scores avec les nouveaux profils
          scores = {
            apaisement: 0,
            protection: 0,
            serenite: 0,
            amour: 0,
            chance: 0
          };
          currentQuestionIndex = 0;
          question7Answer = null; // Reset tiebreaker

          // Reset reveal phases visibility for next animation
          const revealPhases = container.querySelectorAll('.reveal-phase');
          revealPhases.forEach(phase => phase.classList.remove('is-revealed'));

          // Close all accordions
          const accordions = container.querySelectorAll('.quiz-reveal-accordion');
          accordions.forEach(acc => acc.removeAttribute('open'));

          goToQuestions();
        });
      }

      // VÃ©rifier derniÃ¨re rÃ©vÃ©lation
      checkLastResult();

      // Afficher l'Ã©tat initial
      goToState(QuizState.INTRO);
    }

    // DÃ©marrer quand le DOM est prÃªt
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  })();
</script>

{% schema %}
{
  "name": "Milaura Quiz",
  "enabled_on": {
    "templates": ["*"]
  },
  "settings": [
    {
      "type": "header",
      "content": "Introduction"
    },
    {
      "type": "text",
      "id": "intro_title",
      "label": "Titre d'introduction",
      "default": "Bienvenue dans ton rituel intÃ©rieur"
    },
    {
      "type": "richtext",
      "id": "intro_subtitle",
      "label": "Sous-titre d'introduction",
      "default": "<p>DÃ©couvre ta bougie Ã©motionnelle personnalisÃ©e en rÃ©pondant Ã  quelques questions.</p>"
    },
    {
      "type": "text",
      "id": "intro_button_label",
      "label": "Label du bouton",
      "default": "Commencer le rituel"
    },
    {
      "type": "header",
      "content": "Bloc Experte"
    },
    {
      "type": "checkbox",
      "id": "show_expert",
      "label": "Afficher le bloc experte",
      "default": true
    },
    {
      "type": "image_picker",
      "id": "expert_image",
      "label": "Photo de l'experte"
    },
    {
      "type": "text",
      "id": "expert_name",
      "label": "Nom de l'experte",
      "default": "Lorraine Vidal"
    },
    {
      "type": "text",
      "id": "expert_title",
      "label": "Titre de l'experte",
      "default": "Fondatrice & Experte en aromathÃ©rapie"
    },
    {
      "type": "richtext",
      "id": "expert_text",
      "label": "Texte de l'experte",
      "default": "<p>Je t'accompagne dans cette dÃ©couverte de ton profil Ã©motionnel unique.</p>"
    },
    {
      "type": "header",
      "content": "Transition"
    },
    {
      "type": "text",
      "id": "transition_title",
      "label": "Titre de transition",
      "default": "Nous rÃ©unissons nos Ã©nergies pour rÃ©vÃ©ler ta crÃ©ation uniqueâ€¦"
    },
    {
      "type": "text",
      "id": "transition_subtitle",
      "label": "Sous-titre de transition",
      "default": "Ce n'est pas un quiz. C'est un miroir Ã©motionnel."
    },
    {
      "type": "richtext",
      "id": "transition_body",
      "label": "Texte de transition",
      "default": "<p>Notre approche allie la science neuro-olfactive et l'art de la crÃ©ation sensorielle pour rÃ©vÃ©ler ta bougie personnalisÃ©e.</p>"
    },
    {
      "type": "number",
      "id": "transition_duration_ms",
      "label": "DurÃ©e de la transition (ms)",
      "default": 3000
    },
    {
      "type": "header",
      "content": "RÃ©sultats - Effet Mentalist"
    },
    {
      "type": "text",
      "id": "result_kicker",
      "label": "Accroche mystique (kicker)",
      "default": "Ce que ton Ã¢me murmure..."
    },
    {
      "type": "text",
      "id": "result_cta_label",
      "label": "Label CTA principal",
      "default": "Adopter mon rituel"
    },
    {
      "type": "text",
      "id": "accordion_duo_label",
      "label": "Label accordÃ©on duo pierre/senteur",
      "default": "L'Alchimie du Duo"
    },
    {
      "type": "text",
      "id": "accordion_ritual_label",
      "label": "Label accordÃ©on rituel",
      "default": "Ton Rituel de Connexion"
    },
    {
      "type": "text",
      "id": "result_mood_title",
      "label": "Titre mÃ©tÃ©o Ã©motionnelle",
      "default": "Ta MÃ©tÃ©o Ã‰motionnelle"
    },
    {
      "type": "header",
      "content": "Profil : Apaisement"
    },
    {
      "type": "text",
      "id": "profile_apaisement_label",
      "label": "Label",
      "default": "Apaisement"
    },
    {
      "type": "richtext",
      "id": "profile_apaisement_description",
      "label": "Description",
      "default": "<p>Tu tiens, tu avances, tu gÃ¨res, mais Ã  l'intÃ©rieur Ã§a ne se pose pas vraiment. Ce que tu cherches, c'est une descente immÃ©diate, une sensation de douceur qui te remet dans ton corps.</p>"
    },
    {
      "type": "product",
      "id": "profile_apaisement_product",
      "label": "Produit associÃ©"
    },
    {
      "type": "richtext",
      "id": "profile_apaisement_bullets",
      "label": "BÃ©nÃ©fices (liste)",
      "default": "<ul><li>Apaisement immÃ©diat</li><li>Douceur Ã©motionnelle</li><li>Sensation de cocon</li></ul>"
    },
    {
      "type": "text",
      "id": "profile_apaisement_mantra",
      "label": "Mantra",
      "default": "Je peux ralentir maintenant"
    },
    {
      "type": "header",
      "content": "Profil : Protection"
    },
    {
      "type": "text",
      "id": "profile_protection_label",
      "label": "Label",
      "default": "Protection"
    },
    {
      "type": "richtext",
      "id": "profile_protection_description",
      "label": "Description",
      "default": "<p>Tu as besoin de te sentir protÃ©gÃ©(e) et en sÃ©curitÃ©. Cette bougie crÃ©era un bouclier Ã©nergÃ©tique autour de toi.</p>"
    },
    {
      "type": "product",
      "id": "profile_protection_product",
      "label": "Produit associÃ©"
    },
    {
      "type": "richtext",
      "id": "profile_protection_bullets",
      "label": "BÃ©nÃ©fices (liste)",
      "default": "<ul><li>Bouclier Ã©nergÃ©tique</li><li>Protection Ã©motionnelle</li><li>Sentiment de sÃ©curitÃ©</li></ul>"
    },
    {
      "type": "text",
      "id": "profile_protection_mantra",
      "label": "Mantra",
      "default": "Je suis protÃ©gÃ©(e) et en sÃ©curitÃ©"
    },
    {
      "type": "header",
      "content": "Profil : SÃ©rÃ©nitÃ©"
    },
    {
      "type": "text",
      "id": "profile_serenite_label",
      "label": "Label",
      "default": "SÃ©rÃ©nitÃ©"
    },
    {
      "type": "richtext",
      "id": "profile_serenite_description",
      "label": "Description",
      "default": "<p>Ton problÃ¨me n'est pas le manque d'envie, c'est le trop plein. Tu as besoin de silence mental, pas de motivation.</p>"
    },
    {
      "type": "product",
      "id": "profile_serenite_product",
      "label": "Produit associÃ©"
    },
    {
      "type": "richtext",
      "id": "profile_serenite_bullets",
      "label": "BÃ©nÃ©fices (liste)",
      "default": "<ul><li>Calme mental</li><li>Impression de clartÃ©</li><li>Ambiance zen et pure</li></ul>"
    },
    {
      "type": "text",
      "id": "profile_serenite_mantra",
      "label": "Mantra",
      "default": "Je reviens Ã  l'essentiel"
    },
    {
      "type": "header",
      "content": "Profil : Amour"
    },
    {
      "type": "text",
      "id": "profile_amour_label",
      "label": "Label",
      "default": "Amour"
    },
    {
      "type": "richtext",
      "id": "profile_amour_description",
      "label": "Description",
      "default": "<p>Tu es dur(e) avec toi, parfois sans t'en rendre compte. Ce que tu cherches lÃ , c'est un moment qui rÃ©pare le cÅ“ur, pas avec de grands mots, juste avec une sensation de chaleur et de bienveillance.</p>"
    },
    {
      "type": "product",
      "id": "profile_amour_product",
      "label": "Produit associÃ©"
    },
    {
      "type": "richtext",
      "id": "profile_amour_bullets",
      "label": "BÃ©nÃ©fices (liste)",
      "default": "<ul><li>Douceur du cÅ“ur</li><li>Compassion, amour de soi</li><li>Ambiance enveloppante et prÃ©cieuse</li></ul>"
    },
    {
      "type": "text",
      "id": "profile_amour_mantra",
      "label": "Mantra",
      "default": "Je me parle avec douceur"
    },
    {
      "type": "header",
      "content": "Profil : Chance"
    },
    {
      "type": "text",
      "id": "profile_chance_label",
      "label": "Label",
      "default": "Chance"
    },
    {
      "type": "richtext",
      "id": "profile_chance_description",
      "label": "Description",
      "default": "<p>Tu sens que tu pourrais repartir, mais il manque une Ã©tincelle. Cette bougie est faite pour ouvrir le champ, remettre de l'optimisme, et te donner envie de faire ce premier petit pas.</p>"
    },
    {
      "type": "product",
      "id": "profile_chance_product",
      "label": "Produit associÃ©"
    },
    {
      "type": "richtext",
      "id": "profile_chance_bullets",
      "label": "BÃ©nÃ©fices (liste)",
      "default": "<ul><li>Optimisme et lÃ©gÃ¨retÃ©</li><li>Ã‰nergie de renouveau</li><li>Envie d'avancer</li></ul>"
    },
    {
      "type": "text",
      "id": "profile_chance_mantra",
      "label": "Mantra",
      "default": "Je crÃ©e ma chance, un petit pas suffit"
    }
  ],
  "blocks": [
    {
      "type": "question",
      "name": "Question",
      "settings": [
        {
          "type": "text",
          "id": "question_label",
          "label": "Question",
          "default": "Comment te sens-tu en ce moment ?"
        },
        {
          "type": "text",
          "id": "answer_1_label",
          "label": "RÃ©ponse 1",
          "default": "J'ai besoin de rÃ©confort"
        },
        {
          "type": "select",
          "id": "answer_1_profile",
          "label": "Profil rÃ©ponse 1",
          "options": [
            {
              "value": "apaisement",
              "label": "Apaisement"
            },
            {
              "value": "protection",
              "label": "Protection"
            },
            {
              "value": "serenite",
              "label": "SÃ©rÃ©nitÃ©"
            },
            {
              "value": "amour",
              "label": "Amour"
            },
            {
              "value": "chance",
              "label": "Chance"
            }
          ],
          "default": "apaisement"
        },
        {
          "type": "text",
          "id": "answer_2_label",
          "label": "RÃ©ponse 2",
          "default": "Je me sens vulnÃ©rable"
        },
        {
          "type": "select",
          "id": "answer_2_profile",
          "label": "Profil rÃ©ponse 2",
          "options": [
            {
              "value": "apaisement",
              "label": "Apaisement"
            },
            {
              "value": "protection",
              "label": "Protection"
            },
            {
              "value": "serenite",
              "label": "SÃ©rÃ©nitÃ©"
            },
            {
              "value": "amour",
              "label": "Amour"
            },
            {
              "value": "chance",
              "label": "Chance"
            }
          ],
          "default": "protection"
        },
        {
          "type": "text",
          "id": "answer_3_label",
          "label": "RÃ©ponse 3 (optionnel)"
        },
        {
          "type": "select",
          "id": "answer_3_profile",
          "label": "Profil rÃ©ponse 3",
          "options": [
            {
              "value": "apaisement",
              "label": "Apaisement"
            },
            {
              "value": "protection",
              "label": "Protection"
            },
            {
              "value": "serenite",
              "label": "SÃ©rÃ©nitÃ©"
            },
            {
              "value": "amour",
              "label": "Amour"
            },
            {
              "value": "chance",
              "label": "Chance"
            }
          ],
          "default": "serenite"
        },
        {
          "type": "text",
          "id": "answer_4_label",
          "label": "RÃ©ponse 4 (optionnel)"
        },
        {
          "type": "select",
          "id": "answer_4_profile",
          "label": "Profil rÃ©ponse 4",
          "options": [
            {
              "value": "apaisement",
              "label": "Apaisement"
            },
            {
              "value": "protection",
              "label": "Protection"
            },
            {
              "value": "serenite",
              "label": "SÃ©rÃ©nitÃ©"
            },
            {
              "value": "amour",
              "label": "Amour"
            },
            {
              "value": "chance",
              "label": "Chance"
            }
          ],
          "default": "amour"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Milaura Quiz",
      "blocks": [
        {
          "type": "question",
          "settings": {
            "question_label": "Le signe qui te trahit le plus en ce moment, c'estâ€¦",
            "answer_1_label": "Tu ressasses dans ta tÃªte aprÃ¨s coup (discussion, message, appel) mÃªme pour des dÃ©tails",
            "answer_1_profile": "apaisement",
            "answer_2_label": "Tu sens que tout t'atteint et t'affecte, alors tu te mets en retrait",
            "answer_2_profile": "protection",
            "answer_3_label": "Tu passes d'une tÃ¢che Ã  l'autre, tu fais de nombreuses choses en mÃªme temps sans vraiment en terminer une seule",
            "answer_3_profile": "serenite",
            "answer_4_label": "Tu as besoin d'un petit dÃ©clic, d'un signe, d'un Â« mood Â» tu le sens au fond de toi",
            "answer_4_profile": "chance"
          }
        },
        {
          "type": "question",
          "settings": {
            "question_label": "Quand tu rentres chez toi, ton premier vrai besoin, c'estâ€¦",
            "answer_1_label": "Une ambiance douce qui te fait redescendre sans effort",
            "answer_1_profile": "apaisement",
            "answer_2_label": "Sentir que tu es chez toi, intouchable, comme dans une bulle",
            "answer_2_profile": "protection",
            "answer_3_label": "Retrouver du silence, du propre, du simple, juste prendre une douche par exemple, Ã§a te fait comme une coupure avec le monde extÃ©rieur",
            "answer_3_profile": "serenite",
            "answer_4_label": "Te sentir aimÃ©e, te poser avec ton/ta chÃ©ri(e) ou ton chat ;) sentir simplement de la tendresse",
            "answer_4_profile": "amour"
          }
        },
        {
          "type": "question",
          "settings": {
            "question_label": "Ce qui t'Ã©puise le plus en ce moment, c'estâ€¦",
            "answer_1_label": "La charge Ã©motionnelle, tu encaisses plus que tu ne le montres",
            "answer_1_profile": "apaisement",
            "answer_2_label": "Le fait de devoir rester Â« fort(e) Â», mÃªme quand tu n'en as pas envie",
            "answer_2_profile": "protection",
            "answer_3_label": "Le bruit mental, les dÃ©cisions, les listes, les pensÃ©es en boucle",
            "answer_3_profile": "serenite",
            "answer_4_label": "La sensation que tout stagne, tu aimerais que Ã§a avance",
            "answer_4_profile": "chance"
          }
        },
        {
          "type": "question",
          "settings": {
            "question_label": "Si tu pouvais appuyer sur un bouton ce soir, tu choisiraisâ€¦",
            "answer_1_label": "RelÃ¢cher la pression et sentir ton corps se dÃ©tendre",
            "answer_1_profile": "apaisement",
            "answer_2_label": "Couper ce qui te saoule, et poser des limites (avec des gens ou des choses Ã  faire)",
            "answer_2_profile": "protection",
            "answer_3_label": "Calmer ton mental et retrouver une sorte de paix, peut-Ãªtre juste en se posant devant la TV et ne penser Ã  rien",
            "answer_3_profile": "serenite",
            "answer_4_label": "Remettre du positif, de l'Ã©lan, comme une lumiÃ¨re qui revient, comme une sorte de motivation",
            "answer_4_profile": "chance"
          }
        },
        {
          "type": "question",
          "settings": {
            "question_label": "Dans tes relations, ton schÃ©ma du moment ressemble plutÃ´t Ã â€¦",
            "answer_1_label": "Tu donnes beaucoup, et aprÃ¨s tu te sens vidÃ©(e)",
            "answer_1_profile": "apaisement",
            "answer_2_label": "Tu dis Â« Ã§a va Â», mais tu te protÃ¨ges pour ne pas craquer",
            "answer_2_profile": "protection",
            "answer_3_label": "Tu es prÃ©sent(e) physiquement, mais la tÃªte est ailleurs",
            "answer_3_profile": "serenite",
            "answer_4_label": "Tu as besoin de douceur, de gestes simples, de chaleur humaine",
            "answer_4_profile": "amour"
          }
        },
        {
          "type": "question",
          "settings": {
            "question_label": "Ton Â« moment idÃ©al Â» c'est plutÃ´tâ€¦",
            "answer_1_label": "Plaid, lumiÃ¨re basse, tu souffles enfin et tu te poses",
            "answer_1_profile": "apaisement",
            "answer_2_label": "Tu ranges, tu reprends ton espace, tu te sens chez toi",
            "answer_2_profile": "protection",
            "answer_3_label": "Tisane, silence, respiration, tout simplement",
            "answer_3_profile": "serenite",
            "answer_4_label": "Musique douce, tu te sens Â« reconnectÃ©e Â», bien dans tes baskets",
            "answer_4_profile": "amour"
          }
        },
        {
          "type": "question",
          "settings": {
            "question_label": "La phrase qui te ressemble le plus, lÃ  maintenant",
            "answer_1_label": "J'ai besoin qu'on me laisse respirer, qu'on me Â« foute la paix Â»",
            "answer_1_profile": "apaisement",
            "answer_2_label": "J'ai besoin de mettre de la distance avec certaines habitudes ou certaines personnes",
            "answer_2_profile": "protection",
            "answer_3_label": "J'ai besoin de clartÃ©, j'ai l'impression de tourner en boucle",
            "answer_3_profile": "serenite",
            "answer_4_label": "J'ai besoin de douceur, je veux me sentir sereine",
            "answer_4_profile": "amour"
          }
        }
      ]
    }
  ]
}
{% endschema %}
