{% style %}
  /* ============================================
     MILAURA QUIZ - DIAGNOSTIC √âMOTIONNEL
     ============================================ */

     #MilauraQuiz-{{ section.id }} {
    width: 100%;
    padding: var(--milaura-spacing-lg) var(--milaura-spacing-sm) var(--milaura-spacing-lg);
    background: transparent;
    min-height: 400px;
    /* Espacement vertical harmonis√© */
    margin-top: var(--milaura-spacing-lg);
    margin-bottom: var(--milaura-spacing-lg);
  }

  /* --- CONTENEUR PRINCIPAL --- */
  #MilauraQuiz-{{ section.id }} .quiz-container {
    /* Utilise la classe g√©n√©rique .milaura-section-card */
    /* max-width, width, margin g√©r√©s par .milaura-section-card */
    position: relative;
  }

  /* --- √âTAT : INTRO --- */
  #MilauraQuiz-{{ section.id }} .quiz-state {
    display: none;
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.5s ease, transform 0.5s ease;
  }

  #MilauraQuiz-{{ section.id }} .quiz-state.is-active {
    display: block;
    opacity: 1;
    transform: translateY(0);
  }

  #MilauraQuiz-{{ section.id }} .quiz-intro-card {
    /* Le halo est g√©r√© par le conteneur parent .milaura-section-card */
    background: transparent;
    border: none;
    border-radius: 0;
    padding: 0;
    box-shadow: none;
    text-align: center;
  }

  #MilauraQuiz-{{ section.id }} .quiz-intro-title {
    font-family: var(--milaura-font-heading);
    color: var(--milaura-gold);
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: var(--milaura-spacing-md);
    line-height: 1.2;
  }

  #MilauraQuiz-{{ section.id }} .quiz-intro-subtitle {
    font-family: var(--milaura-font-body);
    color: var(--milaura-text);
    font-size: 1.1rem;
    line-height: 1.6;
    margin-bottom: var(--milaura-spacing-lg);
  }

  #MilauraQuiz-{{ section.id }} .quiz-expert-block {
    background: rgba(255, 255, 255, 0.6);
    border-radius: var(--milaura-border-radius-sm);
    padding: var(--milaura-spacing-md);
    margin: var(--milaura-spacing-lg) 0;
    display: flex;
    align-items: center;
    gap: var(--milaura-spacing-md);
    text-align: left;
  }

  #MilauraQuiz-{{ section.id }} .quiz-expert-image {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid var(--milaura-gold);
    flex-shrink: 0;
  }

  #MilauraQuiz-{{ section.id }} .quiz-expert-info {
    flex: 1;
  }

  #MilauraQuiz-{{ section.id }} .quiz-expert-name {
    font-family: var(--milaura-font-heading);
    color: var(--milaura-text);
    font-size: 1.3rem;
    font-weight: 700;
    margin-bottom: 5px;
  }

  #MilauraQuiz-{{ section.id }} .quiz-expert-title {
    font-family: var(--milaura-font-body);
    color: var(--milaura-gold);
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 8px;
  }

  #MilauraQuiz-{{ section.id }} .quiz-expert-text {
    font-family: var(--milaura-font-body);
    color: var(--milaura-text-light);
    font-size: 0.95rem;
    line-height: 1.5;
  }

  /* --- √âTAT : QUESTIONS --- */
  #MilauraQuiz-{{ section.id }} .quiz-questions-header {
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(20px);
    border-radius: var(--milaura-border-radius);
    padding: var(--milaura-spacing-md);
    margin-bottom: var(--milaura-spacing-lg);
    text-align: center;
    border: 1px solid rgba(192, 160, 98, 0.3);
  }

  #MilauraQuiz-{{ section.id }} .quiz-progress-text {
    font-family: var(--milaura-font-body);
    color: var(--milaura-text);
    font-size: 0.9rem;
    margin-bottom: 10px;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  #MilauraQuiz-{{ section.id }} .quiz-progress-bar {
    width: 100%;
    height: 8px;
    background: rgba(192, 160, 98, 0.2);
    border-radius: 10px;
    overflow: hidden;
    position: relative;
  }

  #MilauraQuiz-{{ section.id }} .quiz-progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--milaura-gold) 0%, var(--milaura-gold-light) 100%);
    border-radius: 10px;
    transition: width 0.4s ease;
    box-shadow: 0 2px 10px rgba(192, 160, 98, 0.4);
  }

  #MilauraQuiz-{{ section.id }} .quiz-question-card {
    /* Le halo est g√©r√© par le conteneur parent .milaura-section-card */
    background: transparent;
    border: none;
    border-radius: 0;
    padding: 0;
    box-shadow: none;
  }

  #MilauraQuiz-{{ section.id }} .quiz-question-title {
    font-family: var(--milaura-font-heading);
    color: var(--milaura-text);
    font-size: 1.8rem;
    font-weight: 700;
    margin-bottom: var(--milaura-spacing-md);
    text-align: center;
    line-height: 1.3;
  }

  #MilauraQuiz-{{ section.id }} .quiz-answers {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--milaura-spacing-md);
    margin-top: var(--milaura-spacing-lg);
  }

  #MilauraQuiz-{{ section.id }} .quiz-answer-btn {
    background: rgba(255, 255, 255, 0.9);
    border: 2px solid rgba(192, 160, 98, 0.4);
    border-radius: var(--milaura-border-radius-sm);
    padding: var(--milaura-spacing-md);
    font-family: var(--milaura-font-body);
    color: var(--milaura-text);
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: center;
    min-height: 80px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  #MilauraQuiz-{{ section.id }} .quiz-answer-btn:hover {
    background: rgba(255, 255, 255, 1);
    border-color: var(--milaura-gold);
    transform: translateY(-3px);
    box-shadow: var(--milaura-shadow-md);
  }

  #MilauraQuiz-{{ section.id }} .quiz-answer-btn:active {
    transform: translateY(0);
  }

  /* --- √âTAT : TRANSITION --- */
  #MilauraQuiz-{{ section.id }} .quiz-transition-card {
    /* Le halo est g√©r√© par le conteneur parent .milaura-section-card */
    background: transparent;
    border: none;
    border-radius: 0;
    padding: 0;
    box-shadow: none;
    text-align: center;
    min-height: 300px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  #MilauraQuiz-{{ section.id }} .quiz-transition-title {
    font-family: var(--milaura-font-heading);
    color: var(--milaura-gold);
    font-size: 2.2rem;
    font-weight: 700;
    margin-bottom: var(--milaura-spacing-md);
    line-height: 1.3;
  }

  #MilauraQuiz-{{ section.id }} .quiz-transition-subtitle {
    font-family: var(--milaura-font-script);
    color: var(--milaura-text);
    font-size: 1.5rem;
    margin-bottom: var(--milaura-spacing-lg);
  }

  #MilauraQuiz-{{ section.id }} .quiz-transition-body {
    font-family: var(--milaura-font-body);
    color: var(--milaura-text);
    font-size: 1.1rem;
    line-height: 1.7;
    max-width: 600px;
    margin: 0 auto;
  }

  #MilauraQuiz-{{ section.id }} .quiz-loader {
    display: flex;
    gap: 10px;
    margin-top: var(--milaura-spacing-lg);
    justify-content: center;
  }

  #MilauraQuiz-{{ section.id }} .quiz-loader-dot {
    width: 12px;
    height: 12px;
    background: var(--milaura-gold);
    border-radius: 50%;
    animation: pulse 1.4s ease-in-out infinite;
  }

  #MilauraQuiz-{{ section.id }} .quiz-loader-dot:nth-child(2) {
    animation-delay: 0.2s;
  }

  #MilauraQuiz-{{ section.id }} .quiz-loader-dot:nth-child(3) {
    animation-delay: 0.4s;
  }

  @keyframes pulse {
    0%, 100% {
      opacity: 0.3;
      transform: scale(1);
    }
    50% {
      opacity: 1;
      transform: scale(1.2);
    }
  }

  /* --- √âTAT : RESULT - DASHBOARD PREMIUM --- */

  /* Header du r√©sultat */
  #MilauraQuiz-{{ section.id }} .quiz-result-header {
    text-align: center;
    margin-bottom: var(--milaura-spacing-xl);
    padding-bottom: var(--milaura-spacing-lg);
    border-bottom: 1px solid rgba(192, 160, 98, 0.2);
  }

  #MilauraQuiz-{{ section.id }} .quiz-result-kicker {
    font-family: var(--milaura-font-body);
    color: var(--milaura-gold);
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 2px;
    margin-bottom: var(--milaura-spacing-sm);
  }

  #MilauraQuiz-{{ section.id }} .quiz-result-main-title {
    font-family: var(--milaura-font-heading);
    color: var(--milaura-text);
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: var(--milaura-spacing-sm);
    line-height: 1.2;
  }

  #MilauraQuiz-{{ section.id }} .quiz-result-profile-name {
    font-family: var(--milaura-font-script);
    color: var(--milaura-gold);
    font-size: 1.8rem;
  }

  /* Layout principal 3 colonnes */
  #MilauraQuiz-{{ section.id }} .quiz-result-layout {
    display: grid;
    grid-template-columns: 1fr 1.2fr 1fr;
    gap: var(--milaura-spacing-lg);
    align-items: start;
  }

  /* Carte produit (colonne gauche) */
  #MilauraQuiz-{{ section.id }} .quiz-result-product-card {
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(15px);
    border: 1px solid rgba(192, 160, 98, 0.25);
    border-radius: var(--milaura-border-radius);
    padding: var(--milaura-spacing-md);
    box-shadow: 0 10px 40px rgba(192, 160, 98, 0.15);
    position: relative;
    overflow: hidden;
  }

  #MilauraQuiz-{{ section.id }} .quiz-result-product-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, var(--milaura-gold), var(--milaura-gold-light));
  }

  #MilauraQuiz-{{ section.id }} .quiz-result-product-badge {
    display: inline-block;
    background: linear-gradient(135deg, var(--milaura-gold), var(--milaura-gold-light));
    color: #fff;
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    padding: 6px 12px;
    border-radius: 20px;
    margin-bottom: var(--milaura-spacing-md);
  }

  #MilauraQuiz-{{ section.id }} .quiz-result-product-image {
    width: 100%;
    aspect-ratio: 1;
    object-fit: cover;
    border-radius: var(--milaura-border-radius-sm);
    margin-bottom: var(--milaura-spacing-md);
    border: 2px solid rgba(192, 160, 98, 0.2);
    transition: transform 0.3s ease;
  }

  #MilauraQuiz-{{ section.id }} .quiz-result-product-image:hover {
    transform: scale(1.02);
  }

  #MilauraQuiz-{{ section.id }} .quiz-result-product-title {
    font-family: var(--milaura-font-heading);
    color: var(--milaura-text);
    font-size: 1.3rem;
    font-weight: 700;
    margin-bottom: 8px;
    line-height: 1.3;
  }

  #MilauraQuiz-{{ section.id }} .quiz-result-product-price {
    font-family: var(--milaura-font-heading);
    color: var(--milaura-gold);
    font-size: 1.8rem;
    font-weight: 700;
    margin-bottom: var(--milaura-spacing-md);
  }

  #MilauraQuiz-{{ section.id }} .quiz-result-cta-primary {
    display: block;
    width: 100%;
    background: linear-gradient(135deg, var(--milaura-gold), var(--milaura-gold-dark));
    color: #fff !important;
    font-family: var(--milaura-font-body);
    font-size: 1rem;
    font-weight: 700;
    text-align: center;
    text-decoration: none !important;
    padding: 16px 24px;
    border-radius: var(--milaura-border-radius-sm);
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(192, 160, 98, 0.4);
  }

  #MilauraQuiz-{{ section.id }} .quiz-result-cta-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(192, 160, 98, 0.5);
  }

  #MilauraQuiz-{{ section.id }} .quiz-result-cta-secondary {
    display: block;
    width: 100%;
    background: transparent;
    color: var(--milaura-gold) !important;
    font-family: var(--milaura-font-body);
    font-size: 0.9rem;
    font-weight: 600;
    text-align: center;
    text-decoration: underline !important;
    padding: 12px;
    border: none;
    cursor: pointer;
    transition: color 0.3s ease;
    margin-top: var(--milaura-spacing-sm);
  }

  #MilauraQuiz-{{ section.id }} .quiz-result-cta-secondary:hover {
    color: var(--milaura-gold-dark) !important;
  }

  /* Carte description (colonne centrale) */
  #MilauraQuiz-{{ section.id }} .quiz-result-desc-card {
    background: rgba(255, 255, 255, 0.5);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(192, 160, 98, 0.15);
    border-radius: var(--milaura-border-radius);
    padding: var(--milaura-spacing-lg);
  }

  #MilauraQuiz-{{ section.id }} .quiz-result-profile-intro {
    font-family: var(--milaura-font-body);
    color: var(--milaura-text);
    font-size: 1.05rem;
    line-height: 1.7;
    margin-bottom: var(--milaura-spacing-lg);
  }

  #MilauraQuiz-{{ section.id }} .quiz-result-profile-intro strong {
    color: var(--milaura-gold-dark);
  }

  /* Duo Pierre + Senteur */
  #MilauraQuiz-{{ section.id }} .quiz-result-duo {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--milaura-spacing-md);
    margin-bottom: var(--milaura-spacing-lg);
  }

  #MilauraQuiz-{{ section.id }} .quiz-result-duo-item {
    background: rgba(255, 255, 255, 0.6);
    border-radius: var(--milaura-border-radius-sm);
    padding: var(--milaura-spacing-md);
    text-align: center;
    border: 1px solid rgba(192, 160, 98, 0.2);
  }

  #MilauraQuiz-{{ section.id }} .quiz-result-duo-icon {
    font-size: 2rem;
    margin-bottom: 8px;
  }

  #MilauraQuiz-{{ section.id }} .quiz-result-duo-label {
    font-family: var(--milaura-font-body);
    color: var(--milaura-gold);
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 4px;
  }

  #MilauraQuiz-{{ section.id }} .quiz-result-duo-name {
    font-family: var(--milaura-font-heading);
    color: var(--milaura-text);
    font-size: 1.1rem;
    font-weight: 700;
  }

  /* B√©n√©fices */
  #MilauraQuiz-{{ section.id }} .quiz-result-benefits-title {
    font-family: var(--milaura-font-heading);
    color: var(--milaura-gold);
    font-size: 1rem;
    font-weight: 700;
    margin-bottom: var(--milaura-spacing-sm);
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  #MilauraQuiz-{{ section.id }} .quiz-result-bullets {
    font-family: var(--milaura-font-body);
    color: var(--milaura-text);
    font-size: 0.95rem;
    line-height: 1.8;
    margin-bottom: var(--milaura-spacing-md);
  }

  #MilauraQuiz-{{ section.id }} .quiz-result-bullets ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  #MilauraQuiz-{{ section.id }} .quiz-result-bullets li {
    padding-left: 28px;
    position: relative;
    margin-bottom: 10px;
  }

  #MilauraQuiz-{{ section.id }} .quiz-result-bullets li::before {
    content: '‚úß';
    position: absolute;
    left: 0;
    color: var(--milaura-gold);
    font-size: 1.1rem;
  }

  /* Mantra */
  #MilauraQuiz-{{ section.id }} .quiz-result-mantra {
    font-family: var(--milaura-font-script);
    color: var(--milaura-gold);
    font-size: 1.4rem;
    font-style: italic;
    text-align: center;
    margin: var(--milaura-spacing-md) 0;
    padding: var(--milaura-spacing-md);
    background: linear-gradient(135deg, rgba(192, 160, 98, 0.08), rgba(192, 160, 98, 0.15));
    border-radius: var(--milaura-border-radius-sm);
    border-left: 3px solid var(--milaura-gold);
  }

  /* Carte m√©t√©o (colonne droite) */
  #MilauraQuiz-{{ section.id }} .quiz-result-mood-card {
    background: rgba(255, 255, 255, 0.6);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(192, 160, 98, 0.15);
    border-radius: var(--milaura-border-radius);
    padding: var(--milaura-spacing-lg);
  }

  #MilauraQuiz-{{ section.id }} .quiz-mood-header {
    text-align: center;
    margin-bottom: var(--milaura-spacing-lg);
  }

  #MilauraQuiz-{{ section.id }} .quiz-mood-icon {
    font-size: 2.5rem;
    margin-bottom: var(--milaura-spacing-sm);
  }

  #MilauraQuiz-{{ section.id }} .quiz-mood-title {
    font-family: var(--milaura-font-heading);
    color: var(--milaura-gold);
    font-size: 1.3rem;
    font-weight: 700;
    margin-bottom: 4px;
  }

  #MilauraQuiz-{{ section.id }} .quiz-mood-subtitle {
    font-family: var(--milaura-font-body);
    color: var(--milaura-text-light);
    font-size: 0.85rem;
  }

  #MilauraQuiz-{{ section.id }} .quiz-mood-gauge {
    margin-bottom: var(--milaura-spacing-md);
  }

  #MilauraQuiz-{{ section.id }} .quiz-mood-gauge-label {
    font-family: var(--milaura-font-body);
    color: var(--milaura-text);
    font-size: 0.85rem;
    font-weight: 600;
    margin-bottom: 6px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  #MilauraQuiz-{{ section.id }} .quiz-mood-gauge-label .emotion-name {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  #MilauraQuiz-{{ section.id }} .quiz-mood-gauge-label .emotion-icon {
    font-size: 1rem;
  }

  #MilauraQuiz-{{ section.id }} .quiz-mood-gauge-bar {
    width: 100%;
    height: 10px;
    background: rgba(192, 160, 98, 0.12);
    border-radius: 10px;
    overflow: hidden;
    position: relative;
  }

  #MilauraQuiz-{{ section.id }} .quiz-mood-gauge-fill {
    height: 100%;
    border-radius: 10px;
    transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
  }

  #MilauraQuiz-{{ section.id }} .quiz-mood-gauge-fill.is-winner {
    background: linear-gradient(90deg, var(--milaura-gold) 0%, var(--milaura-gold-light) 100%);
    box-shadow: 0 2px 8px rgba(192, 160, 98, 0.4);
  }

  #MilauraQuiz-{{ section.id }} .quiz-mood-gauge-fill:not(.is-winner) {
    background: linear-gradient(90deg, rgba(192, 160, 98, 0.35) 0%, rgba(192, 160, 98, 0.2) 100%);
  }

  /* Invitation compte */
  #MilauraQuiz-{{ section.id }} .quiz-result-account-invite {
    margin-top: var(--milaura-spacing-lg);
    padding-top: var(--milaura-spacing-lg);
    border-top: 1px solid rgba(192, 160, 98, 0.2);
    text-align: center;
  }

  #MilauraQuiz-{{ section.id }} .quiz-result-account-text {
    font-family: var(--milaura-font-body);
    color: var(--milaura-text);
    font-size: 0.9rem;
    margin-bottom: var(--milaura-spacing-sm);
  }

  #MilauraQuiz-{{ section.id }} .quiz-result-account-link {
    display: inline-block;
    color: var(--milaura-gold);
    font-weight: 600;
    text-decoration: underline;
    transition: color 0.3s ease;
  }

  #MilauraQuiz-{{ section.id }} .quiz-result-account-link:hover {
    color: var(--milaura-gold-dark);
  }

  /* Footer r√©sultat */
  #MilauraQuiz-{{ section.id }} .quiz-result-footer {
    margin-top: var(--milaura-spacing-xl);
    padding-top: var(--milaura-spacing-lg);
    border-top: 1px solid rgba(192, 160, 98, 0.15);
    text-align: center;
  }

  #MilauraQuiz-{{ section.id }} .quiz-result-restart {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    color: var(--milaura-gold);
    font-family: var(--milaura-font-body);
    font-size: 0.9rem;
    font-weight: 600;
    text-decoration: none;
    padding: 12px 24px;
    border: 1px solid var(--milaura-gold);
    border-radius: var(--milaura-border-radius-sm);
    background: transparent;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  #MilauraQuiz-{{ section.id }} .quiz-result-restart:hover {
    background: rgba(192, 160, 98, 0.1);
  }

  /* --- LIEN DERNI√àRE R√âV√âLATION --- */
  #MilauraQuiz-{{ section.id }} .quiz-last-result-link {
    text-align: center;
    margin-bottom: var(--milaura-spacing-md);
  }

  #MilauraQuiz-{{ section.id }} .quiz-last-result-link a {
    font-family: var(--milaura-font-body);
    color: var(--milaura-gold);
    text-decoration: none;
    font-size: 0.95rem;
    font-weight: 600;
    text-decoration: underline;
    transition: color 0.3s ease;
  }

  #MilauraQuiz-{{ section.id }} .quiz-last-result-link a:hover {
    color: var(--milaura-gold-dark);
  }

  /* --- TABLETTE --- */
  @media screen and (max-width: 1200px) {
    #MilauraQuiz-{{ section.id }} .quiz-result-layout {
      grid-template-columns: 1fr 1fr;
      gap: var(--milaura-spacing-md);
    }

    #MilauraQuiz-{{ section.id }} .quiz-result-mood-card {
      grid-column: 1 / -1;
    }

    #MilauraQuiz-{{ section.id }} .quiz-result-main-title {
      font-size: 2rem;
    }
  }

  /* --- MOBILE --- */
  @media screen and (max-width: 990px) {
    #MilauraQuiz-{{ section.id }} {
      padding: var(--milaura-spacing-md) var(--milaura-spacing-xs);
    }

    #MilauraQuiz-{{ section.id }} .quiz-intro-title {
      font-size: 2rem;
    }

    #MilauraQuiz-{{ section.id }} .quiz-expert-block {
      flex-direction: column;
      text-align: center;
    }

    #MilauraQuiz-{{ section.id }} .quiz-answers {
      grid-template-columns: 1fr;
    }

    #MilauraQuiz-{{ section.id }} .quiz-result-layout {
      grid-template-columns: 1fr;
    }

    #MilauraQuiz-{{ section.id }} .quiz-result-product-card {
      order: 1;
    }

    #MilauraQuiz-{{ section.id }} .quiz-result-desc-card {
      order: 2;
    }

    #MilauraQuiz-{{ section.id }} .quiz-result-mood-card {
      order: 3;
    }

    #MilauraQuiz-{{ section.id }} .quiz-result-header {
      margin-bottom: var(--milaura-spacing-lg);
    }

    #MilauraQuiz-{{ section.id }} .quiz-result-main-title {
      font-size: 1.8rem;
    }

    #MilauraQuiz-{{ section.id }} .quiz-result-profile-name {
      font-size: 1.4rem;
    }

    #MilauraQuiz-{{ section.id }} .quiz-transition-title {
      font-size: 1.8rem;
    }

    #MilauraQuiz-{{ section.id }} .quiz-transition-subtitle {
      font-size: 1.3rem;
    }

    #MilauraQuiz-{{ section.id }} .quiz-result-duo {
      grid-template-columns: 1fr 1fr;
    }
  }

  @media screen and (max-width: 480px) {
    #MilauraQuiz-{{ section.id }} .quiz-intro-title {
      font-size: 1.75rem;
    }

    #MilauraQuiz-{{ section.id }} .quiz-question-title {
      font-size: 1.5rem;
    }

    #MilauraQuiz-{{ section.id }} .quiz-transition-title {
      font-size: 1.5rem;
    }

    #MilauraQuiz-{{ section.id }} .quiz-result-main-title {
      font-size: 1.5rem;
    }

    #MilauraQuiz-{{ section.id }} .quiz-mood-title {
      font-size: 1.2rem;
    }

    #MilauraQuiz-{{ section.id }} .quiz-result-product-price {
      font-size: 1.5rem;
    }

    #MilauraQuiz-{{ section.id }} .quiz-result-cta-primary {
      padding: 14px 20px;
      font-size: 0.95rem;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    *, *::before, *::after {
      transition: none !important;
      animation: none !important;
    }
  }
{% endstyle %}

<div id="MilauraQuiz-{{ section.id }}">
  <div class="quiz-container milaura-section-card">
    <!-- Lien derni√®re r√©v√©lation (si existe) -->
    <div class="quiz-last-result-link" id="quiz-last-result-link-{{ section.id }}" style="display: none;">
      <a href="#" id="quiz-show-last-{{ section.id }}">Revoir ma derni√®re r√©v√©lation ‚ú®</a>
    </div>

    <!-- √âTAT 1 : INTRO -->
    <div class="quiz-state quiz-state-intro" data-state="intro">
      <div class="quiz-intro-card">
        {% if section.settings.intro_title != blank %}
          <h2 class="quiz-intro-title milaura-heading">{{ section.settings.intro_title }}</h2>
        {% endif %}

        {% if section.settings.intro_subtitle != blank %}
          <div class="quiz-intro-subtitle milaura-text">{{ section.settings.intro_subtitle }}</div>
        {% endif %}

        {% if section.settings.show_expert and section.settings.expert_image != blank %}
          <div class="quiz-expert-block">
            <img
              src="{{ section.settings.expert_image | image_url: width: 200 }}"
              alt="{{ section.settings.expert_name }}"
              class="quiz-expert-image"
              width="200"
              height="200"
            >
            <div class="quiz-expert-info">
              {% if section.settings.expert_name != blank %}
                <div class="quiz-expert-name">{{ section.settings.expert_name }}</div>
              {% endif %}
              {% if section.settings.expert_title != blank %}
                <div class="quiz-expert-title">{{ section.settings.expert_title }}</div>
              {% endif %}
              {% if section.settings.expert_text != blank %}
                <div class="quiz-expert-text milaura-text">{{ section.settings.expert_text }}</div>
              {% endif %}
            </div>
          </div>
        {% endif %}

        {% if section.settings.intro_button_label != blank %}
          <button
            type="button"
            class="milaura-cta"
            id="quiz-start-btn-{{ section.id }}"
          >
            {{ section.settings.intro_button_label }}
          </button>
        {% endif %}
      </div>
    </div>

    <!-- √âTAT 2 : QUESTIONS -->
    <div class="quiz-state quiz-state-questions" data-state="questions" style="display: none;">
      <div class="quiz-questions-header">
        <div class="quiz-progress-text" id="quiz-progress-text-{{ section.id }}">Question 1 sur 7</div>
        <div class="quiz-progress-bar">
          <div class="quiz-progress-fill" id="quiz-progress-fill-{{ section.id }}" style="width: 14.28%;"></div>
        </div>
      </div>

      <div class="quiz-question-card">
        <h3 class="quiz-question-title" id="quiz-question-title-{{ section.id }}"></h3>
        <div class="quiz-answers" id="quiz-answers-{{ section.id }}"></div>
      </div>
    </div>

    <!-- √âTAT 3 : TRANSITION -->
    <div class="quiz-state quiz-state-transition" data-state="transition" style="display: none;">
      <div class="quiz-transition-card">
        {% if section.settings.transition_title != blank %}
          <h2 class="quiz-transition-title milaura-heading">{{ section.settings.transition_title }}</h2>
        {% endif %}

        {% if section.settings.transition_subtitle != blank %}
          <div class="quiz-transition-subtitle milaura-heading-script">{{ section.settings.transition_subtitle }}</div>
        {% endif %}

        {% if section.settings.transition_body != blank %}
          <div class="quiz-transition-body milaura-text">{{ section.settings.transition_body }}</div>
        {% endif %}

        <div class="quiz-loader">
          <div class="quiz-loader-dot"></div>
          <div class="quiz-loader-dot"></div>
          <div class="quiz-loader-dot"></div>
        </div>
      </div>
    </div>

    <!-- √âTAT 4 : RESULT - DASHBOARD PREMIUM -->
    <div class="quiz-state quiz-state-result" data-state="result" style="display: none;">

      <!-- Header du r√©sultat -->
      <div class="quiz-result-header">
        <div class="quiz-result-kicker">Analyse compl√®te</div>
        <h2 class="quiz-result-main-title" id="quiz-result-main-title-{{ section.id }}">Ta bougie du moment</h2>
        <div class="quiz-result-profile-name" id="quiz-result-profile-name-{{ section.id }}"></div>
      </div>

      <!-- Layout 3 colonnes -->
      <div class="quiz-result-layout">

        <!-- Colonne gauche : Produit -->
        <div class="quiz-result-product-card">
          <div class="quiz-result-product-badge">Recommand√© pour toi</div>
          <div id="quiz-result-product-{{ section.id }}">
            <!-- Inject√© par JS : image, titre, prix -->
          </div>
          <div id="quiz-result-cta-{{ section.id }}">
            <!-- Inject√© par JS : boutons CTA -->
          </div>
        </div>

        <!-- Colonne centrale : Description & Duo -->
        <div class="quiz-result-desc-card">
          <div class="quiz-result-profile-intro" id="quiz-result-profile-desc-{{ section.id }}">
            <!-- Inject√© par JS : description du profil -->
          </div>

          <!-- Duo Pierre + Senteur -->
          <div class="quiz-result-duo" id="quiz-result-duo-{{ section.id }}">
            <div class="quiz-result-duo-item">
              <div class="quiz-result-duo-icon">üíé</div>
              <div class="quiz-result-duo-label">Ta pierre</div>
              <div class="quiz-result-duo-name" id="quiz-result-stone-{{ section.id }}">-</div>
            </div>
            <div class="quiz-result-duo-item">
              <div class="quiz-result-duo-icon">üå∏</div>
              <div class="quiz-result-duo-label">Ta senteur</div>
              <div class="quiz-result-duo-name" id="quiz-result-scent-{{ section.id }}">-</div>
            </div>
          </div>

          <!-- B√©n√©fices -->
          <div class="quiz-result-benefits-title">Ce que cette bougie t'apporte</div>
          <div class="quiz-result-bullets" id="quiz-result-bullets-{{ section.id }}">
            <!-- Inject√© par JS -->
          </div>

          <!-- Mantra -->
          <div class="quiz-result-mantra" id="quiz-result-mantra-{{ section.id }}">
            <!-- Inject√© par JS -->
          </div>
        </div>

        <!-- Colonne droite : M√©t√©o √©motionnelle -->
        <div class="quiz-result-mood-card">
          <div class="quiz-mood-header">
            <div class="quiz-mood-icon">üå§Ô∏è</div>
            <h3 class="quiz-mood-title">Ta m√©t√©o √©motionnelle</h3>
            <div class="quiz-mood-subtitle">Bas√©e sur tes 7 r√©ponses</div>
          </div>
          <div id="quiz-mood-gauges-{{ section.id }}">
            <!-- Inject√© par JS : gauges par √©motion -->
          </div>

          <!-- Invitation compte (pour guests) -->
          <div class="quiz-result-account-invite" id="quiz-account-invite-{{ section.id }}">
            <p class="quiz-result-account-text">Cr√©e ton compte pour sauvegarder ton profil √©motionnel</p>
            <a href="/account/register" class="quiz-result-account-link">Cr√©er mon compte ‚Üí</a>
          </div>
        </div>
      </div>

      <!-- Footer avec bouton refaire -->
      <div class="quiz-result-footer">
        <button type="button" class="quiz-result-restart" id="quiz-restart-btn-{{ section.id }}">
          <span>‚Ü∫</span> Refaire mon diagnostic
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  (function() {
    const sectionId = '{{ section.id }}';
    const container = document.querySelector('#MilauraQuiz-' + sectionId);
    if (!container) return;

    // ============================================
    // STATE MACHINE
    // ============================================
    const QuizState = {
      INTRO: 'intro',
      QUESTIONS: 'questions',
      TRANSITION: 'transition',
      RESULT: 'result'
    };

    let currentState = QuizState.INTRO;
    let currentQuestionIndex = 0;
    let scores = {
      reconfort: 0,
      protection: 0,
      serenite: 0,
      elegance: 0,
      joie: 0
    };

    // Profils disponibles (fixes dans le JS)
    const profiles = ['reconfort', 'protection', 'serenite', 'elegance', 'joie'];

    // Donn√©es des profils depuis Liquid avec pierre et senteur
    const profileData = {
      reconfort: {
        label: {{ section.settings.profile_comfort_label | json }},
        displayName: "R√©confort",
        description: {{ section.settings.profile_comfort_description | json }},
        bullets: {{ section.settings.profile_comfort_bullets | json }},
        mantra: {{ section.settings.profile_comfort_mantra | json }},
        stone: "Calc√©doine bleue",
        scent: "N√©roli",
        icon: "ü§ç",
        product: {% if section.settings.profile_comfort_product %}{
          title: {{ section.settings.profile_comfort_product.title | json }},
          url: {{ section.settings.profile_comfort_product.url | json }},
          price: {{ section.settings.profile_comfort_product.price | money | json }},
          featured_image: {% if section.settings.profile_comfort_product.featured_image %}{{ section.settings.profile_comfort_product.featured_image | image_url: width: 600 | json }}{% else %}null{% endif %},
          handle: {{ section.settings.profile_comfort_product.handle | json }},
          variant_id: {% if section.settings.profile_comfort_product.selected_or_first_available_variant %}{{ section.settings.profile_comfort_product.selected_or_first_available_variant.id | json }}{% else %}null{% endif %}
        }{% else %}null{% endif %}
      },
      protection: {
        label: {{ section.settings.profile_protection_label | json }},
        displayName: "Protection",
        description: {{ section.settings.profile_protection_description | json }},
        bullets: {{ section.settings.profile_protection_bullets | json }},
        mantra: {{ section.settings.profile_protection_mantra | json }},
        stone: "Obsidienne noire",
        scent: "Bois d'Oud",
        icon: "üõ°Ô∏è",
        product: {% if section.settings.profile_protection_product %}{
          title: {{ section.settings.profile_protection_product.title | json }},
          url: {{ section.settings.profile_protection_product.url | json }},
          price: {{ section.settings.profile_protection_product.price | money | json }},
          featured_image: {% if section.settings.profile_protection_product.featured_image %}{{ section.settings.profile_protection_product.featured_image | image_url: width: 600 | json }}{% else %}null{% endif %},
          handle: {{ section.settings.profile_protection_product.handle | json }},
          variant_id: {% if section.settings.profile_protection_product.selected_or_first_available_variant %}{{ section.settings.profile_protection_product.selected_or_first_available_variant.id | json }}{% else %}null{% endif %}
        }{% else %}null{% endif %}
      },
      serenite: {
        label: {{ section.settings.profile_serenity_label | json }},
        displayName: "S√©r√©nit√©",
        description: {{ section.settings.profile_serenity_description | json }},
        bullets: {{ section.settings.profile_serenity_bullets | json }},
        mantra: {{ section.settings.profile_serenity_mantra | json }},
        stone: "Am√©thyste",
        scent: "Th√© blanc",
        icon: "üßò",
        product: {% if section.settings.profile_serenity_product %}{
          title: {{ section.settings.profile_serenity_product.title | json }},
          url: {{ section.settings.profile_serenity_product.url | json }},
          price: {{ section.settings.profile_serenity_product.price | money | json }},
          featured_image: {% if section.settings.profile_serenity_product.featured_image %}{{ section.settings.profile_serenity_product.featured_image | image_url: width: 600 | json }}{% else %}null{% endif %},
          handle: {{ section.settings.profile_serenity_product.handle | json }},
          variant_id: {% if section.settings.profile_serenity_product.selected_or_first_available_variant %}{{ section.settings.profile_serenity_product.selected_or_first_available_variant.id | json }}{% else %}null{% endif %}
        }{% else %}null{% endif %}
      },
      elegance: {
        label: {{ section.settings.profile_elegance_label | json }},
        displayName: "√âl√©gance",
        description: {{ section.settings.profile_elegance_description | json }},
        bullets: {{ section.settings.profile_elegance_bullets | json }},
        mantra: {{ section.settings.profile_elegance_mantra | json }},
        stone: "Quartz rose",
        scent: "Ambre gris",
        icon: "‚ú®",
        product: {% if section.settings.profile_elegance_product %}{
          title: {{ section.settings.profile_elegance_product.title | json }},
          url: {{ section.settings.profile_elegance_product.url | json }},
          price: {{ section.settings.profile_elegance_product.price | money | json }},
          featured_image: {% if section.settings.profile_elegance_product.featured_image %}{{ section.settings.profile_elegance_product.featured_image | image_url: width: 600 | json }}{% else %}null{% endif %},
          handle: {{ section.settings.profile_elegance_product.handle | json }},
          variant_id: {% if section.settings.profile_elegance_product.selected_or_first_available_variant %}{{ section.settings.profile_elegance_product.selected_or_first_available_variant.id | json }}{% else %}null{% endif %}
        }{% else %}null{% endif %}
      },
      joie: {
        label: {{ section.settings.profile_joy_label | json }},
        displayName: "Joie de vivre",
        description: {{ section.settings.profile_joy_description | json }},
        bullets: {{ section.settings.profile_joy_bullets | json }},
        mantra: {{ section.settings.profile_joy_mantra | json }},
        stone: "Aventurine verte",
        scent: "Fleur d'oranger",
        icon: "‚òÄÔ∏è",
        product: {% if section.settings.profile_joy_product %}{
          title: {{ section.settings.profile_joy_product.title | json }},
          url: {{ section.settings.profile_joy_product.url | json }},
          price: {{ section.settings.profile_joy_product.price | money | json }},
          featured_image: {% if section.settings.profile_joy_product.featured_image %}{{ section.settings.profile_joy_product.featured_image | image_url: width: 600 | json }}{% else %}null{% endif %},
          handle: {{ section.settings.profile_joy_product.handle | json }},
          variant_id: {% if section.settings.profile_joy_product.selected_or_first_available_variant %}{{ section.settings.profile_joy_product.selected_or_first_available_variant.id | json }}{% else %}null{% endif %}
        }{% else %}null{% endif %}
      }
    };

    // V√©rifier si l'utilisateur est connect√©
    const isCustomerLoggedIn = {{ customer | json }} !== null;

    // R√©cup√©rer les questions depuis les blocks Liquid
    const questionsData = [];
    {% for block in section.blocks %}
      {% if block.type == 'question' %}
        questionsData.push({
          id: '{{ block.id }}',
          label: {{ block.settings.question_label | json }},
          answers: [
            {% if block.settings.answer_1_label != blank %}
              { label: {{ block.settings.answer_1_label | json }}, profile: {{ block.settings.answer_1_profile | json }} },
            {% endif %}
            {% if block.settings.answer_2_label != blank %}
              { label: {{ block.settings.answer_2_label | json }}, profile: {{ block.settings.answer_2_profile | json }} },
            {% endif %}
            {% if block.settings.answer_3_label != blank %}
              { label: {{ block.settings.answer_3_label | json }}, profile: {{ block.settings.answer_3_profile | json }} },
            {% endif %}
            {% if block.settings.answer_4_label != blank %}
              { label: {{ block.settings.answer_4_label | json }}, profile: {{ block.settings.answer_4_profile | json }} }
            {% endif %}
          ]
        });
      {% endif %}
    {% endfor %}

    // ============================================
    // FONCTIONS DE NAVIGATION
    // ============================================
    let hasUserInteracted = false; // Flag pour √©viter le scroll au chargement initial

    function goToState(state, shouldScroll = true) {
      const states = container.querySelectorAll('.quiz-state');
      states.forEach(s => {
        s.classList.remove('is-active');
        s.style.display = 'none';
      });

      const targetState = container.querySelector(`.quiz-state-${state}`);
      if (targetState) {
        targetState.style.display = 'block';
        setTimeout(() => {
          targetState.classList.add('is-active');
        }, 10);
      }

      currentState = state;

      // Scroll vers le haut de la section quiz SEULEMENT apr√®s interaction utilisateur
      // et pas pour l'√©tat initial (intro)
      if (shouldScroll && hasUserInteracted && state !== QuizState.INTRO) {
        setTimeout(() => {
          container.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 50);
      }
    }

    function goToIntro() {
      goToState(QuizState.INTRO);
    }

    function goToQuestions() {
      currentQuestionIndex = 0;
      scores = {
        reconfort: 0,
        protection: 0,
        serenite: 0,
        elegance: 0,
        joie: 0
      };
      goToState(QuizState.QUESTIONS);
      displayQuestion(0);
    }

    function goToTransition() {
      goToState(QuizState.TRANSITION);
      const duration = {{ section.settings.transition_duration_ms | default: 3000 }};
      setTimeout(() => {
        goToResult();
      }, duration);
    }

    function goToResult() {
      calculateResults();
      displayResults();
      goToState(QuizState.RESULT);
    }

    // ============================================
    // LOGIQUE DES QUESTIONS
    // ============================================
    function displayQuestion(index) {
      if (index >= questionsData.length) {
        goToTransition();
        return;
      }

      const question = questionsData[index];
      const questionTitleEl = container.querySelector('#quiz-question-title-' + sectionId);
      const answersEl = container.querySelector('#quiz-answers-' + sectionId);
      const progressTextEl = container.querySelector('#quiz-progress-text-' + sectionId);
      const progressFillEl = container.querySelector('#quiz-progress-fill-' + sectionId);

      if (questionTitleEl) {
        questionTitleEl.textContent = question.label;
      }

      if (progressTextEl) {
        progressTextEl.textContent = `Question ${index + 1} sur ${questionsData.length}`;
      }

      if (progressFillEl) {
        const progress = ((index + 1) / questionsData.length) * 100;
        progressFillEl.style.width = progress + '%';
      }

      if (answersEl) {
        answersEl.innerHTML = '';
        question.answers.forEach((answer, i) => {
          const btn = document.createElement('button');
          btn.type = 'button';
          btn.className = 'quiz-answer-btn';
          btn.textContent = answer.label;
          btn.addEventListener('click', () => {
            handleAnswer(answer.profile);
          });
          answersEl.appendChild(btn);
        });
      }
    }

    function handleAnswer(profile) {
      if (profiles.includes(profile)) {
        scores[profile] = (scores[profile] || 0) + 1;
      }

      currentQuestionIndex++;
      displayQuestion(currentQuestionIndex);
    }

    // ============================================
    // CALCUL DES R√âSULTATS
    // ============================================
    function calculateResults() {
      const totalScore = Object.values(scores).reduce((sum, val) => sum + val, 0);
      const percentages = {};
      let winnerProfile = null;
      let maxScore = -1;

      profiles.forEach(profile => {
        const score = scores[profile] || 0;
        percentages[profile] = totalScore > 0 ? Math.round((score / totalScore) * 100) : 0;
        if (score > maxScore) {
          maxScore = score;
          winnerProfile = profile;
        }
      });

      return {
        winnerProfile: winnerProfile,
        scores: scores,
        percentages: percentages,
        totalScore: totalScore
      };
    }

    // ============================================
    // AFFICHAGE DES R√âSULTATS - DASHBOARD PREMIUM
    // ============================================
    function displayResults() {
      const results = calculateResults();
      const winnerProfile = results.winnerProfile;

      const profile = profileData[winnerProfile];
      if (!profile) return;

      // === HEADER ===
      const mainTitleEl = container.querySelector('#quiz-result-main-title-' + sectionId);
      if (mainTitleEl) {
        const mainTitle = {{ section.settings.result_main_title | json }};
        mainTitleEl.textContent = mainTitle || 'Ta bougie du moment';
      }

      const profileNameEl = container.querySelector('#quiz-result-profile-name-' + sectionId);
      if (profileNameEl) {
        profileNameEl.textContent = profile.displayName || profile.label;
      }

      // === COLONNE PRODUIT ===
      const productEl = container.querySelector('#quiz-result-product-' + sectionId);
      if (productEl && profile.product) {
        const product = profile.product;
        let html = '';

        if (product.featured_image) {
          html += `<img src="${product.featured_image}" alt="${product.title}" class="quiz-result-product-image">`;
        } else {
          html += `<div class="quiz-result-product-image" style="background: linear-gradient(135deg, var(--milaura-beige), #f5f0e8); display: flex; align-items: center; justify-content: center; font-size: 3rem;">üïØÔ∏è</div>`;
        }

        html += `<h3 class="quiz-result-product-title">${product.title || profile.label}</h3>`;

        if (product.price) {
          html += `<div class="quiz-result-product-price">${product.price}</div>`;
        }

        productEl.innerHTML = html;
      }

      // === CTA BOUTONS ===
      const ctaEl = container.querySelector('#quiz-result-cta-' + sectionId);
      if (ctaEl && profile.product) {
        const product = profile.product;
        let html = '';

        if (product.variant_id) {
          html += `<button type="button" class="quiz-result-cta-primary" id="quiz-add-to-cart-btn-${sectionId}" onclick="addToCartWithFeedback(${product.variant_id}, this)">Ajouter au panier</button>`;
        }

        if (product.handle) {
          // Force le template milaura avec ?view=milaura
          html += `<a href="/products/${product.handle}?view=milaura" class="quiz-result-cta-secondary">D√©couvrir mon rituel ‚Üí</a>`;
        }

        ctaEl.innerHTML = html;
      }

      // === DESCRIPTION DU PROFIL ===
      const profileDescEl = container.querySelector('#quiz-result-profile-desc-' + sectionId);
      if (profileDescEl && profile.description) {
        profileDescEl.innerHTML = profile.description;
      }

      // === DUO PIERRE + SENTEUR ===
      const stoneEl = container.querySelector('#quiz-result-stone-' + sectionId);
      if (stoneEl && profile.stone) {
        stoneEl.textContent = profile.stone;
      }

      const scentEl = container.querySelector('#quiz-result-scent-' + sectionId);
      if (scentEl && profile.scent) {
        scentEl.textContent = profile.scent;
      }

      // === BULLETS ===
      const bulletsEl = container.querySelector('#quiz-result-bullets-' + sectionId);
      if (bulletsEl && profile.bullets) {
        bulletsEl.innerHTML = profile.bullets;
      }

      // === MANTRA ===
      const mantraEl = container.querySelector('#quiz-result-mantra-' + sectionId);
      if (mantraEl && profile.mantra) {
        mantraEl.textContent = `¬´ ${profile.mantra} ¬ª`;
      }

      // === M√âT√âO √âMOTIONNELLE ===
      const gaugesEl = container.querySelector('#quiz-mood-gauges-' + sectionId);
      if (gaugesEl) {
        gaugesEl.innerHTML = '';

        // Trier par pourcentage d√©croissant
        const sortedProfiles = [...profiles].sort((a, b) =>
          (results.percentages[b] || 0) - (results.percentages[a] || 0)
        );

        sortedProfiles.forEach(profileId => {
          const profileInfo = profileData[profileId];
          const percentage = results.percentages[profileId] || 0;
          const isWinner = profileId === winnerProfile;

          const gauge = document.createElement('div');
          gauge.className = 'quiz-mood-gauge';

          const label = document.createElement('div');
          label.className = 'quiz-mood-gauge-label';
          label.innerHTML = `
            <span class="emotion-name">
              <span class="emotion-icon">${profileInfo.icon || '‚óã'}</span>
              ${profileInfo.displayName || profileId}
            </span>
            <span>${percentage}%</span>
          `;

          const bar = document.createElement('div');
          bar.className = 'quiz-mood-gauge-bar';

          const fill = document.createElement('div');
          fill.className = 'quiz-mood-gauge-fill' + (isWinner ? ' is-winner' : '');
          // Animation : commence √† 0 puis anime vers la valeur
          fill.style.width = '0%';

          bar.appendChild(fill);
          gauge.appendChild(label);
          gauge.appendChild(bar);
          gaugesEl.appendChild(gauge);

          // Animer apr√®s un d√©lai
          setTimeout(() => {
            fill.style.width = percentage + '%';
          }, 100);
        });
      }

      // === INVITATION COMPTE ===
      const accountInviteEl = container.querySelector('#quiz-account-invite-' + sectionId);
      if (accountInviteEl) {
        // Cacher si l'utilisateur est d√©j√† connect√©
        if (isCustomerLoggedIn) {
          accountInviteEl.style.display = 'none';
        }
      }

      // === STOCKAGE LOCAL ===
      const storageData = {
        profileId: winnerProfile,
        profileName: profile.displayName || profile.label,
        stone: profile.stone,
        scent: profile.scent,
        scores: results.scores,
        percentages: results.percentages,
        productHandle: profile.product ? profile.product.handle : null,
        productTitle: profile.product ? profile.product.title : null,
        timestamp: Date.now()
      };
      localStorage.setItem('milauraLastResult', JSON.stringify(storageData));
    }

    // Fonction globale pour ajouter au panier avec feedback visuel
    window.addToCartWithFeedback = function(variantId, buttonEl) {
      const originalText = buttonEl.textContent;
      buttonEl.textContent = 'Ajout en cours...';
      buttonEl.disabled = true;

      fetch('/cart/add.js', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id: variantId, quantity: 1 })
      })
      .then(response => response.json())
      .then(() => {
        buttonEl.textContent = '‚úì Ajout√© au panier';
        buttonEl.style.background = 'linear-gradient(135deg, #4CAF50, #66BB6A)';

        // Remettre le bouton normal apr√®s 2s
        setTimeout(() => {
          buttonEl.textContent = originalText;
          buttonEl.style.background = '';
          buttonEl.disabled = false;
        }, 2000);

        // Mettre √† jour le compteur du panier si pr√©sent
        if (typeof window.updateCartCount === 'function') {
          window.updateCartCount();
        }
      })
      .catch(error => {
        console.error('Erreur ajout panier:', error);
        buttonEl.textContent = 'Erreur - R√©essayer';
        buttonEl.style.background = 'linear-gradient(135deg, #f44336, #e57373)';
        buttonEl.disabled = false;

        setTimeout(() => {
          buttonEl.textContent = originalText;
          buttonEl.style.background = '';
        }, 2000);
      });
    };

    // ============================================
    // GESTION DU LOCALSTORAGE
    // ============================================
    function checkLastResult() {
      const lastResult = localStorage.getItem('milauraLastResult');
      if (lastResult) {
        try {
          const data = JSON.parse(lastResult);
          const linkEl = container.querySelector('#quiz-last-result-link-' + sectionId);
          const showLinkEl = container.querySelector('#quiz-show-last-' + sectionId);
          
          if (linkEl) linkEl.style.display = 'block';
          if (showLinkEl) {
            showLinkEl.addEventListener('click', (e) => {
              e.preventDefault();
              hasUserInteracted = true; // Activer le scroll
              // Recharger les r√©sultats depuis localStorage
              const storedData = JSON.parse(localStorage.getItem('milauraLastResult'));
              scores = storedData.scores;
              displayResults();
              goToState(QuizState.RESULT);
            });
          }
        } catch (e) {
          console.error('Error parsing last result:', e);
        }
      }
    }

    // ============================================
    // INITIALISATION
    // ============================================
    function init() {
      // Bouton start
      const startBtn = container.querySelector('#quiz-start-btn-' + sectionId);
      if (startBtn) {
        startBtn.addEventListener('click', () => {
          hasUserInteracted = true; // Activer le scroll apr√®s la premi√®re interaction
          goToQuestions();
        });
      }

      // Bouton restart
      const restartBtn = container.querySelector('#quiz-restart-btn-' + sectionId);
      if (restartBtn) {
        restartBtn.addEventListener('click', () => {
          // Reset les scores
          scores = {
            reconfort: 0,
            protection: 0,
            serenite: 0,
            elegance: 0,
            joie: 0
          };
          currentQuestionIndex = 0;
          goToQuestions();
        });
      }

      // V√©rifier derni√®re r√©v√©lation
      checkLastResult();

      // Afficher l'√©tat initial
      goToState(QuizState.INTRO);
    }

    // D√©marrer quand le DOM est pr√™t
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  })();
</script>

{% schema %}
{
  "name": "Milaura Quiz",
  "enabled_on": {
    "templates": ["*"]
  },
  "settings": [
    {
      "type": "header",
      "content": "Introduction"
    },
    {
      "type": "text",
      "id": "intro_title",
      "label": "Titre d'introduction",
      "default": "Bienvenue dans ton rituel int√©rieur"
    },
    {
      "type": "richtext",
      "id": "intro_subtitle",
      "label": "Sous-titre d'introduction",
      "default": "<p>D√©couvre ta bougie √©motionnelle personnalis√©e en r√©pondant √† quelques questions.</p>"
    },
    {
      "type": "text",
      "id": "intro_button_label",
      "label": "Label du bouton",
      "default": "Commencer le rituel"
    },
    {
      "type": "header",
      "content": "Bloc Experte"
    },
    {
      "type": "checkbox",
      "id": "show_expert",
      "label": "Afficher le bloc experte",
      "default": true
    },
    {
      "type": "image_picker",
      "id": "expert_image",
      "label": "Photo de l'experte"
    },
    {
      "type": "text",
      "id": "expert_name",
      "label": "Nom de l'experte",
      "default": "Lorraine Vidal"
    },
    {
      "type": "text",
      "id": "expert_title",
      "label": "Titre de l'experte",
      "default": "Fondatrice & Experte en aromath√©rapie"
    },
    {
      "type": "richtext",
      "id": "expert_text",
      "label": "Texte de l'experte",
      "default": "<p>Je t'accompagne dans cette d√©couverte de ton profil √©motionnel unique.</p>"
    },
    {
      "type": "header",
      "content": "Transition"
    },
    {
      "type": "text",
      "id": "transition_title",
      "label": "Titre de transition",
      "default": "Nous r√©unissons nos √©nergies pour r√©v√©ler ta cr√©ation unique‚Ä¶"
    },
    {
      "type": "text",
      "id": "transition_subtitle",
      "label": "Sous-titre de transition",
      "default": "Ce n'est pas un quiz. C'est un miroir √©motionnel."
    },
    {
      "type": "richtext",
      "id": "transition_body",
      "label": "Texte de transition",
      "default": "<p>Notre approche allie la science neuro-olfactive et l'art de la cr√©ation sensorielle pour r√©v√©ler ta bougie personnalis√©e.</p>"
    },
    {
      "type": "number",
      "id": "transition_duration_ms",
      "label": "Dur√©e de la transition (ms)",
      "default": 3000
    },
    {
      "type": "header",
      "content": "R√©sultats"
    },
    {
      "type": "text",
      "id": "result_main_title",
      "label": "Titre principal des r√©sultats",
      "default": "Ta bougie du moment"
    },
    {
      "type": "text",
      "id": "result_mood_title",
      "label": "Titre m√©t√©o √©motionnelle",
      "default": "Ta m√©t√©o √©motionnelle"
    },
    {
      "type": "header",
      "content": "Profil : R√©confort"
    },
    {
      "type": "text",
      "id": "profile_comfort_label",
      "label": "Label",
      "default": "R√©confort"
    },
    {
      "type": "richtext",
      "id": "profile_comfort_description",
      "label": "Description",
      "default": "<p>Tu cherches l'apaisement et la douceur. Cette bougie t'apportera le r√©confort dont tu as besoin.</p>"
    },
    {
      "type": "product",
      "id": "profile_comfort_product",
      "label": "Produit associ√©"
    },
    {
      "type": "richtext",
      "id": "profile_comfort_bullets",
      "label": "B√©n√©fices (liste)",
      "default": "<ul><li>Apaisement imm√©diat</li><li>R√©confort √©motionnel</li><li>Moment de douceur</li></ul>"
    },
    {
      "type": "text",
      "id": "profile_comfort_mantra",
      "label": "Mantra",
      "default": "Je m'offre le r√©confort que je m√©rite"
    },
    {
      "type": "header",
      "content": "Profil : Protection"
    },
    {
      "type": "text",
      "id": "profile_protection_label",
      "label": "Label",
      "default": "Protection"
    },
    {
      "type": "richtext",
      "id": "profile_protection_description",
      "label": "Description",
      "default": "<p>Tu as besoin de te sentir prot√©g√©(e) et en s√©curit√©. Cette bougie cr√©era un bouclier √©nerg√©tique autour de toi.</p>"
    },
    {
      "type": "product",
      "id": "profile_protection_product",
      "label": "Produit associ√©"
    },
    {
      "type": "richtext",
      "id": "profile_protection_bullets",
      "label": "B√©n√©fices (liste)",
      "default": "<ul><li>Bouclier √©nerg√©tique</li><li>Protection √©motionnelle</li><li>Sentiment de s√©curit√©</li></ul>"
    },
    {
      "type": "text",
      "id": "profile_protection_mantra",
      "label": "Mantra",
      "default": "Je suis prot√©g√©(e) et en s√©curit√©"
    },
    {
      "type": "header",
      "content": "Profil : S√©r√©nit√©"
    },
    {
      "type": "text",
      "id": "profile_serenity_label",
      "label": "Label",
      "default": "S√©r√©nit√©"
    },
    {
      "type": "richtext",
      "id": "profile_serenity_description",
      "label": "Description",
      "default": "<p>Tu recherches la paix int√©rieure et la tranquillit√©. Cette bougie t'aidera √† trouver ton √©quilibre.</p>"
    },
    {
      "type": "product",
      "id": "profile_serenity_product",
      "label": "Produit associ√©"
    },
    {
      "type": "richtext",
      "id": "profile_serenity_bullets",
      "label": "B√©n√©fices (liste)",
      "default": "<ul><li>Paix int√©rieure</li><li>√âquilibre √©motionnel</li><li>Tranquillit√© d'esprit</li></ul>"
    },
    {
      "type": "text",
      "id": "profile_serenity_mantra",
      "label": "Mantra",
      "default": "Je trouve la paix en moi"
    },
    {
      "type": "header",
      "content": "Profil : √âl√©gance"
    },
    {
      "type": "text",
      "id": "profile_elegance_label",
      "label": "Label",
      "default": "√âl√©gance"
    },
    {
      "type": "richtext",
      "id": "profile_elegance_description",
      "label": "Description",
      "default": "<p>Tu appr√©cies la beaut√© et la sophistication. Cette bougie refl√®te ton raffinement.</p>"
    },
    {
      "type": "product",
      "id": "profile_elegance_product",
      "label": "Produit associ√©"
    },
    {
      "type": "richtext",
      "id": "profile_elegance_bullets",
      "label": "B√©n√©fices (liste)",
      "default": "<ul><li>Raffinement</li><li>Beaut√© int√©rieure</li><li>Sophistication</li></ul>"
    },
    {
      "type": "text",
      "id": "profile_elegance_mantra",
      "label": "Mantra",
      "default": "Je rayonne d'√©l√©gance"
    },
    {
      "type": "header",
      "content": "Profil : Joie"
    },
    {
      "type": "text",
      "id": "profile_joy_label",
      "label": "Label",
      "default": "Joie"
    },
    {
      "type": "richtext",
      "id": "profile_joy_description",
      "label": "Description",
      "default": "<p>Tu cherches la l√©g√®ret√© et la joie de vivre. Cette bougie apportera de la lumi√®re dans ta vie.</p>"
    },
    {
      "type": "product",
      "id": "profile_joy_product",
      "label": "Produit associ√©"
    },
    {
      "type": "richtext",
      "id": "profile_joy_bullets",
      "label": "B√©n√©fices (liste)",
      "default": "<ul><li>L√©g√®ret√©</li><li>Joie de vivre</li><li>√ânergie positive</li></ul>"
    },
    {
      "type": "text",
      "id": "profile_joy_mantra",
      "label": "Mantra",
      "default": "Je choisis la joie chaque jour"
    }
  ],
  "blocks": [
    {
      "type": "question",
      "name": "Question",
      "settings": [
        {
          "type": "text",
          "id": "question_label",
          "label": "Question",
          "default": "Comment te sens-tu en ce moment ?"
        },
        {
          "type": "text",
          "id": "answer_1_label",
          "label": "R√©ponse 1",
          "default": "J'ai besoin de r√©confort"
        },
        {
          "type": "select",
          "id": "answer_1_profile",
          "label": "Profil r√©ponse 1",
          "options": [
            {
              "value": "reconfort",
              "label": "R√©confort"
            },
            {
              "value": "protection",
              "label": "Protection"
            },
            {
              "value": "serenite",
              "label": "S√©r√©nit√©"
            },
            {
              "value": "elegance",
              "label": "√âl√©gance"
            },
            {
              "value": "joie",
              "label": "Joie"
            }
          ],
          "default": "reconfort"
        },
        {
          "type": "text",
          "id": "answer_2_label",
          "label": "R√©ponse 2",
          "default": "Je me sens vuln√©rable"
        },
        {
          "type": "select",
          "id": "answer_2_profile",
          "label": "Profil r√©ponse 2",
          "options": [
            {
              "value": "reconfort",
              "label": "R√©confort"
            },
            {
              "value": "protection",
              "label": "Protection"
            },
            {
              "value": "serenite",
              "label": "S√©r√©nit√©"
            },
            {
              "value": "elegance",
              "label": "√âl√©gance"
            },
            {
              "value": "joie",
              "label": "Joie"
            }
          ],
          "default": "protection"
        },
        {
          "type": "text",
          "id": "answer_3_label",
          "label": "R√©ponse 3 (optionnel)"
        },
        {
          "type": "select",
          "id": "answer_3_profile",
          "label": "Profil r√©ponse 3",
          "options": [
            {
              "value": "reconfort",
              "label": "R√©confort"
            },
            {
              "value": "protection",
              "label": "Protection"
            },
            {
              "value": "serenite",
              "label": "S√©r√©nit√©"
            },
            {
              "value": "elegance",
              "label": "√âl√©gance"
            },
            {
              "value": "joie",
              "label": "Joie"
            }
          ],
          "default": "serenite"
        },
        {
          "type": "text",
          "id": "answer_4_label",
          "label": "R√©ponse 4 (optionnel)"
        },
        {
          "type": "select",
          "id": "answer_4_profile",
          "label": "Profil r√©ponse 4",
          "options": [
            {
              "value": "reconfort",
              "label": "R√©confort"
            },
            {
              "value": "protection",
              "label": "Protection"
            },
            {
              "value": "serenite",
              "label": "S√©r√©nit√©"
            },
            {
              "value": "elegance",
              "label": "√âl√©gance"
            },
            {
              "value": "joie",
              "label": "Joie"
            }
          ],
          "default": "elegance"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Milaura Quiz",
      "blocks": [
        {
          "type": "question",
          "settings": {
            "question_label": "Comment te sens-tu en ce moment ?",
            "answer_1_label": "J'ai besoin de r√©confort",
            "answer_2_label": "Je me sens vuln√©rable",
            "answer_3_label": "Je cherche la paix",
            "answer_4_label": "Je veux de l'√©l√©gance"
          }
        },
        {
          "type": "question",
          "settings": {
            "question_label": "Quel est ton besoin principal aujourd'hui ?",
            "answer_1_label": "R√©confort",
            "answer_2_label": "Protection",
            "answer_3_label": "S√©r√©nit√©"
          }
        }
      ]
    }
  ]
}
{% endschema %}
