{% comment %}
  MILAURA QUIZ TEASER
  Section d'accroche pour la homepage qui redirige vers la page quiz complete
  Design elegant avec expert block et CTA fort
{% endcomment %}

{% style %}
  /* ============================================
     MILAURA QUIZ TEASER - SECTION HOMEPAGE
     ============================================ */

  #MilauraQuizTeaser-{{ section.id }} {
    width: 100%;
    padding: var(--milaura-spacing-xl) var(--milaura-spacing-sm);
    background: transparent;
    margin-top: var(--milaura-spacing-lg);
    margin-bottom: var(--milaura-spacing-lg);
  }

  /* Container principal avec effet glassmorphism */
  #MilauraQuizTeaser-{{ section.id }} .teaser-container {
    position: relative;
    text-align: center;
  }

  /* Kicker / Surtitre */
  #MilauraQuizTeaser-{{ section.id }} .teaser-kicker {
    font-family: var(--milaura-font-body);
    color: var(--milaura-gold);
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 2px;
    margin-bottom: var(--milaura-spacing-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
  }

  #MilauraQuizTeaser-{{ section.id }} .teaser-kicker::before,
  #MilauraQuizTeaser-{{ section.id }} .teaser-kicker::after {
    content: '';
    width: 30px;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--milaura-gold), transparent);
  }

  /* Titre principal */
  #MilauraQuizTeaser-{{ section.id }} .teaser-title {
    font-family: {{ section.settings.title_font }};
    color: {{ section.settings.title_color }};
    font-size: {{ section.settings.title_size }}rem;
    font-weight: 700;
    margin-bottom: var(--milaura-spacing-md);
    line-height: 1.2;
  }

  /* Sous-titre */
  #MilauraQuizTeaser-{{ section.id }} .teaser-subtitle {
    font-family: var(--milaura-font-body);
    color: {{ section.settings.subtitle_color }};
    font-size: {{ section.settings.subtitle_size }}rem;
    line-height: 1.6;
    margin-bottom: var(--milaura-spacing-lg);
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
  }

  /* Bloc Expert */
  #MilauraQuizTeaser-{{ section.id }} .teaser-expert-block {
    background: rgba(255, 255, 255, 0.6);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    border-radius: var(--milaura-border-radius);
    border: 1px solid rgba(192, 160, 98, 0.2);
    padding: var(--milaura-spacing-lg);
    margin: var(--milaura-spacing-lg) auto;
    max-width: 500px;
    display: flex;
    align-items: center;
    gap: var(--milaura-spacing-md);
    text-align: left;
    transition: all 0.3s ease;
  }

  #MilauraQuizTeaser-{{ section.id }} .teaser-expert-block:hover {
    transform: translateY(-3px);
    box-shadow: 0 15px 40px rgba(192, 160, 98, 0.2);
    border-color: rgba(192, 160, 98, 0.4);
  }

  #MilauraQuizTeaser-{{ section.id }} .teaser-expert-image {
    width: 90px;
    height: 90px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid var(--milaura-gold);
    flex-shrink: 0;
    box-shadow: 0 5px 20px rgba(192, 160, 98, 0.3);
  }

  #MilauraQuizTeaser-{{ section.id }} .teaser-expert-info {
    flex: 1;
  }

  #MilauraQuizTeaser-{{ section.id }} .teaser-expert-name {
    font-family: var(--milaura-font-heading);
    color: var(--milaura-text);
    font-size: 1.2rem;
    font-weight: 700;
    margin-bottom: 4px;
  }

  #MilauraQuizTeaser-{{ section.id }} .teaser-expert-title {
    font-family: var(--milaura-font-body);
    color: var(--milaura-gold);
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 8px;
  }

  #MilauraQuizTeaser-{{ section.id }} .teaser-expert-text {
    font-family: var(--milaura-font-body);
    color: var(--milaura-text-light);
    font-size: 0.9rem;
    line-height: 1.5;
    font-style: italic;
  }

  /* Bloc Stats / Social Proof */
  #MilauraQuizTeaser-{{ section.id }} .teaser-stats {
    display: flex;
    justify-content: center;
    gap: var(--milaura-spacing-lg);
    margin: var(--milaura-spacing-lg) 0;
    flex-wrap: wrap;
  }

  #MilauraQuizTeaser-{{ section.id }} .teaser-stat {
    text-align: center;
  }

  #MilauraQuizTeaser-{{ section.id }} .teaser-stat-number {
    font-family: var(--milaura-font-heading);
    color: var(--milaura-gold);
    font-size: 2rem;
    font-weight: 700;
    line-height: 1;
    margin-bottom: 4px;
  }

  #MilauraQuizTeaser-{{ section.id }} .teaser-stat-label {
    font-family: var(--milaura-font-body);
    color: var(--milaura-text-light);
    font-size: 0.8rem;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  /* CTA Principal */
  #MilauraQuizTeaser-{{ section.id }} .teaser-cta-wrapper {
    margin-top: var(--milaura-spacing-xl);
  }

  #MilauraQuizTeaser-{{ section.id }} .teaser-cta {
    display: inline-flex;
    align-items: center;
    gap: 12px;
    background: linear-gradient(135deg, var(--milaura-gold) 0%, var(--milaura-gold-dark) 100%);
    color: #ffffff !important;
    font-family: var(--milaura-font-body);
    font-size: 1.1rem;
    font-weight: 700;
    text-decoration: none !important;
    padding: 18px 40px;
    border-radius: var(--milaura-border-radius);
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 8px 30px rgba(192, 160, 98, 0.4);
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  #MilauraQuizTeaser-{{ section.id }} .teaser-cta:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 40px rgba(192, 160, 98, 0.5);
  }

  #MilauraQuizTeaser-{{ section.id }} .teaser-cta:active {
    transform: translateY(-1px);
  }

  #MilauraQuizTeaser-{{ section.id }} .teaser-cta-icon {
    font-size: 1.3rem;
    animation: sparkle 2s ease-in-out infinite;
  }

  @keyframes sparkle {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.7; transform: scale(1.1); }
  }

  /* Note sous le CTA */
  #MilauraQuizTeaser-{{ section.id }} .teaser-note {
    font-family: var(--milaura-font-body);
    color: var(--milaura-text-light);
    font-size: 0.85rem;
    margin-top: var(--milaura-spacing-sm);
    opacity: 0.8;
  }

  /* Lien derniere revelation */
  #MilauraQuizTeaser-{{ section.id }} .teaser-last-result {
    margin-top: var(--milaura-spacing-md);
    padding-top: var(--milaura-spacing-md);
    border-top: 1px solid rgba(192, 160, 98, 0.15);
  }

  #MilauraQuizTeaser-{{ section.id }} .teaser-last-result-link {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    font-family: var(--milaura-font-body);
    color: var(--milaura-gold);
    font-size: 0.9rem;
    font-weight: 600;
    text-decoration: none;
    transition: color 0.3s ease;
  }

  #MilauraQuizTeaser-{{ section.id }} .teaser-last-result-link:hover {
    color: var(--milaura-gold-dark);
  }

  /* --- RESPONSIVE TABLETTE --- */
  @media screen and (max-width: 1024px) {
    #MilauraQuizTeaser-{{ section.id }} .teaser-title {
      font-size: {{ section.settings.title_size | times: 0.85 }}rem;
    }

    #MilauraQuizTeaser-{{ section.id }} .teaser-expert-block {
      max-width: 100%;
    }
  }

  /* --- RESPONSIVE MOBILE --- */
  @media screen and (max-width: 768px) {
    #MilauraQuizTeaser-{{ section.id }} {
      padding: var(--milaura-spacing-sm) var(--milaura-spacing-xs);
      margin-top: var(--milaura-spacing-sm);
      margin-bottom: var(--milaura-spacing-sm);
    }

    #MilauraQuizTeaser-{{ section.id }} .teaser-kicker {
      margin-bottom: 6px;
      font-size: 0.75rem;
    }

    #MilauraQuizTeaser-{{ section.id }} .teaser-title {
      font-size: {{ section.settings.title_size | times: 0.65 }}rem;
      margin-bottom: var(--milaura-spacing-sm);
    }

    #MilauraQuizTeaser-{{ section.id }} .teaser-subtitle {
      font-size: 0.95rem;
      margin-bottom: var(--milaura-spacing-sm);
      line-height: 1.4;
    }

    #MilauraQuizTeaser-{{ section.id }} .teaser-expert-block {
      flex-direction: row;
      text-align: left;
      padding: var(--milaura-spacing-sm);
      margin: var(--milaura-spacing-sm) auto;
      gap: var(--milaura-spacing-sm);
    }

    #MilauraQuizTeaser-{{ section.id }} .teaser-expert-image {
      width: 60px;
      height: 60px;
    }

    #MilauraQuizTeaser-{{ section.id }} .teaser-expert-info {
      text-align: left;
    }

    #MilauraQuizTeaser-{{ section.id }} .teaser-expert-name {
      font-size: 1rem;
      margin-bottom: 2px;
    }

    #MilauraQuizTeaser-{{ section.id }} .teaser-expert-title {
      font-size: 0.7rem;
      margin-bottom: 4px;
    }

    #MilauraQuizTeaser-{{ section.id }} .teaser-expert-text {
      font-size: 0.8rem;
      line-height: 1.3;
    }

    #MilauraQuizTeaser-{{ section.id }} .teaser-stats {
      gap: var(--milaura-spacing-md);
      margin: var(--milaura-spacing-sm) 0;
    }

    #MilauraQuizTeaser-{{ section.id }} .teaser-stat-number {
      font-size: 1.4rem;
    }

    #MilauraQuizTeaser-{{ section.id }} .teaser-stat-label {
      font-size: 0.7rem;
    }

    #MilauraQuizTeaser-{{ section.id }} .teaser-cta-wrapper {
      margin-top: var(--milaura-spacing-sm);
    }

    #MilauraQuizTeaser-{{ section.id }} .teaser-cta {
      width: 100%;
      justify-content: center;
      padding: 14px 24px;
      font-size: 0.9rem;
    }

    #MilauraQuizTeaser-{{ section.id }} .teaser-note {
      font-size: 0.75rem;
      margin-top: 6px;
    }
  }

  /* --- TRES PETIT MOBILE --- */
  @media screen and (max-width: 380px) {
    #MilauraQuizTeaser-{{ section.id }} {
      padding: var(--milaura-spacing-xs) var(--milaura-spacing-xs);
    }

    #MilauraQuizTeaser-{{ section.id }} .teaser-title {
      font-size: 1.5rem;
    }

    #MilauraQuizTeaser-{{ section.id }} .teaser-stats {
      flex-direction: row;
      gap: var(--milaura-spacing-sm);
    }

    #MilauraQuizTeaser-{{ section.id }} .teaser-stat-number {
      font-size: 1.2rem;
    }

    #MilauraQuizTeaser-{{ section.id }} .teaser-cta {
      padding: 12px 20px;
      font-size: 0.85rem;
    }
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    #MilauraQuizTeaser-{{ section.id }} .teaser-cta-icon {
      animation: none;
    }

    #MilauraQuizTeaser-{{ section.id }} .teaser-expert-block,
    #MilauraQuizTeaser-{{ section.id }} .teaser-cta {
      transition: none;
    }
  }
{% endstyle %}

<section
  id="MilauraQuizTeaser-{{ section.id }}"
  class="milaura-quiz-teaser"
  aria-label="{{ section.settings.title }}"
>
  <div class="page-width">
    <div class="teaser-container milaura-section-card">

      {%- comment -%} Kicker {%- endcomment -%}
      {%- if section.settings.kicker != blank -%}
        <div class="teaser-kicker">{{ section.settings.kicker }}</div>
      {%- endif -%}

      {%- comment -%} Titre principal {%- endcomment -%}
      {%- if section.settings.title != blank -%}
        <h2 class="teaser-title">{{ section.settings.title }}</h2>
      {%- endif -%}

      {%- comment -%} Sous-titre {%- endcomment -%}
      {%- if section.settings.subtitle != blank -%}
        <div class="teaser-subtitle">{{ section.settings.subtitle }}</div>
      {%- endif -%}

      {%- comment -%} Bloc Expert {%- endcomment -%}
      {%- if section.settings.show_expert and section.settings.expert_image != blank -%}
        <div class="teaser-expert-block">
          <img
            src="{{ section.settings.expert_image | image_url: width: 200 }}"
            alt="{{ section.settings.expert_name }}"
            class="teaser-expert-image"
            width="90"
            height="90"
            loading="lazy"
          >
          <div class="teaser-expert-info">
            {%- if section.settings.expert_name != blank -%}
              <div class="teaser-expert-name">{{ section.settings.expert_name }}</div>
            {%- endif -%}
            {%- if section.settings.expert_title != blank -%}
              <div class="teaser-expert-title">{{ section.settings.expert_title }}</div>
            {%- endif -%}
            {%- if section.settings.expert_quote != blank -%}
              <div class="teaser-expert-text">"{{ section.settings.expert_quote }}"</div>
            {%- endif -%}
          </div>
        </div>
      {%- endif -%}

      {%- comment -%} Stats / Social Proof {%- endcomment -%}
      {%- if section.settings.show_stats -%}
        <div class="teaser-stats">
          {%- if section.settings.stat_1_number != blank -%}
            <div class="teaser-stat">
              <div class="teaser-stat-number">{{ section.settings.stat_1_number }}</div>
              <div class="teaser-stat-label">{{ section.settings.stat_1_label }}</div>
            </div>
          {%- endif -%}
          {%- if section.settings.stat_2_number != blank -%}
            <div class="teaser-stat">
              <div class="teaser-stat-number">{{ section.settings.stat_2_number }}</div>
              <div class="teaser-stat-label">{{ section.settings.stat_2_label }}</div>
            </div>
          {%- endif -%}
          {%- if section.settings.stat_3_number != blank -%}
            <div class="teaser-stat">
              <div class="teaser-stat-number">{{ section.settings.stat_3_number }}</div>
              <div class="teaser-stat-label">{{ section.settings.stat_3_label }}</div>
            </div>
          {%- endif -%}
        </div>
      {%- endif -%}

      {%- comment -%} CTA Principal {%- endcomment -%}
      <div class="teaser-cta-wrapper">
        <a href="{{ section.settings.cta_link }}" class="teaser-cta">
          <span class="teaser-cta-icon">✨</span>
          <span>{{ section.settings.cta_label | default: 'Faire mon diagnostic' }}</span>
        </a>

        {%- if section.settings.cta_note != blank -%}
          <p class="teaser-note">{{ section.settings.cta_note }}</p>
        {%- endif -%}
      </div>

      {%- comment -%} Lien vers derniere revelation (si existe) {%- endcomment -%}
      <div class="teaser-last-result" id="teaser-last-result-{{ section.id }}" style="display: none;">
        <a href="{{ section.settings.cta_link }}" class="teaser-last-result-link" id="teaser-show-last-{{ section.id }}">
          <span>Revoir ma derniere revelation</span>
          <span>→</span>
        </a>
      </div>

    </div>
  </div>
</section>

<script>
  (function() {
    const sectionId = '{{ section.id }}';

    // Verifier si l'utilisateur a deja fait le quiz
    const lastResult = localStorage.getItem('milauraLastResult');
    if (lastResult) {
      try {
        const data = JSON.parse(lastResult);
        const linkContainer = document.querySelector('#teaser-last-result-' + sectionId);
        if (linkContainer && data.profileName) {
          linkContainer.style.display = 'block';
        }
      } catch (e) {
        // Silently fail
      }
    }
  })();
</script>

{% schema %}
{
  "name": "Milaura Quiz Teaser",
  "tag": "section",
  "class": "milaura-section",
  "settings": [
    {
      "type": "header",
      "content": "Contenu principal"
    },
    {
      "type": "text",
      "id": "kicker",
      "label": "Surtitre",
      "default": "Decouvrez votre profil"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Titre",
      "default": "Quel est ton besoin emotionnel ?"
    },
    {
      "type": "textarea",
      "id": "subtitle",
      "label": "Sous-titre",
      "default": "Reponds a quelques questions et decouvre la bougie qui correspond a ton etat emotionnel du moment."
    },
    {
      "type": "header",
      "content": "Style titre"
    },
    {
      "type": "select",
      "id": "title_font",
      "label": "Police du titre",
      "options": [
        { "value": "var(--milaura-font-heading)", "label": "Playfair Display" },
        { "value": "'Dancing Script', cursive", "label": "Dancing Script" },
        { "value": "var(--milaura-font-body)", "label": "Lato" }
      ],
      "default": "var(--milaura-font-heading)"
    },
    {
      "type": "range",
      "id": "title_size",
      "label": "Taille du titre",
      "min": 1.5,
      "max": 4,
      "step": 0.1,
      "unit": "rem",
      "default": 2.8
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Couleur du titre",
      "default": "#C0A062"
    },
    {
      "type": "range",
      "id": "subtitle_size",
      "label": "Taille du sous-titre",
      "min": 0.9,
      "max": 1.5,
      "step": 0.1,
      "unit": "rem",
      "default": 1.1
    },
    {
      "type": "color",
      "id": "subtitle_color",
      "label": "Couleur du sous-titre",
      "default": "#1b1b1b"
    },
    {
      "type": "header",
      "content": "Bloc Experte"
    },
    {
      "type": "checkbox",
      "id": "show_expert",
      "label": "Afficher le bloc experte",
      "default": true
    },
    {
      "type": "image_picker",
      "id": "expert_image",
      "label": "Photo de l'experte"
    },
    {
      "type": "text",
      "id": "expert_name",
      "label": "Nom de l'experte",
      "default": "Lorraine Vidal"
    },
    {
      "type": "text",
      "id": "expert_title",
      "label": "Titre de l'experte",
      "default": "Fondatrice & Experte en aromatherapie"
    },
    {
      "type": "text",
      "id": "expert_quote",
      "label": "Citation courte",
      "default": "Je t'accompagne dans cette decouverte de ton profil unique."
    },
    {
      "type": "header",
      "content": "Social Proof (Stats)"
    },
    {
      "type": "checkbox",
      "id": "show_stats",
      "label": "Afficher les statistiques",
      "default": true
    },
    {
      "type": "text",
      "id": "stat_1_number",
      "label": "Stat 1 - Nombre",
      "default": "2min"
    },
    {
      "type": "text",
      "id": "stat_1_label",
      "label": "Stat 1 - Label",
      "default": "Duree du quiz"
    },
    {
      "type": "text",
      "id": "stat_2_number",
      "label": "Stat 2 - Nombre",
      "default": "5"
    },
    {
      "type": "text",
      "id": "stat_2_label",
      "label": "Stat 2 - Label",
      "default": "Profils emotionnels"
    },
    {
      "type": "text",
      "id": "stat_3_number",
      "label": "Stat 3 - Nombre",
      "default": "98%"
    },
    {
      "type": "text",
      "id": "stat_3_label",
      "label": "Stat 3 - Label",
      "default": "Clients satisfaits"
    },
    {
      "type": "header",
      "content": "Bouton CTA"
    },
    {
      "type": "text",
      "id": "cta_label",
      "label": "Texte du bouton",
      "default": "Faire mon diagnostic emotionnel"
    },
    {
      "type": "url",
      "id": "cta_link",
      "label": "Lien du bouton"
    },
    {
      "type": "text",
      "id": "cta_note",
      "label": "Note sous le bouton",
      "default": "Gratuit - Sans engagement"
    }
  ],
  "presets": [
    {
      "name": "Milaura Quiz Teaser"
    }
  ]
}
{% endschema %}
