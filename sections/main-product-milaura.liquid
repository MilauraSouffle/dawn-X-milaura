{% comment %}
  MILAURA MASTERCLASS V21 - THE FINAL ONE
  - Navbar: Fixed padding (No overlap)
  - Fonts: Dancing Script 500 (Clean)
  - Layout: Metafields Horizontal Row (No scroll)
  - Style: Official Milaura Gold Gradient
  - Desktop: Full Split Layout Sticky
{% endcomment %}

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link
  href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;500;600&family=Playfair+Display:wght@400;700&family=Lato:wght@400;700&display=swap"
  rel="stylesheet"
>

{%- style -%}
  /* ============================================
     1. VARIABLES & GLOBAL RESET
  ============================================ */
  :root {
    /* Le Vrai Doré Milaura (Extrait de ton base.css) */
    --gold-gradient: linear-gradient(
      135deg,
      rgba(255, 240, 200, 0.92) 0%,
      rgba(214, 176, 96, 0.92) 18%,
      rgba(255, 232, 172, 0.92) 42%,
      rgba(176, 130, 48, 0.92) 70%,
      rgba(255, 240, 200, 0.92) 100%
    );
    --gold-border: rgba(214, 176, 96, 0.55);
    --gold-solid: #d6b060;
    --black-ink: #000000;
    --bg-color: #fffefa; /* Blanc chaud luxe */
  }

  .milaura-section {
    background-color: var(--bg-color);
    /* SÉCURITÉ NAVBAR : On pousse le contenu vers le bas */
    padding-top: 130px;
    padding-bottom: 100px;
    overflow-x: hidden;
  }

  .milaura-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 20px;
  }

  /* ============================================
     2. TYPOGRAPHIE (CORRIGÉE)
  ============================================ */
  /* Titre Principal */
  h1.product-title {
    font-family: 'Dancing Script', cursive;
    font-weight: 500; /* Pas de gras baveux */
    font-size: 38px; /* Taille mobile maîtrisée */
    line-height: 1.1;
    color: var(--black-ink);
    margin: 10px 0;
    text-align: left;
  }

  /* Sous-titres */
  .section-label {
    font-family: 'Playfair Display', serif;
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--black-ink);
    margin-bottom: 10px;
    border-bottom: 2px solid #f0e6d2;
    display: inline-block;
    padding-bottom: 2px;
  }

  /* ============================================
     3. IMAGE & BADGE
  ============================================ */
  .gallery-wrapper {
    position: relative;
    margin-bottom: 25px;
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
  }

  /* Liseré Doré Élégant (Pas double, juste propre) */
  .gallery-wrapper img {
    width: 100%;
    height: auto;
    border-radius: 20px;
    border: 1px solid rgba(214, 176, 96, 0.3);
    display: block;
  }

  /* Badge positionné SANS être caché */
  .photo-badge {
    position: absolute;
    top: 15px;
    left: 15px;
    background: var(--gold-gradient);
    color: #000;
    font-family: 'Lato', sans-serif;
    font-weight: 700;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    padding: 6px 14px;
    border-radius: 20px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
    z-index: 10;
  }

  /* ============================================
     4. METAFIELDS GRID (HORIZONTAL !)
  ============================================ */
  .meta-grid-row {
    display: flex;
    justify-content: space-between; /* Espace égal */
    gap: 10px;
    margin: 20px 0;
    width: 100%;
  }

  .meta-card {
    flex: 1; /* Largeur égale pour les 3 */
    background: #fff;
    border: 1px solid rgba(0, 0, 0, 0.05);
    border-radius: 12px;
    padding: 10px 5px;
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.02);
  }

  .meta-icon {
    font-size: 1.4rem;
    margin-bottom: 5px;
    color: var(--gold-solid);
  }
  .meta-label {
    font-size: 0.7rem;
    color: #666;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  .meta-value {
    font-size: 0.85rem;
    font-weight: 700;
    color: #000;
    margin-top: 2px;
    line-height: 1.2;
  }

  /* ============================================
     5. WHY BLOCK (Pourquoi elle est faite pour vous)
  ============================================ */
  .benefits-block {
    background: linear-gradient(to right, #fffbf0, #ffffff);
    border-radius: 16px;
    padding: 20px;
    margin-bottom: 30px;
    border: 1px solid rgba(214, 176, 96, 0.2);
  }

  .benefit-item {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    margin-bottom: 10px;
    font-family: 'Lato', sans-serif;
    font-size: 0.95rem;
    color: #333;
  }
  .check-icon {
    color: var(--gold-solid);
    font-weight: bold;
    min-width: 18px;
  }

  /* ============================================
     6. BUNDLES (STYLE MILAURA)
  ============================================ */
  .bundle-card {
    border: 1px solid #e0e0e0;
    background: #fff;
    border-radius: 16px;
    padding: 16px;
    margin-bottom: 12px;
    position: relative;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .bundle-card.active {
    border: 2px solid var(--gold-solid); /* Fallback */
    border-image: var(--gold-gradient) 1;
    background: #fffdf5;
    box-shadow: 0 5px 15px rgba(214, 176, 96, 0.15);
  }

  .bundle-pill {
    position: absolute;
    top: -10px;
    right: 15px;
    background: var(--gold-gradient);
    color: #000;
    font-size: 0.7rem;
    font-weight: 800;
    padding: 4px 10px;
    border-radius: 10px;
    text-transform: uppercase;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  }

  /* ============================================
     7. DESKTOP LAYOUT (SPLIT SCREEN)
  ============================================ */
  @media screen and (min-width: 990px) {
    .milaura-section {
      padding-top: 160px;
    } /* Plus d'espace desktop */

    .product-grid-desktop {
      display: grid;
      grid-template-columns: 1.2fr 0.8fr; /* Image plus large */
      gap: 60px;
      align-items: start;
    }

    .desktop-sticky-col {
      position: sticky;
      top: 160px; /* Colle sous la navbar */
      padding-right: 20px;
    }

    h1.product-title {
      font-size: 52px;
    } /* Plus gros sur desktop */

    /* On cache le dock mobile sur desktop */
    .mobile-sticky-dock {
      display: none !important;
    }
  }

  /* ============================================
     8. MOBILE STICKY DOCK
  ============================================ */
  .mobile-sticky-dock {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(12px);
    border-top: 1px solid rgba(0, 0, 0, 0.05);
    padding: 12px 20px;
    padding-bottom: max(12px, env(safe-area-inset-bottom));
    z-index: 999; /* Au dessus de tout */
    display: flex;
    align-items: center;
    gap: 15px;
    box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.05);
  }

  /* BOUTON MILAURA GRADIENT */
  .btn-milaura {
    background: var(--gold-gradient);
    color: #000;
    border: none;
    font-family: 'Lato', sans-serif;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    border-radius: 50px;
    padding: 0 30px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(176, 130, 48, 0.25);
    transition: transform 0.2s;
    width: 100%;
  }
  .btn-milaura:active {
    transform: scale(0.98);
  }
{%- endstyle -%}

<section class="milaura-section" id="MainProduct-{{ section.id }}">
  <div class="milaura-container">
    <div class="product-grid-desktop">
      <div class="visual-col">
        <div class="gallery-wrapper">
          <span class="photo-badge">{{ section.settings.sticker_text | default: 'Fait Main' }}</span>
          <img src="{{ product.featured_media | image_url: width: 1200 }}" alt="{{ product.title }}" loading="eager">
        </div>
      </div>

      <div class="desktop-sticky-col">
        <h1 class="product-title">{{ product.title }}</h1>
        <div style="display:flex; align-items:center; gap:8px; margin-bottom:15px;">
          <span style="color:var(--gold-solid); font-size:1.1rem;">★★★★★</span>
          <span style="font-size:0.9rem; color:#666; font-family:'Lato';">4.9/5 (120 avis)</span>
        </div>

        <div style="font-family:'Playfair Display'; font-size:2rem; font-weight:700; color:#000; margin-bottom:20px;">
          {{ product.price | money }}
        </div>

        <div class="meta-grid-row">
          <div class="meta-card">
            <span class="meta-icon">✦</span>
            <span class="meta-label">Pierre</span>
            <span class="meta-value">{{ product.metafields.custom.stone | default: 'Améthyste' }}</span>
          </div>
          <div class="meta-card">
            <span class="meta-icon">♕</span>
            <span class="meta-label">Qualité</span>
            <span class="meta-value">Premium</span>
          </div>
          <div class="meta-card">
            <span class="meta-icon">⚓</span>
            <span class="meta-label">Origine</span>
            <span class="meta-value">France</span>
          </div>
        </div>

        <div class="benefits-block">
          <div class="section-label">Pourquoi elle est pour toi ?</div>
          <div style="margin-top:10px;">
            {% if product.metafields.custom.benefits %}
              {% assign benefits = product.metafields.custom.benefits | split: '•' %}
              {% for b in benefits %}
                {% if b != blank %}
                  <div class="benefit-item"><span class="check-icon">✔</span> {{ b | strip }}</div>
                {% endif %}
              {% endfor %}
            {% else %}
              <div class="benefit-item"><span class="check-icon">✔</span> Apaise le stress immédiat</div>
              <div class="benefit-item"><span class="check-icon">✔</span> Favorise un sommeil profond</div>
              <div class="benefit-item"><span class="check-icon">✔</span> Énergie positive durable</div>
            {% endif %}
          </div>
        </div>

        <div id="BundleSectionAnchor"></div>

        <div class="section-label" style="margin-bottom:15px; display:block; text-align:center;">
          Choisis ton Rituel
        </div>

        {% form 'product', product, id: 'ProductForm' %}
          <input
            type="hidden"
            name="id"
            id="VariantIdInput"
            value="{{ product.selected_or_first_available_variant.id }}"
          >
          <input type="hidden" name="quantity" id="QuantityInput" value="1">

          <div class="bundle-card" onclick="selectBundle(1, this)">
            <div style="font-weight:700; font-family:'Lato';">UNITÉ</div>
            <div style="font-size:0.85rem; color:#666;">Découverte simple</div>
          </div>

          <div class="bundle-card active" id="DefaultBundle" onclick="selectBundle(2, this)">
            <div class="bundle-pill">POPULAIRE</div>
            <div style="font-weight:700; font-family:'Lato';">DUO (x2)</div>
            <div style="font-size:0.85rem; color:#666;">Livraison & Sauge OFFERTES</div>
          </div>

          <div class="bundle-card" onclick="selectBundle(3, this)">
            <div class="bundle-pill">BEST VALUE</div>
            <div style="font-weight:700; font-family:'Lato';">TRIO (x3)</div>
            <div style="font-size:0.85rem; color:#666;">-10% + Cadeaux + Livraison</div>
          </div>

          <div style="margin-top:20px;" class="desktop-only-btn">
            <button type="submit" class="btn-milaura">AJOUTER AU PANIER</button>
          </div>

          <button type="submit" id="RealSubmit" style="display:none;"></button>
        {% endform %}

        <div style="margin-top:30px; font-family:'Lato'; line-height:1.6; color:#444; font-size:0.95rem;">
          {{ product.description }}
        </div>
      </div>
    </div>
  </div>
</section>

<div class="mobile-sticky-dock">
  <div style="display:flex; flex-direction:column;">
    <span style="font-size:0.7rem; text-transform:uppercase; color:#666;">Total</span>
    <span style="font-family:'Playfair Display'; font-weight:700; font-size:1.2rem;" id="DockPrice">
      {{- product.price | money -}}
    </span>
  </div>
  <button class="btn-milaura" style="flex:1;" id="DockBtn" onclick="handleDockClick()">CHOISIR MON OFFRE</button>
</div>

<script>
  // Logic
  function handleDockClick() {
    const anchor = document.getElementById('BundleSectionAnchor');
    const dockBtn = document.getElementById('DockBtn');
    const rect = anchor.getBoundingClientRect();

    // Check visibility logic (simple version)
    // Si l'ancre est trop bas (hors écran), on scroll
    if (rect.top > window.innerHeight) {
      anchor.scrollIntoView({ behavior: 'smooth' });
      setTimeout(() => {
        dockBtn.innerText = 'VALIDER LE RITUEL';
      }, 600);
    } else {
      // Sinon on ajoute au panier
      document.getElementById('RealSubmit').click();
    }
  }

  function selectBundle(qty, el) {
    // UI
    document.querySelectorAll('.bundle-card').forEach((c) => c.classList.remove('active'));
    el.classList.add('active');

    // Data
    document.getElementById('QuantityInput').value = qty;

    // Feedback
    document.getElementById('DockBtn').innerText = 'AJOUTER AU PANIER (' + qty + ')';

    // Note: Price update logic requires Liquid variant mapping via JS, kept simple here for layout focus
  }

  // Hide Desktop btn on mobile if dock is present (handled by CSS generally, but safe check)
  if (window.innerWidth < 990) {
    const dskBtn = document.querySelector('.desktop-only-btn');
    if (dskBtn) dskBtn.style.display = 'none';
  }
</script>

{% schema %}
{
  "name": "Milaura Master V21",
  "settings": [{ "type": "text", "id": "sticker_text", "label": "Badge Photo", "default": "Fait Main" }],
  "presets": [{ "name": "Milaura Master V21" }]
}
{% endschema %}
