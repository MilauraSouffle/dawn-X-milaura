{% comment %}
  MILAURA MASTERCLASS V18 - GOD MODE
  - Mobile First: Sticky Dock "Add to Cart"
  - Font: Dancing Script 44px Black Fixed
  - Color: All text Black (#000000) for max readability
  - Logic: Default select Middle Bundle + Scroll to Bundle logic
{% endcomment %}

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600;700&display=swap" rel="stylesheet">

{%- style -%}
  /* ============================================
     0. GOD MODE RESET (Force Black Text)
  ============================================ */
  .milaura-product-section {
    color: #000000 !important; /* Force le noir partout */
    padding: 0;
    background: #ffffff; /* Fond blanc propre */
    padding-bottom: 80px; /* Espace pour le sticky dock mobile */
  }

  .milaura-product-section p,
  .milaura-product-section span,
  .milaura-product-section div,
  .milaura-product-section li {
    color: #1a1a1a; /* Noir doux pour le texte courant */
  }

  .milaura-product-wrapper {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0;
  }

  /* ============================================
     1. TYPOGRAPHY FIXES
  ============================================ */
  /* Titre Mobile & Desktop */
  h1.milaura-title-fix {
    font-family: 'Dancing Script', cursive !important;
    font-weight: 700 !important;
    color: #000000 !important; /* Noir absolu */
    line-height: 1.1 !important;
    margin: 0 0 10px 0;
    text-transform: none !important;
    letter-spacing: 0 !important;
  }

  /* Taille Mobile */
  @media screen and (max-width: 990px) {
    h1.milaura-title-fix {
      font-size: 40px !important; /* Grand mais tient sur mobile */
    }
  }
  /* Taille Desktop */
  @media screen and (min-width: 991px) {
    h1.milaura-title-fix {
      font-size: 52px !important; /* Massif sur desktop */
    }
  }

  /* ============================================
     2. MOBILE LAYOUT
  ============================================ */
  .mobile-buybox {
    display: block;
    padding: 16px;
    padding-top: 16px;
    background: #ffffff;
  }

  .mobile-buybox__subtitle {
    display: block;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    font-size: 0.7rem;
    color: #666666; /* Gris foncé */
    font-weight: 700;
    margin-bottom: 4px;
  }

  /* RATING */
  .mobile-buybox__rating {
    display: flex;
    align-items: center;
    gap: 6px;
    margin-bottom: 12px;
  }
  .mobile-buybox__stars {
    color: #d4af37; /* Or pour les étoiles seulement */
  }
  .mobile-buybox__rating-text {
    font-size: 0.85rem;
    color: #000000;
  }

  /* PRICE */
  .mobile-buybox__price-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 16px;
    padding: 12px;
    background: #f9f9f9;
    border-radius: 12px;
    border: 1px solid #e0e0e0;
  }
  .mobile-buybox__price {
    font-size: 1.75rem;
    font-weight: 800;
    color: #000000;
  }
  .mobile-buybox__price-compare {
    font-size: 1rem;
    color: #999;
    text-decoration: line-through;
    margin-left: 8px;
  }
  .mobile-buybox__shipping-badge {
    background: #000000;
    color: #fff;
    font-size: 0.7rem;
    padding: 4px 10px;
    border-radius: 20px;
    font-weight: 700;
    text-transform: uppercase;
  }

  /* BENEFITS */
  .mobile-buybox__benefit {
    display: flex;
    gap: 8px;
    font-size: 0.9rem;
    margin-bottom: 6px;
    color: #000000;
  }
  .mobile-buybox__benefit-icon {
    color: #d4af37;
  } /* Checkmark doré */

  /* ============================================
     3. MOBILE STICKY DOCK (LE DOCK)
  ============================================ */
  .mobile-sticky-dock {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background: #ffffff;
    padding: 12px 16px;
    box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
    border-top: 1px solid #eee;
  }

  .dock-price-info {
    display: flex;
    flex-direction: column;
  }
  .dock-label {
    font-size: 0.7rem;
    color: #666;
    text-transform: uppercase;
  }
  .dock-price {
    font-weight: 800;
    font-size: 1.1rem;
    color: #000;
  }

  .dock-cta {
    background: #000000; /* Bouton Noir */
    color: #ffffff;
    flex: 1;
    border: none;
    border-radius: 50px;
    height: 48px;
    font-size: 1rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
  }

  /* ============================================
     4. BUNDLES & VARIANTS
  ============================================ */
  /* Images */
  .mobile-image-container img {
    width: 100%;
    height: auto;
    border-radius: 0 0 20px 20px;
  }

  /* Bundles Selector */
  .mobile-bundles {
    margin-top: 20px;
    margin-bottom: 20px;
  }
  .mobile-bundles__title {
    font-weight: 800;
    text-align: center;
    margin-bottom: 12px;
    font-size: 1.1rem;
    text-transform: uppercase;
  }

  .mobile-bundle-option {
    border: 2px solid #e0e0e0;
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 12px;
    position: relative;
    background: #fff;
    transition: all 0.2s;
  }

  .mobile-bundle-option.active {
    border-color: #d4af37; /* Bordure Or quand actif */
    background: #fffdf5; /* Fond très léger or */
    box-shadow: 0 4px 12px rgba(212, 175, 55, 0.15);
  }

  .mobile-bundle__badge {
    position: absolute;
    top: -10px;
    right: 12px;
    background: #d4af37;
    color: #fff;
    font-size: 0.7rem;
    font-weight: 700;
    padding: 4px 10px;
    border-radius: 12px;
    text-transform: uppercase;
  }

  .mobile-bundle__name {
    font-weight: 800;
    font-size: 1rem;
  }
  .mobile-bundle__gifts {
    font-size: 0.85rem;
    color: #555;
    margin-top: 4px;
  }
  .gift-highlight {
    color: #d4af37;
    font-weight: 700;
  }

  /* Desktop Styles (Keep layout, fix fonts) */
  @media screen and (min-width: 991px) {
    .mobile-buybox,
    .mobile-image-container,
    .mobile-sticky-dock {
      display: none;
    }
    .milaura-product-wrapper {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 60px;
      padding-top: 40px;
    }
    .desktop-right-col {
      display: block;
    }
    .desktop-left-col {
      display: block;
      position: sticky;
      top: 100px;
    }
    .desktop-price-box {
      font-size: 2rem;
      font-weight: 800;
    }
    .desktop-add-btn {
      background: #000;
      color: #fff;
      width: 100%;
      height: 55px;
      font-weight: 700;
      font-size: 1.1rem;
      border-radius: 8px;
      cursor: pointer;
      border: none;
      margin-top: 20px;
    }
  }
  @media screen and (max-width: 990px) {
    .desktop-left-col,
    .desktop-right-col {
      display: none;
    }
  }
{%- endstyle -%}

{%- assign inventory_qty = product.selected_or_first_available_variant.inventory_quantity -%}
{%- if inventory_qty <= 0 %}{% assign inventory_qty = 5 %}{% endif -%}

<section class="milaura-product-section" id="MainProduct-{{ section.id }}">
  <div class="milaura-product-wrapper">
    <div class="mobile-image-container">
      <img id="MobileMainImg" src="{{ product.featured_media | image_url: width: 800 }}" alt="{{ product.title }}">
    </div>

    <div class="mobile-buybox">
      <span class="mobile-buybox__subtitle">{{ section.settings.sticker_text | default: 'BEST SELLER' }}</span>
      <h1 class="milaura-title-fix">{{ product.title }}</h1>

      <div class="mobile-buybox__rating">
        <span class="mobile-buybox__stars">★★★★★</span>
        <span class="mobile-buybox__rating-text"><strong>4.9</strong>/5 (120+ avis vérifiés)</span>
      </div>

      <div class="mobile-buybox__price-row">
        <div>
          <span class="mobile-buybox__price" id="MobilePriceDisplay">{{ product.price | money }}</span>
          {% if product.compare_at_price > product.price %}
            <span class="mobile-buybox__price-compare">{{ product.compare_at_price | money }}</span>
          {% endif %}
        </div>
        <span class="mobile-buybox__shipping-badge">LIVRAISON OFFERTE</span>
      </div>

      <div class="mobile-buybox__benefits">
        {% if product.metafields.custom.benefits %}
          {% assign benefits = product.metafields.custom.benefits | split: '•' %}
          {% for b in benefits limit: 3 %}
            {% assign clean_b = b | strip %}
            {% if clean_b != blank %}
              <div class="mobile-buybox__benefit"><span class="mobile-buybox__benefit-icon">✔</span> {{ clean_b }}</div>
            {% endif %}
          {% endfor %}
        {% endif %}
      </div>

      <div class="mobile-bundles" id="MobileBundleAnchor">
        <div class="mobile-bundles__title">CHOISIS TON OFFRE</div>

        {% form 'product', product, id: 'MobileBundleForm' %}
          <input
            type="hidden"
            name="id"
            id="MobileVariantIdInput"
            value="{{ product.selected_or_first_available_variant.id }}"
          >
          <input type="hidden" name="quantity" id="MobileQuantityInput" value="1">

          <div class="mobile-bundle-option" data-qty="1" onclick="selectBundle(1, this)">
            <div class="mobile-bundle__name">OFFRE DÉCOUVERTE (1 unité)</div>
            <div class="mobile-bundle__gifts">Prix standard</div>
          </div>

          <div class="mobile-bundle-option" data-qty="2" onclick="selectBundle(2, this)" id="DefaultBundleOption">
            <span class="mobile-bundle__badge">POPULAIRE</span>
            <div class="mobile-bundle__name">OFFRE DUO (Pack de 2)</div>
            <div class="mobile-bundle__gifts">
              <span class="gift-highlight">Sauge OFFERTE + Livraison OFFERTE</span>
            </div>
          </div>

          <div class="mobile-bundle-option" data-qty="3" onclick="selectBundle(3, this)">
            <span class="mobile-bundle__badge">MEILLEURE OFFRE</span>
            <div class="mobile-bundle__name">OFFRE TRIO (Pack de 3)</div>
            <div class="mobile-bundle__gifts">
              <span class="gift-highlight">-10% + Sauge + Livraison OFFERTES</span>
            </div>
          </div>

          <button type="submit" name="add" class="dock-cta" style="width:100%; margin-top:10px; background:#1a1a1a;">
            AJOUTER AU PANIER
          </button>
        {% endform %}
      </div>

      <div style="margin-top:20px; border-top:1px solid #eee; padding-top:20px;">
        <h3 style="font-size:1.1rem; font-weight:700; margin-bottom:10px;">Description</h3>
        <div style="font-size:0.95rem; line-height:1.6; color:#333;">
          {{ product.description }}
        </div>
      </div>
    </div>
    <div class="mobile-sticky-dock">
      <div class="dock-price-info">
        <span class="dock-label">Total</span>
        <span class="dock-price" id="DockPrice">{{ product.price | money }}</span>
      </div>
      <button class="dock-cta" onclick="scrollToBundles()">CHOISIR MON OFFRE</button>
    </div>

    <div class="desktop-left-col">
      <img src="{{ product.featured_media | image_url: width: 1000 }}" style="width:100%; border-radius:20px;">
    </div>
    <div class="desktop-right-col">
      <h1 class="milaura-title-fix" style="font-size:52px;">{{ product.title }}</h1>
      <div style="font-size:2rem; font-weight:800; margin:20px 0;">{{ product.price | money }}</div>

      {% form 'product', product %}
        <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
        <button type="submit" class="desktop-add-btn">AJOUTER AU PANIER</button>
      {% endform %}

      <div style="margin-top:30px;">
        {{ product.description }}
      </div>
    </div>
  </div>
</section>

<script>
  // === GOD MODE LOGIC ===

  // 1. Scroll Smooth to Bundles when clicking Sticky Button
  function scrollToBundles() {
    const bundleSection = document.getElementById('MobileBundleAnchor');
    if (bundleSection) {
      bundleSection.scrollIntoView({ behavior: 'smooth', block: 'center' });

      // Optional: Flash effect to show user where to click
      bundleSection.style.transition = 'background 0.5s';
      bundleSection.style.backgroundColor = '#fffdf5';
      setTimeout(() => {
        bundleSection.style.backgroundColor = 'transparent';
      }, 800);
    }
  }

  // 2. Bundle Selection Logic
  function selectBundle(qty, element) {
    // Visual Update
    document.querySelectorAll('.mobile-bundle-option').forEach((el) => el.classList.remove('active'));
    element.classList.add('active');

    // Input Update
    const qtyInput = document.getElementById('MobileQuantityInput');
    if (qtyInput) qtyInput.value = qty;

    // Price Update (Simulation - simple logic, assumes base price * qty roughly)
    // For exact price sync, we'd need liquid variables per bundle, keeping it visual for now
    // Or simpler: Just update the "Dock" text to say "Valider l'offre"
    const btn = document.querySelector('.dock-cta');
    if (btn) btn.innerText = 'VALIDER (' + qty + ')';
  }

  // 3. Init: Select "Populaire" (Qty 2) by default on load
  document.addEventListener('DOMContentLoaded', function () {
    const defaultOption = document.getElementById('DefaultBundleOption');
    if (defaultOption) {
      // Simulate click to set active state and inputs
      selectBundle(2, defaultOption);
    }
  });
</script>

{% schema %}
{
  "name": "Milaura God Mode V18",
  "settings": [
    {
      "type": "text",
      "id": "sticker_text",
      "label": "Badge Texte",
      "default": "BEST SELLER"
    },
    {
      "type": "richtext",
      "id": "technical_details",
      "label": "Détails Techniques"
    },
    {
      "type": "richtext",
      "id": "shipping_returns",
      "label": "Livraison"
    }
  ],
  "presets": [{ "name": "Milaura God Mode V18" }]
}
{% endschema %}
