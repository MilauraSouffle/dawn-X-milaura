{% comment %}
  MILAURA MASTERCLASS V20 - JEWEL EDITION
  - Font: Dancing Script BLACK forced via ID
  - Style: "Bijou" (Shiny Gold Gradients everywhere)
  - Data: Restored Metafields (Benefits, Quality, Provenance)
  - Image: Double "Jewel" Border
{% endcomment %}

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link
  href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Lato:wght@400;700&display=swap"
  rel="stylesheet"
>

{%- style -%}
  /* ============================================
     0. VARIABLES BIJOU (SHINY GOLD)
  ============================================ */
  :root {
    --jewel-gold-light: #fbe6b8;
    --jewel-gold-mid: #d4af37;
    --jewel-gold-dark: #997b28;
    --jewel-gradient: linear-gradient(135deg, #fbe6b8 0%, #d4af37 50%, #997b28 100%);
    --jewel-shadow: 0 4px 15px rgba(212, 175, 55, 0.25);
  }

  .milaura-product-section {
    padding-top: 20px;
    padding-bottom: 120px; /* Espace pour le dock */
    background: #fffefa; /* Blanc très légèrement chaud */
    color: #000;
  }

  .milaura-product-wrapper {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 16px;
  }

  /* ============================================
     1. TYPOGRAPHY
  ============================================ */
  /* ID UNIQUE pour écraser tout conflit */
  #MilauraJewelTitle {
    font-family: 'Dancing Script', cursive !important;
    font-weight: 700 !important;
    color: #000000 !important;
    font-size: 46px !important;
    line-height: 1.1 !important;
    margin: 15px 0 5px 0;
    text-align: left;
    letter-spacing: 0 !important;
  }

  .section-subtitle {
    font-family: 'Playfair Display', serif;
    font-size: 1.2rem;
    font-weight: 700;
    margin-bottom: 10px;
    background: var(--jewel-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    display: inline-block;
  }

  /* ============================================
     2. IMAGE "ÉCRIN" (Double Border)
  ============================================ */
  .mobile-image-wrapper {
    position: relative;
    margin: 0 auto 25px auto;
    border-radius: 40px; /* Forme douce */
    padding: 6px; /* Espace entre les deux lignes d'or */
    background: transparent;
    border: 1px solid rgba(212, 175, 55, 0.3); /* Ligne externe fine */
    box-shadow: 0 10px 40px rgba(192, 160, 98, 0.1);
  }

  .mobile-image-inner {
    position: relative;
    border-radius: 35px;
    overflow: hidden;
    border: 2px solid #d4af37; /* Ligne interne solide */
    line-height: 0;
  }

  .mobile-image-inner img {
    width: 100%;
    height: auto;
    display: block;
  }

  /* Badge Photo "Bijou" */
  .photo-badge-jewel {
    position: absolute;
    top: 15px;
    left: 15px;
    z-index: 10;
    background: var(--jewel-gradient);
    color: #000;
    font-family: 'Lato', sans-serif;
    font-weight: 700;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    padding: 6px 14px;
    border-radius: 20px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    border: 1px solid #fff;
  }

  /* ============================================
     3. METAFIELDS & CONTENU (RESTORED)
  ============================================ */
  .metafield-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin: 20px 0;
    padding: 15px;
    background: #fff;
    border-radius: 16px;
    border: 1px solid rgba(212, 175, 55, 0.2);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.03);
  }

  .meta-item {
    text-align: center;
    font-size: 0.75rem;
    font-family: 'Lato', sans-serif;
    color: #333;
  }
  .meta-icon {
    font-size: 1.2rem;
    margin-bottom: 5px;
    display: block;
    color: #d4af37;
  }

  .why-block {
    margin-top: 25px;
    padding: 20px;
    background: linear-gradient(to bottom, #fffefa, #fffdf5);
    border-top: 1px solid rgba(212, 175, 55, 0.2);
    border-bottom: 1px solid rgba(212, 175, 55, 0.2);
  }

  .benefits-list {
    list-style: none;
    padding: 0;
    margin: 10px 0;
  }
  .benefit-li {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    margin-bottom: 8px;
    font-size: 0.95rem;
    color: #1a1a1a;
  }
  .check-gold {
    color: #d4af37;
    font-weight: bold;
    min-width: 15px;
  }

  /* ============================================
     4. BUNDLES & PILLS (SHINY)
  ============================================ */
  .mobile-bundle-option {
    border: 1px solid rgba(212, 175, 55, 0.4);
    background: #fff;
    border-radius: 16px;
    padding: 16px;
    margin-bottom: 12px;
    position: relative;
    transition: all 0.3s ease;
  }

  .mobile-bundle-option.active {
    border: 2px solid #d4af37;
    background: #fffdf5; /* Fond or très pâle */
    box-shadow: 0 0 15px rgba(212, 175, 55, 0.15);
  }

  /* Shiny Pill */
  .jewel-pill {
    position: absolute;
    top: -10px;
    right: 15px;
    background: var(--jewel-gradient);
    color: #000;
    font-size: 0.7rem;
    font-weight: 800;
    padding: 5px 12px;
    border-radius: 12px;
    text-transform: uppercase;
    box-shadow: 0 2px 8px rgba(153, 123, 40, 0.3);
    border: 1px solid #fff;
    letter-spacing: 0.5px;
  }

  /* ============================================
     5. DOCK & CTA
  ============================================ */
  .milaura-cta-jewel {
    background: var(--jewel-gradient);
    color: #000;
    border: 1px solid rgba(255, 255, 255, 0.4);
    font-family: 'Lato', sans-serif;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    border-radius: 50px;
    padding: 15px;
    width: 100%;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(176, 130, 48, 0.3);
    transition: transform 0.2s;
  }
  .milaura-cta-jewel:active {
    transform: scale(0.98);
  }

  .mobile-sticky-dock {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(15px);
    border-top: 1px solid rgba(212, 175, 55, 0.3);
    padding: 12px 20px;
    padding-bottom: max(12px, env(safe-area-inset-bottom));
    z-index: 9999;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 15px;
    box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.05);
  }

  /* Desktop Hide */
  @media screen and (min-width: 991px) {
    .mobile-only-wrapper {
      display: none;
    }
    .desktop-wrapper {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 60px;
      padding-top: 40px;
    }
  }
  @media screen and (max-width: 990px) {
    .desktop-wrapper {
      display: none;
    }
  }
{%- endstyle -%}

<section class="milaura-product-section" id="MainProduct-{{ section.id }}">
  <div class="milaura-product-wrapper">
    <div class="mobile-only-wrapper">
      <div class="mobile-image-wrapper">
        <span class="photo-badge-jewel">{{ section.settings.sticker_text | default: 'Fait Main' }}</span>
        <div class="mobile-image-inner">
          <img src="{{ product.featured_media | image_url: width: 800 }}" alt="{{ product.title }}">
        </div>
      </div>

      <h1 id="MilauraJewelTitle">{{ product.title }}</h1>

      <div style="display:flex; align-items:center; gap:8px; margin-bottom:15px;">
        <span style="color:#D4AF37; font-size:1.1rem;">★★★★★</span>
        <span style="font-size:0.9rem; color:#666;">4.9/5 (120+ avis)</span>
      </div>

      <div style="font-family:'Playfair Display'; font-size:2rem; font-weight:700; margin-bottom:20px;">
        {{ product.price | money }}
        {% if product.compare_at_price > product.price %}
          <span style="font-size:1rem; text-decoration:line-through; color:#999; margin-left:10px;">
            {{- product.compare_at_price | money -}}
          </span>
        {% endif %}
      </div>

      <div class="metafield-grid">
        <div class="meta-item">
          <span class="meta-icon">✦</span>
          <div>Pierre Veritable</div>
          {% if product.metafields.custom.stone != blank %}
            <div style="font-weight:bold;">{{ product.metafields.custom.stone }}</div>
          {% endif %}
        </div>
        <div class="meta-item">
          <span class="meta-icon">♕</span>
          <div>Qualité</div>
          <div style="font-weight:bold;">Premium</div>
        </div>
        <div class="meta-item">
          <span class="meta-icon">⚓</span>
          <div>Provenance</div>
          <div style="font-weight:bold;">France</div>
        </div>
      </div>

      <div class="why-block">
        <div class="section-subtitle">Pourquoi elle est faite pour toi ?</div>
        <ul class="benefits-list">
          {% if product.metafields.custom.benefits %}
            {% assign benefits = product.metafields.custom.benefits | split: '•' %}
            {% for b in benefits %}
              {% assign clean_b = b | strip %}
              {% if clean_b != blank %}
                <li class="benefit-li"><span class="check-gold">✔</span> {{ clean_b }}</li>
              {% endif %}
            {% endfor %}
          {% else %}
            <li class="benefit-li"><span class="check-gold">✔</span> Apaise les émotions intenses</li>
            <li class="benefit-li"><span class="check-gold">✔</span> Pierre naturelle certifiée</li>
            <li class="benefit-li"><span class="check-gold">✔</span> Parfum Grasse sans CMR</li>
          {% endif %}
        </ul>
      </div>

      <div id="MobileBundleAnchor" style="margin-top:30px;">
        <div class="section-subtitle" style="display:block; text-align:center; margin-bottom:15px;">
          Choisissez votre Rituel
        </div>

        {% form 'product', product, id: 'MobileBundleForm' %}
          <input
            type="hidden"
            name="id"
            id="MobileVariantIdInput"
            value="{{ product.selected_or_first_available_variant.id }}"
          >
          <input type="hidden" name="quantity" id="MobileQuantityInput" value="1">

          <div class="mobile-bundle-option" onclick="selectBundle(1, this)">
            <div style="font-weight:700;">UNITÉ</div>
            <div style="font-size:0.85rem; color:#666;">Découverte</div>
          </div>

          <div class="mobile-bundle-option" onclick="selectBundle(2, this)" id="DefaultBundleOption">
            <div class="jewel-pill">POPULAIRE</div>
            <div style="font-weight:700;">DUO (x2)</div>
            <div style="font-size:0.85rem; color:#666;">Sauge offerte + Livraison offerte</div>
          </div>

          <div class="mobile-bundle-option" onclick="selectBundle(3, this)">
            <div class="jewel-pill">OFFRE TRIO</div>
            <div style="font-weight:700;">TRIO (x3)</div>
            <div style="font-size:0.85rem; color:#666;">-10% + Sauge + Livraison</div>
          </div>

          <button type="submit" id="RealSubmitBtn" style="display:none;"></button>
        {% endform %}
      </div>

      <div style="margin-top:20px; font-size:0.95rem; line-height:1.6; color:#333;">
        {{ product.description }}
      </div>
    </div>
    <div class="desktop-wrapper">
      <div style="flex:1;">
        <img
          src="{{ product.featured_media | image_url: width: 1000 }}"
          style="width:100%; border-radius:20px; border:2px solid #D4AF37;"
        >
      </div>
      <div style="flex:1;">
        <h1 id="MilauraJewelTitle" style="font-size:60px !important;">{{ product.title }}</h1>
        <button class="milaura-cta-jewel">AJOUTER AU PANIER</button>
      </div>
    </div>
  </div>
</section>

<div class="mobile-sticky-dock">
  <div style="display:flex; flex-direction:column;">
    <span style="font-size:0.7rem; text-transform:uppercase; color:#666;">Total</span>
    <span style="font-family:'Playfair Display'; font-weight:700; font-size:1.2rem;" id="DockPrice">
      {{- product.price | money -}}
    </span>
  </div>
  <button class="milaura-cta-jewel" style="width:auto; flex:1;" id="DockBtn" onclick="handleDockClick()">
    CHOISIR MON OFFRE
  </button>
</div>

<script>
  function handleDockClick() {
    const bundleSection = document.getElementById('MobileBundleAnchor');
    const dockBtn = document.getElementById('DockBtn');
    const rect = bundleSection.getBoundingClientRect();
    if (rect.top > window.innerHeight || rect.bottom < 0) {
      bundleSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
      setTimeout(() => {
        dockBtn.innerText = 'VALIDER LE RITUEL';
      }, 500);
    } else {
      document.getElementById('RealSubmitBtn').click();
    }
  }

  function selectBundle(qty, element) {
    document.querySelectorAll('.mobile-bundle-option').forEach((el) => el.classList.remove('active'));
    element.classList.add('active');
    document.getElementById('MobileQuantityInput').value = qty;
    document.getElementById('DockBtn').innerText = 'AJOUTER AU PANIER (' + qty + ')';
  }

  document.addEventListener('DOMContentLoaded', function () {
    const defaultOpt = document.getElementById('DefaultBundleOption');
    if (defaultOpt) selectBundle(2, defaultOpt);
  });
</script>

{% schema %}
{
  "name": "Milaura Jewel V20",
  "settings": [{ "type": "text", "id": "sticker_text", "label": "Badge Photo", "default": "Fait Main" }],
  "presets": [{ "name": "Milaura Jewel V20" }]
}
{% endschema %}
