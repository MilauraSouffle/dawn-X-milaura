{% comment %}
  MILAURA MASTERCLASS V19 - LUXE EDITION
  - Fix: Layout overlapping Navbar
  - Fix: Dancing Script Font rendering
  - Fix: Gold Buttons (.milaura-cta style)
  - Feature: Sticky Dock & Bundle Logic preserved
{% endcomment %}

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;500;600;700&display=swap" rel="stylesheet">

{%- style -%}
  /* ============================================
     0. VARIABLES & RESET MILAURA
  ============================================ */
  :root {
    --milaura-gold: #c0a062;
    --milaura-gold-light: #e6c88b;
    --milaura-gold-gradient-start: #fff0c8;
    --milaura-gold-gradient-end: #b08230;
    --header-height-mobile: 70px; /* Ajuste selon ta vraie navbar */
  }

  .milaura-product-section {
    padding-top: calc(var(--header-height-mobile) + 20px); /* FIX: Dégage la navbar */
    padding-bottom: 100px; /* Espace pour le dock */
    background: radial-gradient(circle at top center, #fdfbf7 0%, #f2e8d5 60%); /* Ton fond beige luxe */
    min-height: 100vh;
  }

  .milaura-product-wrapper {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 16px;
  }

  /* ============================================
     1. TYPOGRAPHY LUXE
  ============================================ */
  /* Titre: Dancing Script, Noir, 44px */
  h1.milaura-title-fix {
    font-family: 'Dancing Script', cursive !important;
    font-weight: 700 !important; /* Testé: 700 sur Google Fonts passe bien si chargé */
    color: #000000 !important;
    font-size: 44px !important;
    line-height: 1.1 !important;
    margin: 10px 0 15px 0;
    text-transform: none !important;
    letter-spacing: 0 !important;
    -webkit-font-smoothing: antialiased;
    text-shadow: none !important; /* Enlève les ombres floues */
  }

  .subtitle-badge {
    display: inline-block;
    font-family: 'Lato', sans-serif;
    text-transform: uppercase;
    font-size: 0.75rem;
    letter-spacing: 2px;
    color: var(--milaura-gold);
    font-weight: 700;
    border: 1px solid var(--milaura-gold);
    padding: 4px 12px;
    border-radius: 20px;
    background: rgba(255, 255, 255, 0.5);
    margin-bottom: 8px;
  }

  /* ============================================
     2. MOBILE LAYOUT
  ============================================ */
  .mobile-image-container {
    margin: -16px -16px 20px -16px; /* Bleed full width */
    border-bottom-left-radius: 30px;
    border-bottom-right-radius: 30px;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(192, 160, 98, 0.15); /* Ombre dorée douce */
  }

  .mobile-image-container img {
    width: 100%;
    height: auto;
    display: block;
  }

  .mobile-buybox__rating {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 16px;
    font-family: 'Lato', sans-serif;
  }
  .mobile-buybox__stars {
    color: #d4af37;
    font-size: 1.1rem;
  }
  .mobile-buybox__rating-text {
    font-size: 0.9rem;
    color: #333;
  }

  /* Price Area */
  .price-container {
    display: flex;
    align-items: baseline;
    gap: 10px;
    margin-bottom: 20px;
  }
  .price-main {
    font-family: 'Playfair Display', serif;
    font-size: 2rem;
    color: #000;
    font-weight: 700;
  }
  .price-compare {
    text-decoration: line-through;
    color: #999;
    font-size: 1.1rem;
  }

  /* ============================================
     3. BUNDLES (MILAURA STYLE)
  ============================================ */
  .mobile-bundles__title {
    font-family: 'Playfair Display', serif;
    font-size: 1.2rem;
    color: #000;
    margin-bottom: 15px;
    text-align: center;
  }

  .mobile-bundle-option {
    border: 1px solid rgba(192, 160, 98, 0.3); /* Bordure dorée subtile */
    background: rgba(255, 255, 255, 0.6);
    backdrop-filter: blur(10px);
    border-radius: 15px;
    padding: 15px;
    margin-bottom: 12px;
    position: relative;
    transition: all 0.3s ease;
  }

  .mobile-bundle-option.active {
    border: 2px solid var(--milaura-gold);
    background: rgba(255, 255, 255, 0.9);
    box-shadow: 0 10px 25px rgba(192, 160, 98, 0.15);
    transform: scale(1.01);
  }

  .bundle-pill {
    position: absolute;
    top: -10px;
    right: 15px;
    background: var(--milaura-gold);
    color: #fff;
    font-size: 0.7rem;
    font-weight: 700;
    padding: 4px 12px;
    border-radius: 12px;
    text-transform: uppercase;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
  }

  /* ============================================
     4. BUTTONS (THE REAL MILAURA CTA)
  ============================================ */
  /* Copié de ton Design System */
  .milaura-cta-gold {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    min-height: 52px; /* Un peu plus haut pour le mobile */
    padding: 12px 24px;
    border-radius: 999px;
    border: 1px solid rgba(214, 176, 96, 0.55);
    background: linear-gradient(
      135deg,
      rgba(255, 240, 200, 0.92) 0%,
      rgba(214, 176, 96, 0.92) 18%,
      rgba(255, 232, 172, 0.92) 42%,
      rgba(176, 130, 48, 0.92) 70%,
      rgba(255, 240, 200, 0.92) 100%
    );
    color: #000;
    text-decoration: none;
    font-weight: 700;
    letter-spacing: 1px;
    text-transform: uppercase;
    font-size: 0.95rem;
    box-shadow: 0 12px 32px rgba(130, 90, 30, 0.15), 0 0 0 1px rgba(255, 255, 255, 0.25) inset;
    transition: all 0.2s ease;
    cursor: pointer;
  }

  .milaura-cta-gold:hover {
    transform: translateY(-2px);
    box-shadow: 0 16px 40px rgba(130, 90, 30, 0.25);
  }

  /* ============================================
     5. STICKY DOCK (FIXED BOTTOM)
  ============================================ */
  .mobile-sticky-dock {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(15px);
    padding: 12px 20px;
    padding-bottom: max(12px, env(safe-area-inset-bottom)); /* Safe area iPhone */
    box-shadow: 0 -5px 30px rgba(0, 0, 0, 0.08);
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 15px;
    border-top: 1px solid rgba(192, 160, 98, 0.2);
  }

  .dock-info {
    display: flex;
    flex-direction: column;
  }
  .dock-label {
    font-size: 0.7rem;
    color: #666;
    text-transform: uppercase;
    letter-spacing: 1px;
  }
  .dock-price {
    font-family: 'Playfair Display', serif;
    font-weight: 700;
    font-size: 1.2rem;
    color: #000;
  }

  /* Desktop Fixes */
  @media screen and (min-width: 991px) {
    .mobile-sticky-dock,
    .mobile-image-container,
    .mobile-buybox {
      display: none;
    }
    .milaura-product-wrapper {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 80px;
      padding-top: 40px;
    }
    .desktop-col {
      display: block;
    }
  }
  @media screen and (max-width: 990px) {
    .desktop-col {
      display: none;
    }
    .mobile-buybox {
      display: block;
    }
  }
{%- endstyle -%}

<section class="milaura-product-section" id="MainProduct-{{ section.id }}">
  <div class="milaura-product-wrapper">
    <div class="mobile-image-container">
      <img
        id="MobileMainImg"
        src="{{ product.featured_media | image_url: width: 800 }}"
        alt="{{ product.title }}"
        loading="eager"
      >
    </div>

    <div class="mobile-buybox">
      <span class="subtitle-badge">{{ section.settings.sticker_text | default: 'Fait Main' }}</span>

      <h1 class="milaura-title-fix">{{ product.title }}</h1>

      <div class="mobile-buybox__rating">
        <span class="mobile-buybox__stars">★★★★★</span>
        <span class="mobile-buybox__rating-text">4.9/5 (120+ avis)</span>
      </div>

      <div class="price-container">
        <span class="price-main">{{ product.price | money }}</span>
        {% if product.compare_at_price > product.price %}
          <span class="price-compare">{{ product.compare_at_price | money }}</span>
        {% endif %}
      </div>

      <div id="MobileBundleAnchor" style="scroll-margin-top: 100px;"></div>

      <div class="mobile-bundles">
        <div class="mobile-bundles__title">Choisissez votre rituel</div>

        {% form 'product', product, id: 'MobileBundleForm' %}
          <input
            type="hidden"
            name="id"
            id="MobileVariantIdInput"
            value="{{ product.selected_or_first_available_variant.id }}"
          >
          <input type="hidden" name="quantity" id="MobileQuantityInput" value="1">

          <div class="mobile-bundle-option" onclick="selectBundle(1, this)">
            <div style="font-weight:700;">UNITÉ</div>
            <div style="font-size:0.9rem; color:#666;">Découverte</div>
          </div>

          <div class="mobile-bundle-option" onclick="selectBundle(2, this)" id="DefaultBundleOption">
            <div class="bundle-pill">POPULAIRE</div>
            <div style="font-weight:700;">DUO (x2)</div>
            <div style="font-size:0.9rem; color:#666;">Sauge offerte + Livraison offerte</div>
          </div>

          <div class="mobile-bundle-option" onclick="selectBundle(3, this)">
            <div class="bundle-pill">BEST VALUE</div>
            <div style="font-weight:700;">TRIO (x3)</div>
            <div style="font-size:0.9rem; color:#666;">-10% + Sauge + Livraison</div>
          </div>

          <button type="submit" id="RealSubmitBtn" style="display:none;"></button>
        {% endform %}
      </div>

      <div style="margin-top:30px; font-family:'Lato'; color:#333; line-height:1.6;">
        {{ product.description }}
      </div>
    </div>
    <div class="desktop-col">
      <div style="display:flex; gap:40px;">
        <div style="flex:1;">
          <img src="{{ product.featured_media | image_url: width: 1000 }}" style="width:100%; border-radius:20px;">
        </div>
        <div style="flex:1;">
          <h1 class="milaura-title-fix" style="font-size:55px !important;">{{ product.title }}</h1>
          <button class="milaura-cta-gold">AJOUTER AU PANIER</button>
        </div>
      </div>
    </div>
  </div>
</section>

<div class="mobile-sticky-dock">
  <div class="dock-info">
    <span class="dock-label">Total</span>
    <span class="dock-price" id="DockPrice">{{ product.price | money }}</span>
  </div>

  <button class="milaura-cta-gold" style="width:auto; flex:1;" id="DockBtn" onclick="handleDockClick()">
    CHOISIR MON OFFRE
  </button>
</div>

<script>
  // === LOGIC ===

  function handleDockClick() {
    const bundleSection = document.getElementById('MobileBundleAnchor');
    const dockBtn = document.getElementById('DockBtn');

    // Si on n'est pas encore aux bundles, on scroll
    const rect = bundleSection.getBoundingClientRect();
    if (rect.top > window.innerHeight || rect.bottom < 0) {
      bundleSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
      // Le bouton change de texte
      setTimeout(() => {
        dockBtn.innerText = 'VALIDER LE RITUEL';
      }, 500);
    } else {
      // Si on y est déjà, on clique sur le vrai submit
      document.getElementById('RealSubmitBtn').click();
    }
  }

  function selectBundle(qty, element) {
    // UI Update
    document.querySelectorAll('.mobile-bundle-option').forEach((el) => el.classList.remove('active'));
    element.classList.add('active');

    // Logic Update
    document.getElementById('MobileQuantityInput').value = qty;

    // Feedback Dock
    document.getElementById('DockBtn').innerText = 'AJOUTER AU PANIER (' + qty + ')';
  }

  // Init
  document.addEventListener('DOMContentLoaded', function () {
    const defaultOpt = document.getElementById('DefaultBundleOption');
    if (defaultOpt) selectBundle(2, defaultOpt);
  });
</script>

{% schema %}
{
  "name": "Milaura Luxe V19",
  "settings": [{ "type": "text", "id": "sticker_text", "label": "Badge", "default": "Fait Main" }],
  "presets": [{ "name": "Milaura Luxe V19" }]
}
{% endschema %}
