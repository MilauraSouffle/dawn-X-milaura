{% style %}
  /* ============================================
     MILAURA IMAGE TEXT - V2 COMPACT
     ============================================ */

  #MilauraImageText-{{ section.id }} {
    width: 100%;
    padding: var(--milaura-spacing-md) var(--milaura-spacing-sm);
    background: {% if section.settings.background_color == 'white_glass' %}rgba(255, 255, 255, 0.6){% else %}transparent{% endif %};
    {% if section.settings.background_color == 'white_glass' %}
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    {% endif %}
  }

  /* --- CONTENEUR GLOBAL --- */
  #MilauraImageText-{{ section.id }} .image-text-container {
    max-width: 1200px;
    margin: 0 auto;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--milaura-spacing-md);
    align-items: center;
  }

  /* --- COLONNE IMAGE (AVEC CORDON D'OR) --- */
  #MilauraImageText-{{ section.id }} .image-wrapper {
    position: relative;
    width: 100%;
    height: 100%;
    min-height: 350px;
  }

  #MilauraImageText-{{ section.id }} .image-wrapper img,
  #MilauraImageText-{{ section.id }} .image-wrapper svg {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: var(--milaura-border-radius);
    position: relative;
    z-index: 1;
    display: block;
  }

  #MilauraImageText-{{ section.id }} .image-wrapper::before {
    content: '';
    position: absolute;
    top: 12px;
    left: 12px;
    right: -12px;
    bottom: -12px;
    border: 1px solid var(--milaura-gold);
    border-radius: var(--milaura-border-radius);
    z-index: 0;
    pointer-events: none;
  }

  /* --- COLONNE TEXTE --- */
  #MilauraImageText-{{ section.id }} .text-wrapper {
    padding: var(--milaura-spacing-sm);
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 12px;
  }

  /* Titre - Police personnalisable */
  #MilauraImageText-{{ section.id }} .text-wrapper h2 {
    {% case section.settings.title_font %}
      {% when 'dancing' %}
        font-family: 'Dancing Script', cursive !important;
        text-transform: none;
        letter-spacing: 0;
        font-weight: 600;
        line-height: 1.35;
      {% when 'playfair' %}
        font-family: 'Playfair Display', Georgia, serif !important;
        text-transform: none;
        letter-spacing: 0.5px;
        font-weight: 700;
        line-height: 1.3;
      {% else %}
        font-family: 'Lato', -apple-system, BlinkMacSystemFont, sans-serif !important;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-weight: 700;
        line-height: 1.3;
    {% endcase %}
    color: {{ section.settings.title_color }};
    font-size: {{ section.settings.title_size }}rem;
    margin: 0 0 8px 0;
    text-wrap: balance;
    max-width: 95%;
  }

  /* Contenu texte - Police personnalisable (force sur TOUS les √©l√©ments) */
  #MilauraImageText-{{ section.id }} .text-wrapper .text-content,
  #MilauraImageText-{{ section.id }} .text-wrapper .text-content *,
  #MilauraImageText-{{ section.id }} .text-wrapper .text-content p,
  #MilauraImageText-{{ section.id }} .text-wrapper .text-content h1,
  #MilauraImageText-{{ section.id }} .text-wrapper .text-content h2,
  #MilauraImageText-{{ section.id }} .text-wrapper .text-content h3,
  #MilauraImageText-{{ section.id }} .text-wrapper .text-content h4,
  #MilauraImageText-{{ section.id }} .text-wrapper .text-content em,
  #MilauraImageText-{{ section.id }} .text-wrapper .text-content strong,
  #MilauraImageText-{{ section.id }} .text-wrapper .text-content span {
    {% case section.settings.text_font %}
      {% when 'lato' %}
        font-family: 'Lato', -apple-system, sans-serif !important;
      {% when 'playfair' %}
        font-family: 'Playfair Display', Georgia, serif !important;
      {% when 'dancing' %}
        font-family: 'Dancing Script', cursive !important;
      {% else %}
        font-family: var(--milaura-font-body) !important;
    {% endcase %}
    color: {{ section.settings.text_color }};
    font-size: {{ section.settings.text_size }}rem;
    line-height: 1.65;
    font-style: normal;
  }

  #MilauraImageText-{{ section.id }} .text-wrapper .text-content p {
    margin: 0 0 0.8em 0;
  }

  #MilauraImageText-{{ section.id }} .text-wrapper .text-content p:last-child {
    margin-bottom: 0;
  }

  #MilauraImageText-{{ section.id }} .text-wrapper .text-content h3 {
    font-size: {{ section.settings.text_size }}rem;
    font-weight: 400;
    margin: 0;
  }

  /* Texte tronqu√© */
  #MilauraImageText-{{ section.id }} .text-truncated {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
    transition: all 0.4s ease;
  }

  #MilauraImageText-{{ section.id }} .text-truncated.is-expanded {
    -webkit-line-clamp: unset;
    display: block;
  }

  /* Lire la suite */
  #MilauraImageText-{{ section.id }} .read-more-btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: none;
    border: none;
    padding: 0;
    margin-top: 8px;
    font-family: 'Lato', sans-serif;
    font-size: 0.95rem;
    font-weight: 600;
    color: var(--milaura-gold);
    cursor: pointer;
    transition: all 0.25s ease;
  }

  #MilauraImageText-{{ section.id }} .read-more-btn:hover {
    color: var(--milaura-gold-dark, #8F723A);
  }

  #MilauraImageText-{{ section.id }} .read-more-btn svg {
    width: 16px;
    height: 16px;
    transition: transform 0.3s ease;
  }

  #MilauraImageText-{{ section.id }} .read-more-btn.is-expanded svg {
    transform: rotate(180deg);
  }

  /* --- BOUTON CTA --- */
  #MilauraImageText-{{ section.id }} .text-wrapper .button-wrapper {
    margin-top: 16px;
    text-align: center;
  }

  #MilauraImageText-{{ section.id }} a.milaura-cta {
    display: inline-flex !important;
    align-items: center;
    justify-content: center;
    font-family: 'Lato', -apple-system, BlinkMacSystemFont, sans-serif !important;
    font-size: 1rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    padding: 14px 32px;
    border-radius: 999px;
    text-decoration: none !important;
    color: #000 !important;
    background: linear-gradient(
      135deg,
      rgba(255, 240, 200, 0.95) 0%,
      rgba(214, 176, 96, 0.95) 20%,
      rgba(255, 232, 172, 0.95) 45%,
      rgba(176, 130, 48, 0.95) 75%,
      rgba(255, 240, 200, 0.95) 100%
    ) !important;
    border: 2px solid rgba(214, 176, 96, 0.6) !important;
    box-shadow: 0 8px 25px rgba(192, 160, 98, 0.25) !important;
    transition: all 0.3s ease !important;
  }

  #MilauraImageText-{{ section.id }} a.milaura-cta:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 30px rgba(192, 160, 98, 0.35) !important;
  }

  /* --- LAYOUT INVERSE (Image √† droite) --- */
  #MilauraImageText-{{ section.id }}.layout-right .image-text-container {
    direction: rtl;
  }

  #MilauraImageText-{{ section.id }}.layout-right .image-text-container > * {
    direction: ltr;
  }

  /* --- MOBILE --- */
  @media screen and (max-width: 990px) {
    #MilauraImageText-{{ section.id }} {
      padding: var(--milaura-spacing-sm) var(--milaura-spacing-xs);
    }

    #MilauraImageText-{{ section.id }} .image-text-container {
      grid-template-columns: 1fr;
      gap: 16px;
    }

    #MilauraImageText-{{ section.id }} .image-text-container {
      direction: ltr;
    }

    #MilauraImageText-{{ section.id }} .image-wrapper {
      min-height: 280px;
      order: 1;
    }

    #MilauraImageText-{{ section.id }} .text-wrapper {
      order: 2;
      padding: 12px 8px;
      gap: 10px;
    }

    #MilauraImageText-{{ section.id }} .text-wrapper h2 {
      font-size: 1.6rem;
      text-align: center;
    }

    #MilauraImageText-{{ section.id }} .text-wrapper .text-content {
      font-size: 1rem;
    }

    #MilauraImageText-{{ section.id }} .text-truncated {
      -webkit-line-clamp: 2;
    }

    #MilauraImageText-{{ section.id }} .image-wrapper::before {
      top: 8px;
      left: 8px;
      right: -8px;
      bottom: -8px;
    }

    #MilauraImageText-{{ section.id }} .button-wrapper {
      margin-top: 12px;
    }

    #MilauraImageText-{{ section.id }} a.milaura-cta {
      font-size: 0.9rem;
      padding: 12px 28px;
    }
  }

  /* --- MOBILE TR√àS PETIT --- */
  @media screen and (max-width: 480px) {
    #MilauraImageText-{{ section.id }} .image-wrapper {
      min-height: 220px;
    }

    #MilauraImageText-{{ section.id }} .text-wrapper h2 {
      font-size: 1.4rem;
    }

    #MilauraImageText-{{ section.id }} .text-wrapper .text-content {
      font-size: 0.95rem;
    }
  }
{% endstyle %}

<div id="MilauraImageText-{{ section.id }}" class="{% if section.settings.layout == 'right' %}layout-right{% endif %}">
  <div class="image-text-container">
    {%- if section.settings.image != blank -%}
      <div class="image-wrapper">
        {{ section.settings.image | image_url: width: 1400 | image_tag: loading: 'lazy', alt: section.settings.title }}
      </div>
    {%- else -%}
      <div class="image-wrapper">
        {{ 'lifestyle-1' | placeholder_svg_tag: 'placeholder-image' }}
      </div>
    {%- endif -%}

    <div class="text-wrapper">
      {%- if section.settings.title != blank -%}
        <h2>{{ section.settings.title }}</h2>
      {%- endif -%}

      {%- if section.settings.content != blank -%}
        <div class="text-content">
          <div class="text-truncated" id="text-content-{{ section.id }}">
            {{ section.settings.content }}
          </div>
          <button type="button" class="read-more-btn" id="read-more-{{ section.id }}" aria-expanded="false">
            <span class="read-more-text">Lire la suite</span>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="6 9 12 15 18 9"/>
            </svg>
          </button>
        </div>
      {%- endif -%}

      {%- if section.settings.button_label != blank and section.settings.button_link != blank -%}
        <div class="button-wrapper">
          <a href="{{ section.settings.button_link }}" class="milaura-cta">
            {{ section.settings.button_label }}
          </a>
        </div>
      {%- endif -%}
    </div>
  </div>
</div>

<script>
(function() {
  var sectionId = '{{ section.id }}';
  var textContent = document.getElementById('text-content-' + sectionId);
  var readMoreBtn = document.getElementById('read-more-' + sectionId);

  if (!textContent || !readMoreBtn) return;

  var textSpan = readMoreBtn.querySelector('.read-more-text');

  readMoreBtn.addEventListener('click', function() {
    var isExpanded = textContent.classList.toggle('is-expanded');
    readMoreBtn.classList.toggle('is-expanded', isExpanded);
    readMoreBtn.setAttribute('aria-expanded', isExpanded ? 'true' : 'false');
    textSpan.textContent = isExpanded ? 'R√©duire' : 'Lire la suite';
  });
})();
</script>

{% schema %}
{
  "name": "Milaura Image Text",
  "enabled_on": {
    "templates": ["*"]
  },
  "settings": [
    {
      "type": "header",
      "content": "üì∑ Image"
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "Image"
    },
    {
      "type": "select",
      "id": "layout",
      "label": "Layout",
      "options": [
        {
          "value": "left",
          "label": "Image √† gauche"
        },
        {
          "value": "right",
          "label": "Image √† droite"
        }
      ],
      "default": "left"
    },
    {
      "type": "header",
      "content": "üìù Contenu"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Titre",
      "default": "Kit Rituel Purification"
    },
    {
      "type": "richtext",
      "id": "content",
      "label": "Contenu",
      "default": "<p>Racontez votre histoire, pr√©sentez un rituel ou partagez votre vision.</p>"
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "Label du bouton"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Lien du bouton"
    },
    {
      "type": "header",
      "content": "‚úèÔ∏è Style Titre"
    },
    {
      "type": "range",
      "id": "title_size",
      "label": "Taille du titre",
      "min": 1.2,
      "max": 3,
      "step": 0.1,
      "unit": "rem",
      "default": 1.8
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Couleur du titre",
      "default": "#C0A062"
    },
    {
      "type": "select",
      "id": "title_font",
      "label": "Police du titre",
      "options": [
        {
          "value": "dancing",
          "label": "Dancing Script (Cursif)"
        },
        {
          "value": "playfair",
          "label": "Playfair Display (√âl√©gant)"
        },
        {
          "value": "lato",
          "label": "Lato (Sans-serif)"
        }
      ],
      "default": "dancing"
    },
    {
      "type": "header",
      "content": "‚úèÔ∏è Style Texte"
    },
    {
      "type": "select",
      "id": "text_font",
      "label": "Police du texte",
      "options": [
        {
          "value": "lato",
          "label": "Lato (Recommand√©)"
        },
        {
          "value": "playfair",
          "label": "Playfair Display"
        },
        {
          "value": "dancing",
          "label": "Dancing Script"
        },
        {
          "value": "theme",
          "label": "Police du th√®me"
        }
      ],
      "default": "lato"
    },
    {
      "type": "range",
      "id": "text_size",
      "label": "Taille du texte",
      "min": 0.9,
      "max": 1.3,
      "step": 0.1,
      "unit": "rem",
      "default": 1.1
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Couleur du texte",
      "default": "#1b1b1b"
    },
    {
      "type": "header",
      "content": "üé® Fond"
    },
    {
      "type": "select",
      "id": "background_color",
      "label": "Couleur de fond",
      "options": [
        {
          "value": "transparent",
          "label": "Transparent"
        },
        {
          "value": "white_glass",
          "label": "Blanc verre"
        }
      ],
      "default": "transparent"
    }
  ],
  "presets": [
    {
      "name": "Milaura Image Text"
    }
  ]
}
{% endschema %}
