{%- comment -%}
  MILAURA COLLECTION GRID
  Grille produits style homepage (cartes avec bordure dor√©e subtile)
  Sans cadre dor√© autour pour fluidit√©
  IMPORTANT: Cette section fonctionne UNIQUEMENT sur les pages collection
  @version 2.0.1
{%- endcomment -%}

{%- comment -%} V√©rifier qu'on est sur une page collection {%- endcomment -%}
{%- unless collection -%}
  <section id="MilauraGrid-{{ section.id }}" class="milaura-collection-grid">
    <div class="page-width" style="padding: 40px 20px; text-align: center;">
      <p style="color: #C0A062; font-size: 14px; margin: 0;">
        ‚ö†Ô∏è Cette section "Grille Collection" fonctionne uniquement sur les pages de collection.
      </p>
    </div>
  </section>
  {%- break -%}
{%- endunless -%}

{%- style -%}
  #MilauraGrid-{{ section.id }} {
    padding: var(--milaura-spacing-xs) 0 var(--milaura-spacing-sm) 0;
    background: transparent;
  }

  /* Grille produits */
  #MilauraGrid-{{ section.id }} .grid__products {
    display: grid;
    grid-template-columns: repeat({{ section.settings.columns }}, 1fr);
    gap: 20px;
  }

  /* Carte produit - Style homepage */
  #MilauraGrid-{{ section.id }} .grid__card {
    background: #ffffff;
    border-radius: 20px;
    padding: 12px;
    text-align: center;
    text-decoration: none;
    display: flex;
    flex-direction: column;
    border: 1px solid rgba(192, 160, 98, 0.35);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.04);
    transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    overflow: hidden;
  }

  #MilauraGrid-{{ section.id }} .grid__card:hover {
    border-color: var(--milaura-gold, #C0A062);
    border-width: 2px;
    padding: 11px;
    transform: translateY(-4px);
    box-shadow: 0 12px 30px rgba(192, 160, 98, 0.2);
  }

  /* Image container */
  #MilauraGrid-{{ section.id }} .grid__card-img {
    width: 100%;
    aspect-ratio: 1 / 1;
    overflow: hidden;
    border-radius: 14px;
    margin-bottom: 12px;
    background: #f9f9f9;
    position: relative;
  }

  #MilauraGrid-{{ section.id }} .grid__card-img img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
  }

  #MilauraGrid-{{ section.id }} .grid__card:hover .grid__card-img img {
    transform: scale(1.06);
  }

  /* Badge promo/nouveau */
  #MilauraGrid-{{ section.id }} .grid__card-badge {
    position: absolute;
    top: 8px;
    left: 8px;
    padding: 4px 10px;
    border-radius: 50px;
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    z-index: 2;
  }

  #MilauraGrid-{{ section.id }} .grid__card-badge--sale {
    background: #E85A4F;
    color: #ffffff;
  }

  #MilauraGrid-{{ section.id }} .grid__card-badge--new {
    background: var(--milaura-gold, #C0A062);
    color: #ffffff;
  }

  #MilauraGrid-{{ section.id }} .grid__card-badge--soldout {
    background: #888888;
    color: #ffffff;
  }

  /* Infos produit */
  #MilauraGrid-{{ section.id }} .grid__card-info {
    padding: 8px 4px;
    flex: 1;
    display: flex;
    flex-direction: column;
  }

  #MilauraGrid-{{ section.id }} .grid__card-vendor {
    font-size: 10px;
    text-transform: uppercase;
    color: var(--milaura-text-light, #999);
    letter-spacing: 1.5px;
    margin-bottom: 4px;
  }

  #MilauraGrid-{{ section.id }} .grid__card-title {
    font-family: 'Playfair Display', serif;
    font-size: 1rem;
    font-weight: 600;
    color: var(--milaura-text, #1b1b1b);
    margin: 0 0 8px 0;
    line-height: 1.3;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  #MilauraGrid-{{ section.id }} .grid__card-price {
    font-family: 'Lato', sans-serif;
    font-weight: 700;
    font-size: 1.05rem;
    color: var(--milaura-gold, #C0A062);
    margin-top: auto;
  }

  #MilauraGrid-{{ section.id }} .grid__card-price--compare {
    font-size: 0.85rem;
    color: #999;
    text-decoration: line-through;
    margin-right: 6px;
    font-weight: 400;
  }

  /* Bouton voir produit */
  #MilauraGrid-{{ section.id }} .grid__card-btn {
    margin-top: 12px;
    padding: 10px 16px;
    background: var(--milaura-gold, #C0A062);
    color: #ffffff;
    border: none;
    border-radius: 50px;
    font-family: 'Lato', sans-serif;
    font-size: 0.8rem;
    font-weight: 600;
    cursor: pointer;
    opacity: 0;
    transform: translateY(10px);
    transition: all 0.25s ease;
  }

  #MilauraGrid-{{ section.id }} .grid__card:hover .grid__card-btn {
    opacity: 1;
    transform: translateY(0);
  }

  #MilauraGrid-{{ section.id }} .grid__card-btn:hover {
    background: #1a1a1a;
  }

  /* √âtat vide */
  #MilauraGrid-{{ section.id }} .grid__empty {
    grid-column: 1 / -1;
    text-align: center;
    padding: var(--milaura-spacing-lg) var(--milaura-spacing-md);
  }

  #MilauraGrid-{{ section.id }} .grid__empty-icon {
    font-size: 40px;
    margin-bottom: 12px;
    opacity: 0.6;
  }

  #MilauraGrid-{{ section.id }} .grid__empty-title {
    font-family: 'Playfair Display', serif;
    font-size: 1.3rem;
    color: var(--milaura-text, #1b1b1b);
    margin: 0 0 8px 0;
  }

  #MilauraGrid-{{ section.id }} .grid__empty-text {
    font-size: 0.9rem;
    color: var(--milaura-text-light, #666);
    margin: 0 0 16px 0;
  }

  #MilauraGrid-{{ section.id }} .grid__empty-btn {
    display: inline-block;
    padding: 12px 24px;
    background: var(--milaura-gold, #C0A062);
    color: #ffffff;
    font-weight: 600;
    font-size: 0.85rem;
    text-decoration: none;
    border-radius: 50px;
    transition: all 0.3s ease;
  }

  #MilauraGrid-{{ section.id }} .grid__empty-btn:hover {
    background: #1a1a1a;
    transform: translateY(-2px);
  }

  /* Pagination */
  #MilauraGrid-{{ section.id }} .grid__pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 6px;
    margin-top: var(--milaura-spacing-md);
    flex-wrap: wrap;
  }

  #MilauraGrid-{{ section.id }} .grid__page {
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 36px;
    height: 36px;
    padding: 0 10px;
    background: transparent;
    border: 1px solid rgba(192, 160, 98, 0.3);
    border-radius: 50px;
    font-size: 13px;
    font-weight: 500;
    color: var(--milaura-text, #333);
    text-decoration: none;
    transition: all 0.2s ease;
  }

  #MilauraGrid-{{ section.id }} .grid__page:hover {
    border-color: var(--milaura-gold, #C0A062);
    color: var(--milaura-gold, #C0A062);
  }

  #MilauraGrid-{{ section.id }} .grid__page.is-current {
    background: var(--milaura-gold, #C0A062);
    border-color: var(--milaura-gold, #C0A062);
    color: #ffffff;
  }

  #MilauraGrid-{{ section.id }} .grid__page svg {
    width: 14px;
    height: 14px;
  }

  #MilauraGrid-{{ section.id }} .grid__page--dots {
    border: none;
    min-width: auto;
    padding: 0 4px;
    pointer-events: none;
  }

  /* Tablette */
  @media screen and (max-width: 1024px) {
    #MilauraGrid-{{ section.id }} .grid__products {
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
    }

    #MilauraGrid-{{ section.id }} .grid__card-btn {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Mobile */
  @media screen and (max-width: 768px) {
    #MilauraGrid-{{ section.id }} {
      padding: var(--milaura-spacing-xs) 0 var(--milaura-spacing-sm) 0;
    }

    #MilauraGrid-{{ section.id }} .grid__products {
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }

    #MilauraGrid-{{ section.id }} .grid__card {
      padding: 8px;
      border-radius: 16px;
    }

    #MilauraGrid-{{ section.id }} .grid__card:hover {
      padding: 7px;
    }

    #MilauraGrid-{{ section.id }} .grid__card-img {
      border-radius: 12px;
      margin-bottom: 8px;
    }

    #MilauraGrid-{{ section.id }} .grid__card-title {
      font-size: 0.9rem;
    }

    #MilauraGrid-{{ section.id }} .grid__card-price {
      font-size: 0.95rem;
    }

    #MilauraGrid-{{ section.id }} .grid__card-btn {
      padding: 8px 12px;
      font-size: 0.75rem;
      opacity: 1;
      transform: translateY(0);
    }

    #MilauraGrid-{{ section.id }} .grid__page {
      min-width: 32px;
      height: 32px;
      font-size: 12px;
    }
  }

  /* Petit mobile */
  @media screen and (max-width: 380px) {
    #MilauraGrid-{{ section.id }} .grid__products {
      gap: 10px;
    }

    #MilauraGrid-{{ section.id }} .grid__card {
      padding: 6px;
    }

    #MilauraGrid-{{ section.id }} .grid__card:hover {
      padding: 5px;
    }

    #MilauraGrid-{{ section.id }} .grid__card-img {
      border-radius: 10px;
    }

    #MilauraGrid-{{ section.id }} .grid__card-title {
      font-size: 0.8rem;
      -webkit-line-clamp: 1;
    }

    #MilauraGrid-{{ section.id }} .grid__card-btn {
      padding: 6px 10px;
      font-size: 0.7rem;
      margin-top: 8px;
    }
  }

  /* D√©sactiver animations hover sur tactile */
  @media (hover: none) {
    #MilauraGrid-{{ section.id }} .grid__card:hover {
      transform: none;
      border-width: 1px;
      padding: 12px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.04);
    }

    #MilauraGrid-{{ section.id }} .grid__card:hover .grid__card-img img {
      transform: none;
    }
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    #MilauraGrid-{{ section.id }} .grid__card,
    #MilauraGrid-{{ section.id }} .grid__card-img img,
    #MilauraGrid-{{ section.id }} .grid__card-btn,
    #MilauraGrid-{{ section.id }} .grid__page {
      transition: none;
    }
  }
{%- endstyle -%}

<section
  id="MilauraGrid-{{ section.id }}"
  class="milaura-collection-grid"
  data-section-id="{{ section.id }}"
>
  <div class="page-width">
    {%- paginate collection.products by section.settings.products_per_page -%}

      <div class="grid__products">
        {%- if collection.products.size == 0 -%}
          {%- comment -%} √âtat vide {%- endcomment -%}
          <div class="grid__empty">
            <div class="grid__empty-icon">‚ú®</div>
            <h2 class="grid__empty-title">Aucune cr√©ation trouv√©e</h2>
            <p class="grid__empty-text">Modifiez vos filtres ou explorez nos autres univers.</p>
            <a href="{{ routes.collections_url }}" class="grid__empty-btn">Voir les collections</a>
          </div>

        {%- else -%}
          {%- for product in collection.products -%}
            {%- assign lazy = true -%}
            {%- if forloop.index <= 4 -%}
              {%- assign lazy = false -%}
            {%- endif -%}

            <a href="{{ product.url }}" class="grid__card">
              <div class="grid__card-img">
                {%- comment -%} Badges {%- endcomment -%}
                {%- if section.settings.show_badges -%}
                  {%- if product.available == false -%}
                    <span class="grid__card-badge grid__card-badge--soldout">√âpuis√©</span>
                  {%- elsif product.compare_at_price > product.price -%}
                    <span class="grid__card-badge grid__card-badge--sale">Promo</span>
                  {%- elsif product.created_at > 'now' | date: '%s' | minus: 2592000 | date: '%Y-%m-%d' -%}
                    <span class="grid__card-badge grid__card-badge--new">Nouveau</span>
                  {%- endif -%}
                {%- endif -%}

                {%- if product.featured_image != blank -%}
                  <img
                    src="{{ product.featured_image | image_url: width: 600 }}"
                    srcset="{{ product.featured_image | image_url: width: 200 }} 200w,
                            {{ product.featured_image | image_url: width: 400 }} 400w,
                            {{ product.featured_image | image_url: width: 600 }} 600w"
                    sizes="(max-width: 380px) 45vw, (max-width: 768px) 48vw, (max-width: 1024px) 32vw, 24vw"
                    alt="{{ product.title | escape }}"
                    loading="{% if lazy %}lazy{% else %}eager{% endif %}"
                    width="600"
                    height="600"
                  >
                {%- else -%}
                  {{ 'product-1' | placeholder_svg_tag }}
                {%- endif -%}
              </div>

              <div class="grid__card-info">
                {%- if section.settings.show_vendor and product.vendor != blank -%}
                  <span class="grid__card-vendor">{{ product.vendor }}</span>
                {%- endif -%}

                <h3 class="grid__card-title">{{ product.title }}</h3>

                <div class="grid__card-price">
                  {%- if product.compare_at_price > product.price -%}
                    <span class="grid__card-price--compare">{{ product.compare_at_price | money }}</span>
                  {%- endif -%}
                  {{ product.price | money }}
                </div>
              </div>

              <span class="grid__card-btn">Voir le produit</span>
            </a>
          {%- endfor -%}
        {%- endif -%}
      </div>

      {%- comment -%} Pagination {%- endcomment -%}
      {%- if paginate.pages > 1 -%}
        <nav class="grid__pagination" aria-label="Pagination">
          {%- if paginate.previous -%}
            <a href="{{ paginate.previous.url }}" class="grid__page" aria-label="Page pr√©c√©dente">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="15 18 9 12 15 6"></polyline>
              </svg>
            </a>
          {%- endif -%}

          {%- for part in paginate.parts -%}
            {%- if part.is_link -%}
              <a href="{{ part.url }}" class="grid__page">{{ part.title }}</a>
            {%- elsif part.title == paginate.current_page -%}
              <span class="grid__page is-current" aria-current="page">{{ part.title }}</span>
            {%- else -%}
              <span class="grid__page grid__page--dots">{{ part.title }}</span>
            {%- endif -%}
          {%- endfor -%}

          {%- if paginate.next -%}
            <a href="{{ paginate.next.url }}" class="grid__page" aria-label="Page suivante">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="9 18 15 12 9 6"></polyline>
              </svg>
            </a>
          {%- endif -%}
        </nav>
      {%- endif -%}

    {%- endpaginate -%}
  </div>
</section>

{% schema %}
{
  "name": "Grille Collection",
  "tag": "section",
  "class": "milaura-section",
  "settings": [
    {
      "type": "header",
      "content": "üìù Affichage"
    },
    {
      "type": "range",
      "id": "products_per_page",
      "label": "Produits par page",
      "min": 8,
      "max": 48,
      "step": 4,
      "default": 16
    },
    {
      "type": "range",
      "id": "columns",
      "label": "Colonnes (desktop)",
      "min": 3,
      "max": 5,
      "step": 1,
      "default": 4
    },
    {
      "type": "header",
      "content": "‚öôÔ∏è Options"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "label": "Afficher le vendeur",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_badges",
      "label": "Afficher les badges",
      "default": true,
      "info": "Nouveau, Promo, √âpuis√©"
    }
  ],
  "presets": [
    {
      "name": "Grille Collection"
    }
  ]
}
{% endschema %}
