{%- comment -%}
  MILAURA COLLECTION HERO
  Banniere hero avec image collection, titre stylise, breadcrumb
  Version 2.0 - Animations, parallaxe, navigation collections
  @version 2.0.0
{%- endcomment -%}

{%- style -%}
  #MilauraCollectionHero-{{ section.id }} {
    position: relative;
    padding: var(--milaura-spacing-lg) var(--milaura-spacing-md);
  }

  #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__breadcrumb {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: var(--milaura-spacing-md);
    font-size: 14px;
    color: var(--milaura-text-light, #666666);
    animation: milauraFadeIn 0.6s ease-out forwards;
  }

  #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__breadcrumb a {
    color: var(--milaura-text-light, #666666);
    text-decoration: none;
    transition: color 0.3s ease;
  }

  #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__breadcrumb a:hover {
    color: var(--milaura-gold, #C0A062);
  }

  #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__breadcrumb svg {
    width: 12px;
    height: 12px;
    opacity: 0.5;
  }

  #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__card {
    position: relative;
    overflow: hidden;
    border-radius: var(--milaura-border-radius, 20px);
    min-height: 320px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    padding: var(--milaura-spacing-xl) var(--milaura-spacing-lg);
    background: transparent !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    box-shadow:
      0 20px 50px rgba(0, 0, 0, 0.15),
      0 0 0 1px rgba(255, 255, 255, 0.1) inset;
  }

  /* Fallback background when no image is set */
  #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__card:not(:has(.milaura-collection-hero__bg)) {
    background: linear-gradient(135deg, #FDFBF7 0%, #F2E8D5 100%) !important;
  }

  #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__bg {
    position: absolute;
    top: -10%;
    left: 0;
    width: 100%;
    height: 120%;
    object-fit: cover;
    z-index: 0;
    transition: transform 0.1s ease-out;
  }

  #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      to bottom,
      rgba(0, 0, 0, 0.2) 0%,
      rgba(0, 0, 0, 0.4) 50%,
      rgba(0, 0, 0, 0.55) 100%
    );
    z-index: 1;
  }

  /* Decorative frame */
  #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__frame {
    position: absolute;
    top: 20px;
    left: 20px;
    right: 20px;
    bottom: 20px;
    border: 1px solid rgba(192, 160, 98, 0.4);
    border-radius: 12px;
    pointer-events: none;
    z-index: 2;
    opacity: 0;
    animation: milauraFrameReveal 1s ease-out 0.5s forwards;
  }

  @keyframes milauraFrameReveal {
    to {
      opacity: 1;
    }
  }

  /* Corner decorations */
  #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__frame::before,
  #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__frame::after {
    content: '';
    position: absolute;
    width: 30px;
    height: 30px;
    border: 2px solid rgba(192, 160, 98, 0.6);
  }

  #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__frame::before {
    top: -1px;
    left: -1px;
    border-right: none;
    border-bottom: none;
    border-radius: 12px 0 0 0;
  }

  #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__frame::after {
    bottom: -1px;
    right: -1px;
    border-left: none;
    border-top: none;
    border-radius: 0 0 12px 0;
  }

  #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__content {
    position: relative;
    z-index: 3;
    max-width: 700px;
  }

  /* Decorative line */
  #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__decor {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 16px;
    margin-bottom: var(--milaura-spacing-md);
    opacity: 0;
    animation: milauraFadeInUp 0.7s ease-out 0.2s forwards;
  }

  #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__decor-line {
    width: 50px;
    height: 1px;
    background: linear-gradient(90deg, transparent, rgba(192, 160, 98, 0.8), transparent);
  }

  #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__decor-icon {
    font-size: 20px;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
  }

  #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__title {
    font-family: {{ section.settings.title_font }};
    font-size: {{ section.settings.title_size }}px;
    color: {{ section.settings.title_color }};
    font-weight: 600;
    margin: 0 0 var(--milaura-spacing-sm) 0;
    text-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
    line-height: 1.2;
    opacity: 0;
    animation: milauraFadeInUp 0.8s ease-out 0.3s forwards;
  }

  #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__description {
    font-size: 17px;
    color: rgba(255, 255, 255, 0.95);
    line-height: 1.7;
    margin: 0 0 var(--milaura-spacing-md) 0;
    text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    opacity: 0;
    animation: milauraFadeInUp 0.8s ease-out 0.4s forwards;
  }

  #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__meta {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--milaura-spacing-md);
    opacity: 0;
    animation: milauraFadeInUp 0.8s ease-out 0.5s forwards;
  }

  #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: {{ section.settings.badge_bg_color }};
    color: {{ section.settings.badge_text_color }};
    padding: 10px 20px;
    border-radius: 50px;
    font-size: 14px;
    font-weight: 600;
    box-shadow: 0 4px 15px rgba(192, 160, 98, 0.4);
  }

  #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__scroll {
    display: flex;
    align-items: center;
    gap: 6px;
    color: rgba(255, 255, 255, 0.8);
    font-size: 13px;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__scroll svg {
    width: 16px;
    height: 16px;
    animation: milauraBounce 2s ease-in-out infinite;
  }

  @keyframes milauraBounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(5px); }
  }

  /* Animation keyframes */
  @keyframes milauraFadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  @keyframes milauraFadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Collection navigation pills */
  #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__nav {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    margin-top: var(--milaura-spacing-lg);
    padding-top: var(--milaura-spacing-md);
    border-top: 1px solid rgba(192, 160, 98, 0.2);
  }

  #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__nav-item {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 8px 16px;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 50px;
    font-size: 13px;
    font-weight: 500;
    color: rgba(255, 255, 255, 0.9);
    text-decoration: none;
    transition: all 0.3s ease;
  }

  #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__nav-item:hover {
    background: rgba(192, 160, 98, 0.3);
    border-color: rgba(192, 160, 98, 0.5);
    transform: translateY(-2px);
  }

  #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__nav-item.is-active {
    background: var(--milaura-gold, #C0A062);
    border-color: var(--milaura-gold, #C0A062);
    color: #ffffff;
  }

  /* Desktop */
  @media screen and (min-width: 1024px) {
    #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__card {
      min-height: 400px;
    }

    #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__title {
      font-size: {{ section.settings.title_size }}px;
    }
  }

  /* Tablet */
  @media screen and (min-width: 769px) and (max-width: 1024px) {
    #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__card {
      min-height: 350px;
    }

    #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__title {
      font-size: {{ section.settings.title_size | times: 0.85 | round: 0 }}px;
    }
  }

  /* Mobile */
  @media screen and (max-width: 768px) {
    #MilauraCollectionHero-{{ section.id }} {
      padding: var(--milaura-spacing-md) var(--milaura-spacing-sm);
    }

    #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__breadcrumb {
      font-size: 12px;
      flex-wrap: wrap;
    }

    #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__card {
      min-height: 280px;
      padding: var(--milaura-spacing-lg) var(--milaura-spacing-md);
    }

    #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__frame {
      top: 12px;
      left: 12px;
      right: 12px;
      bottom: 12px;
    }

    #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__title {
      font-size: 32px;
    }

    #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__description {
      font-size: 15px;
    }

    #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__meta {
      flex-direction: column;
      gap: var(--milaura-spacing-sm);
    }

    #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__nav {
      display: none;
    }
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__breadcrumb,
    #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__decor,
    #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__title,
    #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__description,
    #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__meta,
    #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__frame {
      animation: none;
      opacity: 1;
    }

    #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__scroll svg {
      animation: none;
    }

    #MilauraCollectionHero-{{ section.id }} .milaura-collection-hero__bg {
      transition: none;
    }
  }
{%- endstyle -%}

<section
  id="MilauraCollectionHero-{{ section.id }}"
  class="milaura-collection-hero"
  aria-label="{{ collection.title | escape }}"
  data-parallax-hero
>
  <div class="page-width">
    {%- comment -%} Breadcrumb {%- endcomment -%}
    <nav class="milaura-collection-hero__breadcrumb" aria-label="Fil d'Ariane">
      <a href="{{ routes.root_url }}">Accueil</a>
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <polyline points="9 18 15 12 9 6"></polyline>
      </svg>
      <a href="{{ routes.collections_url }}">Collections</a>
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
        <polyline points="9 18 15 12 9 6"></polyline>
      </svg>
      <span aria-current="page">{{ collection.title }}</span>
    </nav>

    {%- comment -%} Hero Card {%- endcomment -%}
    {%- assign parallax_id = 'ParallaxBg-' | append: section.id -%}
    <div class="milaura-collection-hero__card milaura-section-card">
      {%- if collection.image != blank -%}
        <img
          id="{{ parallax_id }}"
          class="milaura-collection-hero__bg"
          src="{{ collection.image | image_url: width: 1600 }}"
          srcset="{{ collection.image | image_url: width: 375 }} 375w,
                  {{ collection.image | image_url: width: 750 }} 750w,
                  {{ collection.image | image_url: width: 1100 }} 1100w,
                  {{ collection.image | image_url: width: 1500 }} 1500w"
          sizes="100vw"
          alt="{{ collection.title | escape }}"
          loading="eager"
          fetchpriority="high"
        >
        <div class="milaura-collection-hero__overlay"></div>
      {%- elsif section.settings.fallback_image != blank -%}
        <img
          id="{{ parallax_id }}"
          class="milaura-collection-hero__bg"
          src="{{ section.settings.fallback_image | image_url: width: 1600 }}"
          srcset="{{ section.settings.fallback_image | image_url: width: 375 }} 375w,
                  {{ section.settings.fallback_image | image_url: width: 750 }} 750w,
                  {{ section.settings.fallback_image | image_url: width: 1100 }} 1100w,
                  {{ section.settings.fallback_image | image_url: width: 1500 }} 1500w"
          sizes="100vw"
          alt="{{ collection.title | escape }}"
          loading="eager"
          fetchpriority="high"
        >
        <div class="milaura-collection-hero__overlay"></div>
      {%- endif -%}

      {%- comment -%} Decorative frame {%- endcomment -%}
      <div class="milaura-collection-hero__frame"></div>

      <div class="milaura-collection-hero__content">
        {%- comment -%} Decorative element {%- endcomment -%}
        {%- if section.settings.show_decor -%}
          <div class="milaura-collection-hero__decor">
            <span class="milaura-collection-hero__decor-line"></span>
            <span class="milaura-collection-hero__decor-icon">{{ section.settings.decor_icon | default: '‚ú®' }}</span>
            <span class="milaura-collection-hero__decor-line"></span>
          </div>
        {%- endif -%}

        <h1 class="milaura-collection-hero__title">
          {{ collection.title }}
        </h1>

        {%- if section.settings.show_description and collection.description != blank -%}
          <div class="milaura-collection-hero__description rte">
            {{ collection.description }}
          </div>
        {%- endif -%}

        <div class="milaura-collection-hero__meta">
          <span class="milaura-collection-hero__badge">
            <span>{{ collection.products_count }}</span>
            <span>{{ collection.products_count | pluralize: 'creation', 'creations' }}</span>
          </span>

          {%- if section.settings.show_scroll_hint -%}
            <span class="milaura-collection-hero__scroll">
              Decouvrir
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <polyline points="19 12 12 19 5 12"></polyline>
              </svg>
            </span>
          {%- endif -%}
        </div>
      </div>

      {%- comment -%} Collection navigation {%- endcomment -%}
      {%- if section.settings.show_collection_nav -%}
        <nav class="milaura-collection-hero__nav" aria-label="Autres collections">
          {%- for nav_collection in collections limit: 6 -%}
            {%- if nav_collection.handle != 'all' and nav_collection.handle != 'recos-pool' -%}
              <a
                href="{{ nav_collection.url }}"
                class="milaura-collection-hero__nav-item{% if nav_collection.handle == collection.handle %} is-active{% endif %}"
                {% if nav_collection.handle == collection.handle %}aria-current="page"{% endif %}
              >
                {{ nav_collection.title }}
              </a>
            {%- endif -%}
          {%- endfor -%}
        </nav>
      {%- endif -%}
    </div>
  </div>
</section>

{%- if section.settings.enable_parallax -%}
<script>
(function() {
  const section = document.querySelector('[data-parallax-hero]');
  if (!section) return;

  const bg = document.getElementById('ParallaxBg-{{ section.id }}');
  if (!bg) return;

  // Check for reduced motion preference
  if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;

  let ticking = false;

  function updateParallax() {
    const rect = section.getBoundingClientRect();
    const scrolled = -rect.top;
    const parallaxAmount = scrolled * 0.15;

    // Only apply parallax when section is in view
    if (rect.top < window.innerHeight && rect.bottom > 0) {
      bg.style.transform = 'translateY(' + parallaxAmount + 'px)';
    }

    ticking = false;
  }

  function onScroll() {
    if (!ticking) {
      requestAnimationFrame(updateParallax);
      ticking = true;
    }
  }

  window.addEventListener('scroll', onScroll, { passive: true });
})();
</script>
{%- endif -%}

{% schema %}
{
  "name": "Milaura Collection Hero",
  "tag": "section",
  "class": "milaura-section",
  "settings": [
    {
      "type": "header",
      "content": "üìù Contenu"
    },
    {
      "type": "checkbox",
      "id": "show_description",
      "label": "Afficher la description",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_decor",
      "label": "Afficher decoration",
      "default": true
    },
    {
      "type": "text",
      "id": "decor_icon",
      "label": "Icone decoration",
      "default": "‚ú®"
    },
    {
      "type": "checkbox",
      "id": "show_scroll_hint",
      "label": "Afficher indication scroll",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_collection_nav",
      "label": "Afficher navigation collections",
      "default": false,
      "info": "Affiche les autres collections sur desktop"
    },
    {
      "type": "image_picker",
      "id": "fallback_image",
      "label": "Image par defaut",
      "info": "Utilisee si la collection n'a pas d'image"
    },
    {
      "type": "header",
      "content": "‚ö° Effets"
    },
    {
      "type": "checkbox",
      "id": "enable_parallax",
      "label": "Activer effet parallaxe",
      "default": true
    },
    {
      "type": "header",
      "content": "‚úèÔ∏è Style Titre"
    },
    {
      "type": "select",
      "id": "title_font",
      "label": "Police du titre",
      "options": [
        { "value": "'Lato', sans-serif", "label": "Lato" },
        { "value": "'Playfair Display', serif", "label": "Playfair Display" },
        { "value": "'Dancing Script', cursive", "label": "Dancing Script" }
      ],
      "default": "'Dancing Script', cursive"
    },
    {
      "type": "range",
      "id": "title_size",
      "label": "Taille du titre",
      "min": 28,
      "max": 72,
      "step": 1,
      "unit": "px",
      "default": 48
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Couleur du titre",
      "default": "#C0A062"
    },
    {
      "type": "header",
      "content": "üé® Couleurs Badge"
    },
    {
      "type": "color",
      "id": "badge_bg_color",
      "label": "Fond du badge",
      "default": "#C0A062"
    },
    {
      "type": "color",
      "id": "badge_text_color",
      "label": "Texte du badge",
      "default": "#ffffff"
    }
  ],
  "presets": [
    {
      "name": "Milaura Collection Hero"
    }
  ]
}
{% endschema %}
