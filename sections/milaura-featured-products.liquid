{{ 'component-card.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}
{{ 'template-collection.css' | asset_url | stylesheet_tag }}
{{ 'quick-add.css' | asset_url | stylesheet_tag }}
<script src="{{ 'quick-add.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'product-form.js' | asset_url }}" defer="defer"></script>

{% style %}
  #MilauraProd-{{ section.id }} {
    padding: var(--milaura-spacing-sm) 0 var(--milaura-spacing-lg) 0;
    background: transparent;
  }

  #MilauraProd-{{ section.id }} .prod-header {
    text-align: center;
    margin-bottom: var(--milaura-spacing-md);
    padding: 0 var(--milaura-spacing-sm);
  }

  #MilauraProd-{{ section.id }} .prod-title {
    font-family: 'Dancing Script', cursive;
    font-size: {{ section.settings.title_size }}rem;
    color: {{ section.settings.title_color }};
    margin-bottom: 10px;
    text-shadow: 0 2px 10px rgba(0,0,0,0.1);
    text-transform: none;
  }

  #MilauraProd-{{ section.id }} .prod-subtitle {
    font-family: 'Lato', sans-serif;
    color: {{ section.settings.subtitle_color }};
    font-size: {{ section.settings.subtitle_size }}rem;
    letter-spacing: 1px;
    text-transform: uppercase;
  }

  /* Badge bestseller positionne par-dessus la carte Dawn */
  #MilauraProd-{{ section.id }} .prod-card-wrapper {
    position: relative;
  }

  #MilauraProd-{{ section.id }} .prod-badge-overlay {
    position: absolute;
    top: 10px;
    left: 10px;
    background: linear-gradient(135deg, #C0A062, #8F723A);
    color: white;
    font-family: var(--milaura-font-body, 'Lato', sans-serif);
    font-size: 0.75rem;
    padding: 4px 10px;
    border-radius: 20px;
    font-weight: 600;
    z-index: 3;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    box-shadow: 0 2px 8px rgba(143, 114, 58, 0.3);
    pointer-events: none;
  }

  /* Bouton CTA */
  #MilauraProd-{{ section.id }} .prod-cta-wrapper {
    text-align: center;
    margin-top: var(--milaura-spacing-sm);
    padding: 0 var(--milaura-spacing-sm);
  }

  #MilauraProd-{{ section.id }} .prod-cta {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    min-height: 48px;
    min-width: 180px;
    padding: 14px 32px;
    border-radius: 999px;
    border: 1px solid rgba(214, 176, 96, 0.55);
    background: linear-gradient(135deg,
      rgba(255, 240, 200, 0.92) 0%,
      rgba(214, 176, 96, 0.92) 18%,
      rgba(255, 232, 172, 0.92) 42%,
      rgba(176, 130, 48, 0.92) 70%,
      rgba(255, 240, 200, 0.92) 100%);
    color: #000;
    text-decoration: none;
    font-family: 'Lato', sans-serif;
    font-weight: 700;
    font-size: 1.15rem;
    letter-spacing: 0.5px;
    box-shadow:
      0 12px 32px rgba(130, 90, 30, 0.15),
      0 0 0 1px rgba(255, 255, 255, 0.25) inset;
    transition: transform 180ms ease, box-shadow 220ms ease;
  }

  #MilauraProd-{{ section.id }} .prod-cta:hover {
    transform: translateY(-3px);
    box-shadow:
      0 16px 40px rgba(130, 90, 30, 0.22),
      0 0 0 1px rgba(255, 255, 255, 0.35) inset;
  }

  #MilauraProd-{{ section.id }} .prod-cta-arrow {
    transition: transform 0.3s ease;
  }

  #MilauraProd-{{ section.id }} .prod-cta:hover .prod-cta-arrow {
    transform: translateX(5px);
  }

  @media screen and (max-width: 768px) {
    #MilauraProd-{{ section.id }} {
      padding: var(--milaura-spacing-xs) 0 var(--milaura-spacing-md) 0;
    }

    #MilauraProd-{{ section.id }} .prod-title {
      font-size: {{ section.settings.title_size_mobile | default: 2.6 }}rem !important;
    }

    #MilauraProd-{{ section.id }} .prod-cta {
      width: 100%;
      max-width: 300px;
      justify-content: center;
      font-size: 0.95rem;
      padding: 12px 28px;
      min-height: 46px;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    #MilauraProd-{{ section.id }} .prod-cta {
      transition: none;
    }
  }
{% endstyle %}

<section id="MilauraProd-{{ section.id }}" aria-label="{{ section.settings.title }}">
  <div class="prod-header">
    <h2 class="prod-title">{{ section.settings.title }}</h2>
    {% if section.settings.subtitle != blank %}
      <p class="prod-subtitle">{{ section.settings.subtitle }}</p>
    {% endif %}
  </div>

  {%- assign collection = collections[section.settings.collection] -%}

  <div class="collection page-width">
    <ul
      class="grid product-grid contains-card contains-card--product{% if settings.card_style == 'standard' %} contains-card--standard{% endif %} grid--{{ section.settings.columns_desktop }}-col-desktop grid--2-col-tablet-down"
      role="list"
    >
      {%- assign skip_card_product_styles = false -%}

      {%- if collection != blank and collection.products.size > 0 -%}
        {%- for product in collection.products limit: section.settings.products_to_show -%}
          {%- if forloop.index > 2 -%}
            {%- assign lazy = true -%}
          {%- else -%}
            {%- assign lazy = false -%}
          {%- endif -%}

          <li class="grid__item">
            <div class="prod-card-wrapper">
              {%- if section.settings.force_bestseller_badge or product.metafields.milaura.is_bestseller == true -%}
                <span class="prod-badge-overlay">{{ section.settings.badge_label | default: 'Bestseller' }}</span>
              {%- endif -%}

              {% render 'card-product',
                card_product: product,
                media_aspect_ratio: section.settings.image_ratio,
                image_shape: 'default',
                show_secondary_image: section.settings.show_secondary_image,
                show_vendor: section.settings.show_vendor,
                show_rating: section.settings.show_rating,
                lazy_load: lazy,
                skip_styles: skip_card_product_styles,
                quick_add: 'standard',
                section_id: section.id
              %}
            </div>
          </li>
          {%- assign skip_card_product_styles = true -%}
        {%- endfor -%}
      {%- else -%}
        {%- for i in (1..4) -%}
          <li class="grid__item">
            {% render 'card-product',
              media_aspect_ratio: section.settings.image_ratio,
              image_shape: 'default',
              show_vendor: true,
              skip_styles: skip_card_product_styles,
              section_id: section.id
            %}
          </li>
          {%- assign skip_card_product_styles = true -%}
        {%- endfor -%}
      {%- endif -%}
    </ul>
  </div>

  {% if section.settings.cta_label != blank %}
    <div class="prod-cta-wrapper">
      <a href="{{ section.settings.cta_link | default: collection.url }}" class="prod-cta">
        <span>
          {{ section.settings.cta_label }}
          {% if section.settings.show_product_count and collection != blank %}
            ({{ collection.products_count }} produits)
          {% endif %}
        </span>
        <span class="prod-cta-arrow">&rarr;</span>
      </a>
    </div>
  {% endif %}
</section>

{% schema %}
{
  "name": "Milaura Produits Carousel",
  "settings": [
    {
      "type": "header",
      "content": "Contenu"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Titre",
      "default": "Nos Nouveautés"
    },
    {
      "type": "text",
      "id": "subtitle",
      "label": "Sous-titre",
      "default": "Les dernières créations énergétiques"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Choisir la collection"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 2,
      "max": 12,
      "step": 1,
      "default": 4,
      "label": "Nombre de produits"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 2,
      "max": 5,
      "step": 1,
      "default": 4,
      "label": "Colonnes (desktop)"
    },
    {
      "type": "header",
      "content": "Cartes produits"
    },
    {
      "type": "select",
      "id": "image_ratio",
      "options": [
        { "value": "adapt", "label": "S'adapter a l'image" },
        { "value": "portrait", "label": "Portrait" },
        { "value": "square", "label": "Carre" }
      ],
      "default": "adapt",
      "label": "Ratio image"
    },
    {
      "type": "checkbox",
      "id": "show_secondary_image",
      "default": false,
      "label": "Montrer image secondaire au survol"
    },
    {
      "type": "checkbox",
      "id": "show_vendor",
      "default": true,
      "label": "Afficher le vendeur"
    },
    {
      "type": "checkbox",
      "id": "show_rating",
      "default": false,
      "label": "Afficher la note"
    },
    {
      "type": "header",
      "content": "Badges"
    },
    {
      "type": "checkbox",
      "id": "force_bestseller_badge",
      "label": "Badge sur tous les produits",
      "default": false,
      "info": "Si coche, tous les produits auront le badge"
    },
    {
      "type": "text",
      "id": "badge_label",
      "label": "Texte du badge",
      "default": "Bestseller"
    },
    {
      "type": "header",
      "content": "Bouton CTA"
    },
    {
      "type": "text",
      "id": "cta_label",
      "label": "Texte du bouton",
      "default": "Voir toute la collection"
    },
    {
      "type": "url",
      "id": "cta_link",
      "label": "Lien du bouton (optionnel)",
      "info": "Si vide, redirige vers la collection"
    },
    {
      "type": "checkbox",
      "id": "show_product_count",
      "label": "Afficher le nombre de produits",
      "default": true
    },
    {
      "type": "header",
      "content": "Style Titre"
    },
    {
      "type": "range",
      "id": "title_size",
      "label": "Taille du titre (desktop)",
      "min": 2,
      "max": 5,
      "step": 0.1,
      "unit": "rem",
      "default": 3.8
    },
    {
      "type": "range",
      "id": "title_size_mobile",
      "label": "Taille du titre (mobile)",
      "min": 1.5,
      "max": 4,
      "step": 0.1,
      "unit": "rem",
      "default": 2.6
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Couleur du titre",
      "default": "#C0A062"
    },
    {
      "type": "range",
      "id": "subtitle_size",
      "label": "Taille sous-titre",
      "min": 0.8,
      "max": 1.5,
      "step": 0.1,
      "unit": "rem",
      "default": 1.1
    },
    {
      "type": "color",
      "id": "subtitle_color",
      "label": "Couleur sous-titre",
      "default": "#666666"
    }
  ],
  "presets": [
    {
      "name": "Milaura Produits Carousel"
    }
  ]
}
{% endschema %}
