{%- comment -%}
  MILAURA BADGE
  Snippet reutilisable pour badges produit

  Params:
  - type: 'new' | 'sale' | 'soldout' | 'custom'
  - text: texte personnalise (pour type 'custom')
  - product: objet produit (pour detection automatique)
  - days_new: nombre de jours pour considerer un produit comme nouveau (default: 30)
{%- endcomment -%}

{%- liquid
  assign badge_type = type | default: 'custom'
  assign badge_text = text | default: ''
  assign days_new = days_new | default: 30
  assign show_badge = false
  assign badge_class = 'milaura-badge'

  # Detection automatique si produit fourni
  if product != blank
    # Badge Rupture
    if badge_type == 'soldout' or product.available == false
      assign show_badge = true
      assign badge_text = 'Rupture'
      assign badge_class = badge_class | append: ' milaura-badge--soldout'

    # Badge Promo
    elsif badge_type == 'sale'
      assign variant = product.selected_or_first_available_variant
      if variant.compare_at_price > variant.price
        assign show_badge = true
        assign discount_percent = variant.compare_at_price | minus: variant.price | times: 100 | divided_by: variant.compare_at_price | round
        assign badge_text = '-' | append: discount_percent | append: '%'
        assign badge_class = badge_class | append: ' milaura-badge--sale'
      endif

    # Badge Nouveau
    elsif badge_type == 'new'
      assign product_created = product.created_at | date: '%s' | times: 1
      assign now = 'now' | date: '%s' | times: 1
      assign days_since_created = now | minus: product_created | divided_by: 86400
      if days_since_created <= days_new
        assign show_badge = true
        assign badge_text = 'Nouveau'
        assign badge_class = badge_class | append: ' milaura-badge--new'
      endif
    endif

  # Type custom
  elsif badge_type == 'custom' and text != blank
    assign show_badge = true
    assign badge_class = badge_class | append: ' milaura-badge--custom'
  endif
-%}

{%- if show_badge -%}
  <span class="{{ badge_class }}">
    {{ badge_text }}
  </span>
{%- endif -%}
